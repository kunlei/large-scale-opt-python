<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.526">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hands-on Large Scale Optimization in Python - 4&nbsp; Benders Decomposition</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./env-setup.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XM4LXJY2KJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XM4LXJY2KJ', { 'anonymize_ip': true});
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
    });
    </script>

<!-- This is what works with Quarto -->
<script>
    MathJax = {
        tex: {
            tags: 'ams'  // should be 'ams', 'none', or 'all'
        }
    };
</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Hands-on Large Scale Optimization in Python - 4&nbsp; Benders Decomposition">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./benders-theory.html">Benders Decomposition</a></li><li class="breadcrumb-item"><a href="./benders-theory.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Benders Decomposition</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hands-on Large Scale Optimization in Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Environment Setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environment Setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Benders Decomposition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./benders-theory.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Benders Decomposition</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-decomposition-logic" id="toc-the-decomposition-logic" class="nav-link active" data-scroll-target="#the-decomposition-logic"><span class="header-section-number">4.1</span> The Decomposition Logic</a></li>
  <li><a href="#solving-linear-programming-problems-with-benders-decomposition" id="toc-solving-linear-programming-problems-with-benders-decomposition" class="nav-link" data-scroll-target="#solving-linear-programming-problems-with-benders-decomposition"><span class="header-section-number">4.2</span> Solving Linear Programming Problems with Benders Decomposition</a>
  <ul class="collapse">
  <li><a href="#lp-solvers-based-on-gurobi-and-scip" id="toc-lp-solvers-based-on-gurobi-and-scip" class="nav-link" data-scroll-target="#lp-solvers-based-on-gurobi-and-scip"><span class="header-section-number">4.2.1</span> LP solvers based on Gurobi and SCIP</a></li>
  <li><a href="#a-serious-lp-problem-that-cannot-wait-to-be-decomposed" id="toc-a-serious-lp-problem-that-cannot-wait-to-be-decomposed" class="nav-link" data-scroll-target="#a-serious-lp-problem-that-cannot-wait-to-be-decomposed"><span class="header-section-number">4.2.2</span> A serious LP problem that cannot wait to be decomposed!</a></li>
  <li><a href="#benders-decomposition-formulations" id="toc-benders-decomposition-formulations" class="nav-link" data-scroll-target="#benders-decomposition-formulations"><span class="header-section-number">4.2.3</span> Benders decomposition formulations</a></li>
  <li><a href="#benders-decomposition-step-by-step" id="toc-benders-decomposition-step-by-step" class="nav-link" data-scroll-target="#benders-decomposition-step-by-step"><span class="header-section-number">4.2.4</span> Benders decomposition step by step</a></li>
  <li><a href="#putting-it-together" id="toc-putting-it-together" class="nav-link" data-scroll-target="#putting-it-together"><span class="header-section-number">4.2.5</span> Putting it together</a></li>
  <li><a href="#a-generic-lp-benders-decomposition-solver" id="toc-a-generic-lp-benders-decomposition-solver" class="nav-link" data-scroll-target="#a-generic-lp-benders-decomposition-solver"><span class="header-section-number">4.2.6</span> A generic LP Benders decomposition solver</a></li>
  <li><a href="#implementation-with-callbacks" id="toc-implementation-with-callbacks" class="nav-link" data-scroll-target="#implementation-with-callbacks"><span class="header-section-number">4.2.7</span> Implementation with callbacks</a></li>
  <li><a href="#implementation-with-scip" id="toc-implementation-with-scip" class="nav-link" data-scroll-target="#implementation-with-scip"><span class="header-section-number">4.2.8</span> Implementation with SCIP</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing"><span class="header-section-number">4.2.9</span> Testing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./benders-theory.html">Benders Decomposition</a></li><li class="breadcrumb-item"><a href="./benders-theory.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Benders Decomposition</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Benders Decomposition</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter, we will explain the theories behind Benders decomposition and demonstrate its usage on a trial linear programming problem. Keep in mind that Benders decomposition is not limited to solving linear programming problems. In fact, it is one of the most powerful techniques to solve some large-scale mixed-integer linear programming problems.</p>
<p>In the following sections, we will go through the critical steps during the decomposition process when applying the algorithm on optimization problems represented in standard forms. This is important as it helps build up the intuition of when we should consider applying Benders decomposition to a problem at hand. Often times, recognizing the applicability of Benders decomposition is the most important and challenging step when solving an optimization problem. Once we know that the problem structure is suitable to solve via Benders decomposition, it is straightforward to follow the decomposition steps and put it into work.</p>
<p>Generally speaking, Benders decomposition is a good solution candidate when the resulting problem is much easier to solve if some of the variables in the original problem are fixed. We will illustrate this point using an example in the following sections. In the optimization world, the first candidate that should come to mind when we say a problem is easy to solve is a linear programming formulation, which is indeed the case in Benders decomposition applications.</p>
<section id="the-decomposition-logic" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-decomposition-logic"><span class="header-section-number">4.1</span> The Decomposition Logic</h2>
<p>To explain the workings of Benders decomposition, let us look at the standard form of linear programming problems that involve two vector variables, <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span>. Let <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> indicate the dimensions of <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span>, respectively. Below is the original problem (<strong>P</strong>) we intend to solve.</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad \mathbf{c}^T \mathbf{x} + \mathbf{f}^T \mathbf{y} \\
\text{s.t.} &amp;\quad \mathbf{A} \mathbf{x} + \mathbf{B} \mathbf{y} = \mathbf{b} \\
&amp;\quad \mathbf{x} \geq 0, \mathbf{y} \geq 0
\end{align}\]</span></p>
<p>In this formulation, <span class="math inline">\(\mathbf{c}\)</span> and <span class="math inline">\(\mathbf{f}\)</span> in the objective function represent the cost coefficients associated with decision variables <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span>, respectively. Both of them are column vectors of corresponding dimensions. In the constraints, matrix <span class="math inline">\(\mathbf{A}\)</span> is of dimension <span class="math inline">\(m \times p\)</span>, and matrix <span class="math inline">\(\mathbf{B}\)</span> is of dimension <span class="math inline">\(m \times q\)</span>. <span class="math inline">\(\mathbf{b}\)</span> is a column vector of dimension <span class="math inline">\(m\)</span>.</p>
<p>Suppose the variable <span class="math inline">\(\mathbf{y}\)</span> is a complicating variable in the sense that the resulting problem is substantially easier to solve if the value of <span class="math inline">\(\mathbf{y}\)</span> is fixed. In this case, we could rewrite problem <span class="math inline">\(\mathbf{P}\)</span> as the following form:</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad \mathbf{f}^T \mathbf{y} + g(\mathbf{y}) \\
\text{s.t.} &amp;\quad \mathbf{y} \geq 0
\end{align}\]</span></p>
<p>where <span class="math inline">\(g(\mathbf{y})\)</span> is a function of <span class="math inline">\(\mathbf{y}\)</span> and is defined as the subproblem <span class="math inline">\(\mathbf{SP}\)</span> of the form below:</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \mathbf{c}^T \mathbf{x} \\
    \text{s.t.} &amp;\quad \mathbf{A} \mathbf{x}  = \mathbf{b} - \mathbf{B} \mathbf{y} \label{bd-cons1} \\
    &amp;\quad \mathbf{x} \geq 0
\end{align}\]</span></p>
<p>Note that the <span class="math inline">\(\mathbf{y}\)</span> in constraint <span class="math inline">\(\eqref{bd-cons1}\)</span> takes on some known values when the problem is solved and the only decision variable in the above formulation is <span class="math inline">\(\mathbf{x}\)</span>. The dual problem of <span class="math inline">\(\mathbf{SP}\)</span>, <span class="math inline">\(\mathbf{DSP}\)</span>, is given below.</p>
<p><span class="math display">\[\begin{align}
    \text{max.} &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u} \\
    \text{s.t.} &amp;\quad \mathbf{A}^T \mathbf{u} \leq \mathbf{c} \label{bd-cons2} \\
    &amp;\quad \mathbf{u}\  \text{unrestricted}
\end{align}\]</span></p>
<p>A key characteristic of the above <span class="math inline">\(\mathbf{DSP}\)</span> is that its solution space does not depend on the value of <span class="math inline">\(\mathbf{y}\)</span>, which only affects the objective function. According to the Minkowski’s representation theorem, any <span class="math inline">\(\bar{\mathbf{u}}\)</span> satisfying the constraints <span class="math inline">\(\eqref{bd-cons2}\)</span> can be expressed as</p>
<p><span class="math display">\[\begin{align}
\bar{\mathbf{u}} = \sum_{j \in \mathbf{J}} \lambda_j \mathbf{u}_{j}^{point} + \sum_{k \in \mathbf{K}} \mu_k \mathbf{u}_k^{ray}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\mathbf{u}_j^{point}\)</span> and <span class="math inline">\(\mathbf{u}_k^{ray}\)</span> represent an extreme point and extreme ray, respectively. In addition, <span class="math inline">\(\lambda_j \geq 0\)</span> for all <span class="math inline">\(j \in \mathbf{J}\)</span> and <span class="math inline">\(\sum_{j \in \mathbf{J}}\lambda_j = 1\)</span>, and <span class="math inline">\(\mu_k \geq 0\)</span> for all <span class="math inline">\(k \in \mathbf{K}\)</span>. It follows that the <span class="math inline">\(\mathbf{DSP}\)</span> is equivalent to</p>
<p><span class="math display">\[\begin{align}
\text{max.} &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} (\sum_{j \in \mathbf{J}} \lambda_j \mathbf{u}_{j}^{point} + \sum_{k \in \mathbf{K}} \mu_k \mathbf{u}_k^{ray}) \\
\text{s.t.} &amp;\quad \sum_{j \in \mathbf{J}}\lambda_j = 1 \\
&amp;\quad \lambda_j \geq 0, \ \forall j \in \mathbf{J} \\
&amp;\quad \mu_k \geq 0, \ \forall k \in \mathbf{K}
\end{align}\]</span></p>
<p>We can therefore conclude that</p>
<ul>
<li>The <span class="math inline">\(\mathbf{DSP}\)</span> becomes unbounded if any <span class="math inline">\(\mathbf{u}_k^{ray}\)</span> exists such that <span class="math inline">\((\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_k^{ray} &gt; 0\)</span>. Note that an unbounded <span class="math inline">\(\mathbf{DSP}\)</span> implies an infeasible <span class="math inline">\(\mathbf{SP}\)</span> and to prevent this from happening, we have to ensure that <span class="math inline">\((\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_k^{ray} \leq 0\)</span> for all <span class="math inline">\(k \in \mathbf{K}\)</span>.</li>
<li>If an optimal solution to <span class="math inline">\(\mathbf{DSP}\)</span> exists, it must occur at one of the extreme points. Let <span class="math inline">\(g\)</span> denote the optimal objective value, it follows that <span class="math inline">\((\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_j^{point} \leq g\)</span> for all <span class="math inline">\(j \in \mathbf{J}\)</span>.</li>
</ul>
<p>Based on this idea, the <span class="math inline">\(\mathbf{DSP}\)</span> can be reformulated as follows:</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad g \\
\text{s.t.} &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_k^{ray} \leq 0, \ \forall j \in \mathbf{J} \label{bd-feas} \\
&amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_j^{point} \leq g, \ \forall k \in \mathbf{K} \label{bd-opt} \\
&amp;\quad j \in \mathbf{J}, k \in \mathbf{K}
\end{align}\]</span></p>
<p>Constraints <span class="math inline">\(\eqref{bd-feas}\)</span> are called <strong>Benders feasibility cuts</strong>, while constraints <span class="math inline">\(\eqref{bd-opt}\)</span> are called <strong>Benders optimality cuts</strong>. Now we are ready to define the Benders Master Problem (<span class="math inline">\(\mathbf{BMP}\)</span>) as follows:</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \mathbf{f}^T \mathbf{y} + g \\
    \text{s.t.} &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_k^{ray} \leq 0, \ \forall j \in \mathbf{J} \\
    &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_j^{point} \leq g, \ \forall k \in \mathbf{K} \\
    &amp;\quad j \in \mathbf{J}, k \in \mathbf{K}, \mathbf{y} \geq 0
\end{align}\]</span></p>
<p>Typically <span class="math inline">\(J\)</span> and <span class="math inline">\(K\)</span> are too large to enumerate upfront and we have to work with subsets of them, denoted by <span class="math inline">\(J_s\)</span> and <span class="math inline">\(K_s\)</span>, respectively. Hence we have the following Restricted Benders Master Problem (<span class="math inline">\(\mathbf{RBMP}\)</span>):</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \mathbf{f}^T \mathbf{y} + g \\
    \text{s.t.} &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_k^{ray} \leq 0, \ \forall j \in \mathbf{J}_s \\
    &amp;\quad (\mathbf{b} - \mathbf{B} \mathbf{y})^{T} \mathbf{u}_j^{point} \leq g, \ \forall k \in \mathbf{K}_s \\
    &amp;\quad j \in \mathbf{J}, k \in \mathbf{K}, \mathbf{y} \geq 0
\end{align}\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-benders-flowchart" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-benders-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-benders-flowchart">flowchart LR
   A[Start] --&gt; B{Is}
    B --&gt;|Yes| C[OK]
    C --&gt; D[Rethink]
    D --&gt; B
    B ----&gt;|No| E[End]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-benders-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Benders decomposition workflow
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solving-linear-programming-problems-with-benders-decomposition" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="solving-linear-programming-problems-with-benders-decomposition"><span class="header-section-number">4.2</span> Solving Linear Programming Problems with Benders Decomposition</h2>
<p>In this section, we use Benders decomposition to solve several linear programming (LP) problems in order to demonstrate the decomposition logic, especially how the restricted Benders master problem interacts with the subproblem in an iterative approach to reach final optimality. Most linear programs could be solved efficiently nowadays by either open source or commercial solvers without resorting to any decomposition approaches. However, by working through the example problems in the following sections, we aim to showcase the implementation details when applying Benders decomposition algorithm on real problems, which helps solidify our understanding of Benders decomposition. Hopefully, by the end of this chapter, we will build up enough intuition as well as hands-on experience such that we are ready to tackle most involved problems in the following chapters.</p>
<p>In the following sections, we employ several steps to illustrate the problem solving process of Benders decomposition.</p>
<ul>
<li>We will first create two linear programming solvers based on Gurobi and SCIP that can solve any linear programs defined in the standard form. They are used in later section to validate the correctness of the solutions produced by Benders decomposition.</li>
<li>Next, we use a specific linear program and give the corresponding RBMP and DSP to prepare for the implementations.</li>
<li>Then, we will solve the example linear program step by step by examining the outputs of the RBMP and DSP to decided the next set of actions.</li>
<li>Futhermore, a holistic Benders decomposition implementation is then developed to solve the example linear program.</li>
<li>Following the previous step, a more generic Benders decomposition implementation is created.</li>
<li>Then, we will examine an alternative implementation using Gurobi callback functions.</li>
<li>We will also provide an implementation based on SCIP.</li>
<li>In the final section, we will do several benchmarking testing.</li>
</ul>
<section id="lp-solvers-based-on-gurobi-and-scip" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="lp-solvers-based-on-gurobi-and-scip"><span class="header-section-number">4.2.1</span> LP solvers based on Gurobi and SCIP</h3>
<p>We aim to use Benders decomposition to solve several linear programming problems in the following sections. To do that, we intentionally decompose the LP problem under consideration into two sets, one set of <em>complicating</em> variables and the other set containing the remaining variables. In order to validate the correctness of the results obtained by Benders decomposition, we implement two additional ways of solving the target linear programming problems directly. The first option is based on the Gurobi API in python and the other is based on the open source solve SCIP. The two implementations defined here assume the LP problems under consideration follow the below standard form:</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \mathbf{c}^T \mathbf{x} \\
    \text{s.t.} &amp;\quad \mathbf{A} \mathbf{x} = \mathbf{b} \\
    &amp;\quad \mathbf{x} \geq 0
\end{align}\]</span></p>
<p><a href="#lst-solver-gurobi" class="quarto-xref">Listing&nbsp;<span>4.1</span></a> defines a solver for LP problems using Gurobi. It takes three constructor parameters:</p>
<ul>
<li><code>obj_coeff</code>: this corresponds to the objective coefficients <span class="math inline">\(\mathbf{c}\)</span>.</li>
<li><code>constr_mat</code>: this refers to the constraint matrix <span class="math inline">\(\mathbf{A}\)</span>.</li>
<li><code>rhs</code>: this is the right-hand side <span class="math inline">\(\mathbf{b}\)</span>.</li>
</ul>
<p>Inside the constructor <code>__init__()</code>, a solver environment <code>_env</code> is first created and then used to initialize a model object <code>_model</code>. The input parameters are then used to create decision variables <code>_vars</code>, constraints <code>_constrs</code> and objective function respectively. The <code>optimize()</code> function simply solves the problem and shows the solving status. Finally, the <code>clean_up()</code> function frees up the computing resources.</p>
<div id="cell-33" class="cell" data-execution_count="211">
<div id="lst-solver-gurobi" class="python cell-code listing" data-code-line-numbers="true">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.1: A LP solver based on Gurobi
</figcaption>
<div aria-describedby="lst-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-solver-gurobi" data-code-line-numbers="true"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-solver-gurobi-1"><a href="#lst-solver-gurobi-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-solver-gurobi-2"><a href="#lst-solver-gurobi-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-solver-gurobi-3"><a href="#lst-solver-gurobi-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-solver-gurobi-4"><a href="#lst-solver-gurobi-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-solver-gurobi-5"><a href="#lst-solver-gurobi-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LpSolverGurobi:</span>
<span id="lst-solver-gurobi-6"><a href="#lst-solver-gurobi-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-7"><a href="#lst-solver-gurobi-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-gurobi-8"><a href="#lst-solver-gurobi-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># initialize environment and model</span></span>
<span id="lst-solver-gurobi-9"><a href="#lst-solver-gurobi-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'GurobiEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-solver-gurobi-10"><a href="#lst-solver-gurobi-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self._env.setParam('LogToConsole', 1 if verbose else 0)</span></span>
<span id="lst-solver-gurobi-11"><a href="#lst-solver-gurobi-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">'OutputFlag'</span>, <span class="dv">1</span> <span class="cf">if</span> verbose <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="lst-solver-gurobi-12"><a href="#lst-solver-gurobi-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-solver-gurobi-13"><a href="#lst-solver-gurobi-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'GurobiLpSolver'</span>)</span>
<span id="lst-solver-gurobi-14"><a href="#lst-solver-gurobi-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-15"><a href="#lst-solver-gurobi-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prepare data</span></span>
<span id="lst-solver-gurobi-16"><a href="#lst-solver-gurobi-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._obj_coeff <span class="op">=</span> obj_coeff</span>
<span id="lst-solver-gurobi-17"><a href="#lst-solver-gurobi-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(self._obj_coeff)</span></span>
<span id="lst-solver-gurobi-18"><a href="#lst-solver-gurobi-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._constr_mat <span class="op">=</span> constr_mat</span>
<span id="lst-solver-gurobi-19"><a href="#lst-solver-gurobi-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(self._constr_mat)</span></span>
<span id="lst-solver-gurobi-20"><a href="#lst-solver-gurobi-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rhs <span class="op">=</span> rhs</span>
<span id="lst-solver-gurobi-21"><a href="#lst-solver-gurobi-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>._obj_coeff)</span>
<span id="lst-solver-gurobi-22"><a href="#lst-solver-gurobi-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_constrs <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>._rhs)</span>
<span id="lst-solver-gurobi-23"><a href="#lst-solver-gurobi-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-24"><a href="#lst-solver-gurobi-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-solver-gurobi-25"><a href="#lst-solver-gurobi-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> <span class="va">self</span>._model.addMVar(<span class="va">self</span>._num_vars, </span>
<span id="lst-solver-gurobi-26"><a href="#lst-solver-gurobi-26" aria-hidden="true" tabindex="-1"></a>                                         vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-solver-gurobi-27"><a href="#lst-solver-gurobi-27" aria-hidden="true" tabindex="-1"></a>                                         lb<span class="op">=</span><span class="dv">0</span>)</span>
<span id="lst-solver-gurobi-28"><a href="#lst-solver-gurobi-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-29"><a href="#lst-solver-gurobi-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-solver-gurobi-30"><a href="#lst-solver-gurobi-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._constrs <span class="op">=</span> <span class="va">self</span>._model.addConstr(</span>
<span id="lst-solver-gurobi-31"><a href="#lst-solver-gurobi-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._constr_mat<span class="op">@</span>self._vars <span class="op">==</span> <span class="va">self</span>._rhs</span>
<span id="lst-solver-gurobi-32"><a href="#lst-solver-gurobi-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="lst-solver-gurobi-33"><a href="#lst-solver-gurobi-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-34"><a href="#lst-solver-gurobi-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-solver-gurobi-35"><a href="#lst-solver-gurobi-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="va">self</span>._obj_coeff<span class="op">@</span>self._vars, </span>
<span id="lst-solver-gurobi-36"><a href="#lst-solver-gurobi-36" aria-hidden="true" tabindex="-1"></a>                                 GRB.MINIMIZE)</span>
<span id="lst-solver-gurobi-37"><a href="#lst-solver-gurobi-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-38"><a href="#lst-solver-gurobi-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-gurobi-39"><a href="#lst-solver-gurobi-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-solver-gurobi-40"><a href="#lst-solver-gurobi-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-solver-gurobi-41"><a href="#lst-solver-gurobi-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal solution found!'</span>)</span>
<span id="lst-solver-gurobi-42"><a href="#lst-solver-gurobi-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_model<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-solver-gurobi-43"><a href="#lst-solver-gurobi-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-solver-gurobi-44"><a href="#lst-solver-gurobi-44" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-solver-gurobi-45"><a href="#lst-solver-gurobi-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-solver-gurobi-46"><a href="#lst-solver-gurobi-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-solver-gurobi-47"><a href="#lst-solver-gurobi-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-solver-gurobi-48"><a href="#lst-solver-gurobi-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span>
<span id="lst-solver-gurobi-49"><a href="#lst-solver-gurobi-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-solver-gurobi-50"><a href="#lst-solver-gurobi-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-solver-gurobi-51"><a href="#lst-solver-gurobi-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-solver-gurobi-52"><a href="#lst-solver-gurobi-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-53"><a href="#lst-solver-gurobi-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-solver-gurobi-54"><a href="#lst-solver-gurobi-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-solver-gurobi-55"><a href="#lst-solver-gurobi-55" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-solver-scip" class="quarto-xref">Listing&nbsp;<span>4.2</span></a> presents an LP solver implementation in class <code>LpSolverSCIP</code> using SCIP. The constructor requires the same of parameters as defined in <code>LpSolverGurobi</code>. The model building process is similar with minor changes when required to create decision variables, constraints and the objective function.</p>
<div id="cell-35" class="cell" data-execution_count="205">
<div id="lst-solver-scip" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-solver-scip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.2: A LP solver based on SCIP
</figcaption>
<div aria-describedby="lst-solver-scip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-solver-scip"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-solver-scip-1"><a href="#lst-solver-scip-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt <span class="im">as</span> scip</span>
<span id="lst-solver-scip-2"><a href="#lst-solver-scip-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> SCIP_PARAMSETTING</span>
<span id="lst-solver-scip-3"><a href="#lst-solver-scip-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-solver-scip-4"><a href="#lst-solver-scip-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LpSolverSCIP:</span>
<span id="lst-solver-scip-5"><a href="#lst-solver-scip-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-6"><a href="#lst-solver-scip-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-scip-7"><a href="#lst-solver-scip-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> scip.Model(<span class="st">'LpModel'</span>)</span>
<span id="lst-solver-scip-8"><a href="#lst-solver-scip-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> verbose:</span>
<span id="lst-solver-scip-9"><a href="#lst-solver-scip-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.hideOutput()</span>
<span id="lst-solver-scip-10"><a href="#lst-solver-scip-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-11"><a href="#lst-solver-scip-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-solver-scip-12"><a href="#lst-solver-scip-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> {</span>
<span id="lst-solver-scip-13"><a href="#lst-solver-scip-13" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">'C'</span>)</span>
<span id="lst-solver-scip-14"><a href="#lst-solver-scip-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-15"><a href="#lst-solver-scip-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-solver-scip-16"><a href="#lst-solver-scip-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-scip-17"><a href="#lst-solver-scip-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-solver-scip-18"><a href="#lst-solver-scip-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(rhs)):</span>
<span id="lst-solver-scip-19"><a href="#lst-solver-scip-19" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> [</span>
<span id="lst-solver-scip-20"><a href="#lst-solver-scip-20" aria-hidden="true" tabindex="-1"></a>                constr_mat[c][j] <span class="op">*</span> <span class="va">self</span>._vars.get(j)</span>
<span id="lst-solver-scip-21"><a href="#lst-solver-scip-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-22"><a href="#lst-solver-scip-22" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="lst-solver-scip-23"><a href="#lst-solver-scip-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(scip.quicksum(expr) <span class="op">==</span> rhs[c])</span>
<span id="lst-solver-scip-24"><a href="#lst-solver-scip-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-solver-scip-25"><a href="#lst-solver-scip-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-solver-scip-26"><a href="#lst-solver-scip-26" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-solver-scip-27"><a href="#lst-solver-scip-27" aria-hidden="true" tabindex="-1"></a>            obj_coeff[i] <span class="op">*</span> <span class="va">self</span>._vars.get(i)</span>
<span id="lst-solver-scip-28"><a href="#lst-solver-scip-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-29"><a href="#lst-solver-scip-29" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-solver-scip-30"><a href="#lst-solver-scip-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(scip.quicksum(obj_expr), <span class="st">"minimize"</span>)</span>
<span id="lst-solver-scip-31"><a href="#lst-solver-scip-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-32"><a href="#lst-solver-scip-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>):</span>
<span id="lst-solver-scip-33"><a href="#lst-solver-scip-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-solver-scip-34"><a href="#lst-solver-scip-34" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">self</span>._model.getStatus()</span>
<span id="lst-solver-scip-35"><a href="#lst-solver-scip-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> status <span class="op">==</span> <span class="st">"optimal"</span>:</span>
<span id="lst-solver-scip-36"><a href="#lst-solver-scip-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal solution found!'</span>)</span>
<span id="lst-solver-scip-37"><a href="#lst-solver-scip-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_model<span class="sc">.</span>getObjVal()<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-solver-scip-38"><a href="#lst-solver-scip-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"unbounded"</span>:</span>
<span id="lst-solver-scip-39"><a href="#lst-solver-scip-39" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-solver-scip-40"><a href="#lst-solver-scip-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"infeasible"</span>:</span>
<span id="lst-solver-scip-41"><a href="#lst-solver-scip-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-solver-scip-42"><a href="#lst-solver-scip-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-solver-scip-43"><a href="#lst-solver-scip-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-lp-exp1" class="quarto-xref">Listing&nbsp;<span>4.3</span></a> generates a LP problem with 20 decision variables and 5 constraints.</p>
<div id="cell-37" class="cell" data-execution_count="106">
<div id="lst-lp-exp1" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-exp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.3: A randomly generated LP problem
</figcaption>
<div aria-describedby="lst-lp-exp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-exp1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp-exp1-1"><a href="#lst-lp-exp1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-lp-exp1-2"><a href="#lst-lp-exp1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp-exp1-3"><a href="#lst-lp-exp1-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="lst-lp-exp1-4"><a href="#lst-lp-exp1-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="lst-lp-exp1-5"><a href="#lst-lp-exp1-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">12</span>, size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">20</span>))</span>
<span id="lst-lp-exp1-6"><a href="#lst-lp-exp1-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.random.randint(<span class="dv">20</span>, <span class="dv">100</span>, size<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-lp-solver-gurobi-test1" class="quarto-xref">Listing&nbsp;<span>4.4</span></a> solves the generated LP using <code>LpSolverGurobi</code> and the solver output shows that an optimal solution was found with objective value of 36.90.</p>
<div id="cell-39" class="cell" data-execution_count="107">
<div id="lst-lp-solver-gurobi-test1" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-solver-gurobi-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.4: Solving the generated LP with Gurobi
</figcaption>
<div aria-describedby="lst-lp-solver-gurobi-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-solver-gurobi-test1"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-lp-solver-gurobi-test1-1"><a href="#lst-lp-solver-gurobi-test1-1" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi <span class="op">=</span> LpSolverGurobi(obj_coeff<span class="op">=</span>c, constr_mat<span class="op">=</span>A, rhs<span class="op">=</span>b)</span>
<span id="lst-lp-solver-gurobi-test1-2"><a href="#lst-lp-solver-gurobi-test1-2" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 36.90</code></pre>
</div>
</div>
<p><a href="#lst-lp-solver-scip-test1" class="quarto-xref">Listing&nbsp;<span>4.5</span></a> solves the same LP problem using SCIP and not surprisingly, the same optimal objective value was found. This is not exciting, as it only indicates that the two solvers agree on the optimal solution on such a small LP problem as expected. However, they will become more useful in the following sections when we use them to validate our Benders decomposition results.</p>
<div id="cell-41" class="cell" data-execution_count="108">
<div id="lst-lp-solver-scip-test1" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-solver-scip-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.5: Solving the generated LP with SCIP
</figcaption>
<div aria-describedby="lst-lp-solver-scip-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-solver-scip-test1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp-solver-scip-test1-1"><a href="#lst-lp-solver-scip-test1-1" aria-hidden="true" tabindex="-1"></a>lpsolver_scip <span class="op">=</span> LpSolverSCIP(obj_coeff<span class="op">=</span>c, constr_mat<span class="op">=</span>A, rhs<span class="op">=</span>b)</span>
<span id="lst-lp-solver-scip-test1-2"><a href="#lst-lp-solver-scip-test1-2" aria-hidden="true" tabindex="-1"></a>lpsolver_scip.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 36.90</code></pre>
</div>
</div>
</section>
<section id="a-serious-lp-problem-that-cannot-wait-to-be-decomposed" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="a-serious-lp-problem-that-cannot-wait-to-be-decomposed"><span class="header-section-number">4.2.2</span> A serious LP problem that cannot wait to be decomposed!</h3>
<p>With the validation tools available for use, we are ready to solve some serious LP problems using Benders decomposition! What we have below is a LP problem with five decision variables, three of which are denoted by <span class="math inline">\(\mathbf{x} = (x_1, x_2, x_3)\)</span> and the remaining two variables are denoted by <span class="math inline">\(\mathbf{y} = (y_1, y_2)\)</span>. We assume that <span class="math inline">\(\mathbf{y}\)</span> are the complicating variables.</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 8x_1 + 12x_2 +10x_3 + 15y_1 + 18y_2 \\
    \text{s.t.} &amp;\quad 2x_1 + 3x_2 + 2x_3 + 4y_1 + 5y_2 = 300 \\
    &amp;\quad 4x_1 + 2x_2 + 3x_3 + 2y_1 + 3y_2 = 220 \\
    &amp;\quad x_i \geq 0, \ \forall i = 1, \cdots, 3 \\
    &amp;\quad y_i \geq 0, \ \forall j = 1, 2
\end{align*}\]</span></p>
<p>According to the standard LP form presented in the previous section, <span class="math inline">\(\mathbf{c}^T = (8, 12, 10)\)</span>, <span class="math inline">\(\mathbf{f}^T = (15, 18)\)</span> and <span class="math inline">\(\mathbf{b}^T = (300, 220)\)</span>. In addition,</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{A} =
\begin{bmatrix}
    2 &amp; 3 &amp; 2 \\
    4 &amp; 2 &amp; 3 \\
\end{bmatrix}
\qquad
\mathbf{B} =
\begin{bmatrix}
    4 &amp; 5 \\
    2 &amp; 3 \\
\end{bmatrix}
\end{equation*}\]</span></p>
<p><a href="#lst-lp2" class="quarto-xref">Listing&nbsp;<span>4.6</span></a> solves the LP problem using the two solvers define above. Both solvers confirm the optimal objective value is 1091.43. With this information in mind, we will apply Benders decomposition to see if the same optimal solution could be identified or not.</p>
<div id="cell-48" class="cell" data-execution_count="282">
<div id="lst-lp2" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.6: Solve the LP problem with Gurobi and SCIP
</figcaption>
<div aria-describedby="lst-lp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp2-1"><a href="#lst-lp2-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">10</span>])</span>
<span id="lst-lp2-2"><a href="#lst-lp2-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.array([<span class="dv">15</span>, <span class="dv">18</span>])</span>
<span id="lst-lp2-3"><a href="#lst-lp2-3" aria-hidden="true" tabindex="-1"></a>obj_coeff <span class="op">=</span> np.concatenate([c, f])</span>
<span id="lst-lp2-4"><a href="#lst-lp2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-5"><a href="#lst-lp2-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="lst-lp2-6"><a href="#lst-lp2-6" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-lp2-7"><a href="#lst-lp2-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([[<span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="lst-lp2-8"><a href="#lst-lp2-8" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-lp2-9"><a href="#lst-lp2-9" aria-hidden="true" tabindex="-1"></a>constr_mat <span class="op">=</span> np.concatenate([A, B], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="lst-lp2-10"><a href="#lst-lp2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-11"><a href="#lst-lp2-11" aria-hidden="true" tabindex="-1"></a>rhs <span class="op">=</span> np.array([<span class="dv">300</span>, <span class="dv">220</span>])</span>
<span id="lst-lp2-12"><a href="#lst-lp2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-13"><a href="#lst-lp2-13" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi <span class="op">=</span> LpSolverGurobi(obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="lst-lp2-14"><a href="#lst-lp2-14" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi.optimize()</span>
<span id="lst-lp2-15"><a href="#lst-lp2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal objective = 1091.43</span></span>
<span id="lst-lp2-16"><a href="#lst-lp2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-17"><a href="#lst-lp2-17" aria-hidden="true" tabindex="-1"></a>lpsolver_scip <span class="op">=</span> LpSolverSCIP(obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="lst-lp2-18"><a href="#lst-lp2-18" aria-hidden="true" tabindex="-1"></a>lpsolver_scip.optimize()</span>
<span id="lst-lp2-19"><a href="#lst-lp2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal objective = 1091.43</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 1091.43
Optimal solution found!
Optimal objective = 1091.43</code></pre>
</div>
</div>
</section>
<section id="benders-decomposition-formulations" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="benders-decomposition-formulations"><span class="header-section-number">4.2.3</span> Benders decomposition formulations</h3>
<p>With <span class="math inline">\(\mathbf{y}\)</span> being the complicating variable, we state the Benders subproblem (<strong>SP</strong>) below for the <span class="math inline">\(\mathbf{y}\)</span> assuming fixed values <span class="math inline">\(\mathbf{\bar{y}} = (\bar{y_1}, \bar{y_2})\)</span>:</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 8x_1 + 12x_2 +10x_3 \\
    \text{s.t.} &amp;\quad 2x_1 + 3x_2 + 2x_3 = 300 - 4\bar{y_1} - 5\bar{y_2} \\
    &amp;\quad 4x_1 + 2x_2 + 3x_3 = 220 - 2\bar{y_1} - 3\bar{y_2} \\
    &amp;\quad x_i \geq 0, \ \forall i = 1, \cdots, 3
\end{align*}\]</span></p>
<p>We define the dual variable <span class="math inline">\(\mathbf{u} = (u_1, u_2)\)</span> to associate with the constraints in the (<strong>SP</strong>). The dual subproblem (<strong>DSP</strong>) could then be stated as follows:</p>
<p><span class="math display">\[\begin{align*}
    \text{max.} &amp;\quad (300 - 4\bar{y_1} - 5\bar{y_2}) u_1 + (220 - 2\bar{y_1} - 3\bar{y_2}) u_2 \\
    \text{s.t.} &amp;\quad 2u_1 + 4u_2 \leq 8\\
    &amp;\quad 3u_1 + 2u_2 \leq 12 \\
    &amp;\quad 2u_1 + 3u_2 \leq 10 \\
    &amp;\quad u_1, u_2\  \text{unrestricted}
\end{align*}\]</span></p>
<p>The (<strong>RBMP</strong>) can be stated as below. Note that <span class="math inline">\(\mathbf{u} = (0, 0)\)</span> is a feasible solution to (<strong>DSP</strong>) and the corresponding objective value is 0, which is the reason we restrict the variable <span class="math inline">\(g\)</span> to be nonnegative.</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 15 y_1 + 18 y_2 + g \\
    \text{s.t.} &amp;\quad  y_1, y_2 \geq 0 \\
    &amp;\quad g \geq 0
\end{align*}\]</span></p>
</section>
<section id="benders-decomposition-step-by-step" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="benders-decomposition-step-by-step"><span class="header-section-number">4.2.4</span> Benders decomposition step by step</h3>
<p>Benders decomposition defines a problem solving process in which the restricted Benders master problem and the dual subproblem interact iteratively to identify the optimal solution or conclude infeasibility/unboundedness. To facilitate our understanding of the process, we demonstrate in this section the workings of Benders decomposition by solving the target LP problem step by step.</p>
<p><a href="#lst-bd-rbmp" class="quarto-xref">Listing&nbsp;<span>4.7</span></a> shows the codes that initialize the lower bound <code>lb</code>, upper bound <code>ub</code> and threshold value <code>eps</code>. Furthermore, the restricted Benders master problem <code>rbmp</code> is created with three variables and a minimizing objective function. Note that no constraints are yet included in the model at this moment.</p>
<div id="cell-59" class="cell" data-execution_count="283">
<div id="lst-bd-rbmp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.7: Gurobi solver setup and restricted master problem initialization
</figcaption>
<div aria-describedby="lst-bd-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-rbmp"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-bd-rbmp-1"><a href="#lst-bd-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-bd-rbmp-2"><a href="#lst-bd-rbmp-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-bd-rbmp-3"><a href="#lst-bd-rbmp-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-bd-rbmp-4"><a href="#lst-bd-rbmp-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-5"><a href="#lst-bd-rbmp-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize lower/upper bounds and threshold value</span></span>
<span id="lst-bd-rbmp-6"><a href="#lst-bd-rbmp-6" aria-hidden="true" tabindex="-1"></a>lb <span class="op">=</span> <span class="op">-</span>GRB.INFINITY</span>
<span id="lst-bd-rbmp-7"><a href="#lst-bd-rbmp-7" aria-hidden="true" tabindex="-1"></a>ub <span class="op">=</span> GRB.INFINITY</span>
<span id="lst-bd-rbmp-8"><a href="#lst-bd-rbmp-8" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-bd-rbmp-9"><a href="#lst-bd-rbmp-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-10"><a href="#lst-bd-rbmp-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create restricted Benders master problem</span></span>
<span id="lst-bd-rbmp-11"><a href="#lst-bd-rbmp-11" aria-hidden="true" tabindex="-1"></a>env <span class="op">=</span> gp.Env(<span class="st">'benders'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-bd-rbmp-12"><a href="#lst-bd-rbmp-12" aria-hidden="true" tabindex="-1"></a>env.setParam(<span class="st">'OutputFlag'</span>, <span class="dv">0</span>)</span>
<span id="lst-bd-rbmp-13"><a href="#lst-bd-rbmp-13" aria-hidden="true" tabindex="-1"></a>env.start()</span>
<span id="lst-bd-rbmp-14"><a href="#lst-bd-rbmp-14" aria-hidden="true" tabindex="-1"></a>rbmp <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'RBMP'</span>)</span>
<span id="lst-bd-rbmp-15"><a href="#lst-bd-rbmp-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-16"><a href="#lst-bd-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create decision variables</span></span>
<span id="lst-bd-rbmp-17"><a href="#lst-bd-rbmp-17" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y1'</span>)</span>
<span id="lst-bd-rbmp-18"><a href="#lst-bd-rbmp-18" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y2'</span>)</span>
<span id="lst-bd-rbmp-19"><a href="#lst-bd-rbmp-19" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-bd-rbmp-20"><a href="#lst-bd-rbmp-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-21"><a href="#lst-bd-rbmp-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create objective</span></span>
<span id="lst-bd-rbmp-22"><a href="#lst-bd-rbmp-22" aria-hidden="true" tabindex="-1"></a>rbmp.setObjective(<span class="dv">15</span><span class="op">*</span>y1 <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2 <span class="op">+</span> g, GRB.MINIMIZE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-dsp" class="quarto-xref">Listing&nbsp;<span>4.8</span></a> initializes the Benders subproblem with two decision variables and three constraints.</p>
<div id="cell-61" class="cell" data-execution_count="286">
<div id="lst-bd-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.8: Dual subproblem initialization
</figcaption>
<div aria-describedby="lst-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-dsp-1"><a href="#lst-bd-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dual subproblem</span></span>
<span id="lst-bd-dsp-2"><a href="#lst-bd-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'DSP'</span>)</span>
<span id="lst-bd-dsp-3"><a href="#lst-bd-dsp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-4"><a href="#lst-bd-dsp-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create decision variables</span></span>
<span id="lst-bd-dsp-5"><a href="#lst-bd-dsp-5" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> dsp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-dsp-6"><a href="#lst-bd-dsp-6" aria-hidden="true" tabindex="-1"></a>                lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-7"><a href="#lst-bd-dsp-7" aria-hidden="true" tabindex="-1"></a>                ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-8"><a href="#lst-bd-dsp-8" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'u1'</span>)</span>
<span id="lst-bd-dsp-9"><a href="#lst-bd-dsp-9" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> dsp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-dsp-10"><a href="#lst-bd-dsp-10" aria-hidden="true" tabindex="-1"></a>                lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-11"><a href="#lst-bd-dsp-11" aria-hidden="true" tabindex="-1"></a>                ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-12"><a href="#lst-bd-dsp-12" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'u2'</span>)</span>
<span id="lst-bd-dsp-13"><a href="#lst-bd-dsp-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-14"><a href="#lst-bd-dsp-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create objective function</span></span>
<span id="lst-bd-dsp-15"><a href="#lst-bd-dsp-15" aria-hidden="true" tabindex="-1"></a>dsp.setObjective(<span class="dv">300</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">220</span><span class="op">*</span>u2)</span>
<span id="lst-bd-dsp-16"><a href="#lst-bd-dsp-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-17"><a href="#lst-bd-dsp-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create constraints</span></span>
<span id="lst-bd-dsp-18"><a href="#lst-bd-dsp-18" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">2</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">8</span>, name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-dsp-19"><a href="#lst-bd-dsp-19" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">3</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">12</span>, name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-dsp-20"><a href="#lst-bd-dsp-20" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">2</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">10</span>, name<span class="op">=</span><span class="st">'c3'</span>)</span>
<span id="lst-bd-dsp-21"><a href="#lst-bd-dsp-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-22"><a href="#lst-bd-dsp-22" aria-hidden="true" tabindex="-1"></a>dsp.update()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>In <a href="#lst-bd-iter1-rbmp" class="quarto-xref">Listing&nbsp;<span>4.9</span></a>, we solve the (<strong>RBMP</strong>) for the first time. It has an optimal solution with <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 0, 0)\)</span> and optimal objective value of 0. This is expected as all the variables assume their minimal possible values in order to minimize the objective function. This objective value also serves as the new lower bound.</p>
<div id="cell-63" class="cell" data-execution_count="287">
<div id="lst-bd-iter1-rbmp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter1-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.9: Iteration 1 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter1-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter1-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter1-rbmp-1"><a href="#lst-bd-iter1-rbmp-1" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter1-rbmp-2"><a href="#lst-bd-iter1-rbmp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter1-rbmp-3"><a href="#lst-bd-iter1-rbmp-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter1-rbmp-4"><a href="#lst-bd-iter1-rbmp-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-rbmp-5"><a href="#lst-bd-iter1-rbmp-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-rbmp-6"><a href="#lst-bd-iter1-rbmp-6" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter1-rbmp-7"><a href="#lst-bd-iter1-rbmp-7" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter1-rbmp-8"><a href="#lst-bd-iter1-rbmp-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-rbmp-9"><a href="#lst-bd-iter1-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter1-rbmp-10"><a href="#lst-bd-iter1-rbmp-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-rbmp-11"><a href="#lst-bd-iter1-rbmp-11" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter1-rbmp-12"><a href="#lst-bd-iter1-rbmp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 0.00
(y1, y2, g) = (0.00, 0.00, 0.00)
lb=0.0, ub=1e+100</code></pre>
</div>
</div>
<p>Given that <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 0, 0)\)</span>, we now feed the values of <span class="math inline">\(\bar{y_1}\)</span> and <span class="math inline">\(\bar{y_2}\)</span> into the Benders dual subproblem <strong>(DSP)</strong> by updating its objective function, as shown in <a href="#lst-bd-iter1-dsp" class="quarto-xref">Listing&nbsp;<span>4.10</span></a>:</p>
<div id="cell-65" class="cell" data-execution_count="288">
<div id="lst-bd-iter1-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter1-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.10: Iteration 1 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter1-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter1-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter1-dsp-1"><a href="#lst-bd-iter1-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter1-dsp-2"><a href="#lst-bd-iter1-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 <span class="op">+</span> </span>
<span id="lst-bd-iter1-dsp-3"><a href="#lst-bd-iter1-dsp-3" aria-hidden="true" tabindex="-1"></a>                 (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter1-dsp-4"><a href="#lst-bd-iter1-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter1-dsp-5"><a href="#lst-bd-iter1-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter1-dsp-6"><a href="#lst-bd-iter1-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter1-dsp-7"><a href="#lst-bd-iter1-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter1-dsp-8"><a href="#lst-bd-iter1-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter1-dsp-9"><a href="#lst-bd-iter1-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter1-dsp-10"><a href="#lst-bd-iter1-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-dsp-11"><a href="#lst-bd-iter1-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-dsp-12"><a href="#lst-bd-iter1-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter1-dsp-13"><a href="#lst-bd-iter1-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter1-dsp-14"><a href="#lst-bd-iter1-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal objective = 1200.00
(u1, u2) = (4.00, 0.00)
lb=0.0, ub=1200.0</code></pre>
</div>
</div>
<p>We see that the dual subproblem has an optimal solution. The upper bound <code>ub</code> is also updated. Since the optimal objective value of the subproblem turns out to be 1200 and is greater than <span class="math inline">\(\bar{g} = 0\)</span>, which implies that an optimality cut is needed to make sure that the variable <span class="math inline">\(g\)</span> in the restricted Benders master problem reflects this newly obtained information from the subproblem.</p>
<p>In <a href="#lst-bd-iter2-rbmp" class="quarto-xref">Listing&nbsp;<span>4.11</span></a>, the new optimality cut is added to the (<strong>RBMP</strong>), which is then solved to optimality.</p>
<div id="cell-68" class="cell" data-execution_count="289">
<div id="lst-bd-iter2-rbmp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter2-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.11: Iteration 2 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter2-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter2-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter2-rbmp-1"><a href="#lst-bd-iter2-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add optimality cut</span></span>
<span id="lst-bd-iter2-rbmp-2"><a href="#lst-bd-iter2-rbmp-2" aria-hidden="true" tabindex="-1"></a>rbmp.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2)<span class="op">*</span>u1_opt </span>
<span id="lst-bd-iter2-rbmp-3"><a href="#lst-bd-iter2-rbmp-3" aria-hidden="true" tabindex="-1"></a>               <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2)<span class="op">*</span>u2_opt <span class="op">&lt;=</span> g, </span>
<span id="lst-bd-iter2-rbmp-4"><a href="#lst-bd-iter2-rbmp-4" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-iter2-rbmp-5"><a href="#lst-bd-iter2-rbmp-5" aria-hidden="true" tabindex="-1"></a>rbmp.update()</span>
<span id="lst-bd-iter2-rbmp-6"><a href="#lst-bd-iter2-rbmp-6" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter2-rbmp-7"><a href="#lst-bd-iter2-rbmp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter2-rbmp-8"><a href="#lst-bd-iter2-rbmp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter2-rbmp-9"><a href="#lst-bd-iter2-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-rbmp-10"><a href="#lst-bd-iter2-rbmp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-rbmp-11"><a href="#lst-bd-iter2-rbmp-11" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter2-rbmp-12"><a href="#lst-bd-iter2-rbmp-12" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter2-rbmp-13"><a href="#lst-bd-iter2-rbmp-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-rbmp-14"><a href="#lst-bd-iter2-rbmp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-rbmp-15"><a href="#lst-bd-iter2-rbmp-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-rbmp-16"><a href="#lst-bd-iter2-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter2-rbmp-17"><a href="#lst-bd-iter2-rbmp-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 1080.00
(y1, y2, g) = (0.00, 60.00, 0.00)
lb=1080.0, ub=1200.0</code></pre>
</div>
</div>
<p>Armed with the optimal solution <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 60, 0)\)</span>, <a href="#lst-bd-iter2-dsp" class="quarto-xref">Listing&nbsp;<span>4.12</span></a> updates the objective function of the (<strong>DSP</strong>) and obtains its optimal solution.</p>
<div id="cell-70" class="cell" data-execution_count="293">
<div id="lst-bd-iter2-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter2-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.12: Iteration 2 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter2-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter2-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter2-dsp-1"><a href="#lst-bd-iter2-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter2-dsp-2"><a href="#lst-bd-iter2-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 </span>
<span id="lst-bd-iter2-dsp-3"><a href="#lst-bd-iter2-dsp-3" aria-hidden="true" tabindex="-1"></a>                 <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter2-dsp-4"><a href="#lst-bd-iter2-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter2-dsp-5"><a href="#lst-bd-iter2-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter2-dsp-6"><a href="#lst-bd-iter2-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter2-dsp-7"><a href="#lst-bd-iter2-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter2-dsp-8"><a href="#lst-bd-iter2-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter2-dsp-9"><a href="#lst-bd-iter2-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter2-dsp-10"><a href="#lst-bd-iter2-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-dsp-11"><a href="#lst-bd-iter2-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-dsp-12"><a href="#lst-bd-iter2-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-dsp-13"><a href="#lst-bd-iter2-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter2-dsp-14"><a href="#lst-bd-iter2-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-dsp-15"><a href="#lst-bd-iter2-dsp-15" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> dsp.Status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-bd-iter2-dsp-16"><a href="#lst-bd-iter2-dsp-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'DSP is unbounded!'</span>)</span>
<span id="lst-bd-iter2-dsp-17"><a href="#lst-bd-iter2-dsp-17" aria-hidden="true" tabindex="-1"></a>    u1_ray <span class="op">=</span> u1.UnbdRay</span>
<span id="lst-bd-iter2-dsp-18"><a href="#lst-bd-iter2-dsp-18" aria-hidden="true" tabindex="-1"></a>    u2_ray <span class="op">=</span> u2.UnbdRay</span>
<span id="lst-bd-iter2-dsp-19"><a href="#lst-bd-iter2-dsp-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'retrieve extreme ray (u1, u2) = (</span><span class="sc">{</span>u1_ray<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>u2_ray<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-dsp-20"><a href="#lst-bd-iter2-dsp-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="lst-bd-iter2-dsp-21"><a href="#lst-bd-iter2-dsp-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'DSP solve error'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>DSP is unbounded!
retrieve extreme ray (u1, u2) = (-2.0, 1.0)</code></pre>
</div>
</div>
<p>Since the dual subproblem is unbounded, a feasibility cut is further needed. In <a href="#lst-bd-iter3-rbmp" class="quarto-xref">Listing&nbsp;<span>4.13</span></a>, we add the new cut and solve the restricted Benders master problem again.</p>
<div id="cell-72" class="cell" data-execution_count="294">
<div id="lst-bd-iter3-rbmp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter3-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.13: Iteration 3 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter3-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter3-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter3-rbmp-1"><a href="#lst-bd-iter3-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add optimality cut</span></span>
<span id="lst-bd-iter3-rbmp-2"><a href="#lst-bd-iter3-rbmp-2" aria-hidden="true" tabindex="-1"></a>rbmp.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2)<span class="op">*</span>u1_ray</span>
<span id="lst-bd-iter3-rbmp-3"><a href="#lst-bd-iter3-rbmp-3" aria-hidden="true" tabindex="-1"></a>               <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2)<span class="op">*</span>u2_ray <span class="op">&lt;=</span> <span class="dv">0</span>, </span>
<span id="lst-bd-iter3-rbmp-4"><a href="#lst-bd-iter3-rbmp-4" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-iter3-rbmp-5"><a href="#lst-bd-iter3-rbmp-5" aria-hidden="true" tabindex="-1"></a>rbmp.update()</span>
<span id="lst-bd-iter3-rbmp-6"><a href="#lst-bd-iter3-rbmp-6" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter3-rbmp-7"><a href="#lst-bd-iter3-rbmp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter3-rbmp-8"><a href="#lst-bd-iter3-rbmp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter3-rbmp-9"><a href="#lst-bd-iter3-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-rbmp-10"><a href="#lst-bd-iter3-rbmp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-rbmp-11"><a href="#lst-bd-iter3-rbmp-11" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter3-rbmp-12"><a href="#lst-bd-iter3-rbmp-12" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter3-rbmp-13"><a href="#lst-bd-iter3-rbmp-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-rbmp-14"><a href="#lst-bd-iter3-rbmp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter3-rbmp-15"><a href="#lst-bd-iter3-rbmp-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-rbmp-16"><a href="#lst-bd-iter3-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter3-rbmp-17"><a href="#lst-bd-iter3-rbmp-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 1091.43
(y1, y2, g) = (0.00, 54.29, 114.29)
lb=1091.43, ub=1200.00</code></pre>
</div>
</div>
<p>Note that a new lower bound is obtained after solving the master problem. Since there is still a large gap between the lower bound and upper bound, we continue solving the subproblem in <a href="#lst-bd-iter3-dsp" class="quarto-xref">Listing&nbsp;<span>4.14</span></a>.</p>
<div id="cell-74" class="cell" data-execution_count="295">
<div id="lst-bd-iter3-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter3-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.14: Iteration 3 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter3-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter3-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter3-dsp-1"><a href="#lst-bd-iter3-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter3-dsp-2"><a href="#lst-bd-iter3-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 </span>
<span id="lst-bd-iter3-dsp-3"><a href="#lst-bd-iter3-dsp-3" aria-hidden="true" tabindex="-1"></a>                 <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter3-dsp-4"><a href="#lst-bd-iter3-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter3-dsp-5"><a href="#lst-bd-iter3-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter3-dsp-6"><a href="#lst-bd-iter3-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter3-dsp-7"><a href="#lst-bd-iter3-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter3-dsp-8"><a href="#lst-bd-iter3-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter3-dsp-9"><a href="#lst-bd-iter3-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter3-dsp-10"><a href="#lst-bd-iter3-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-dsp-11"><a href="#lst-bd-iter3-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-dsp-12"><a href="#lst-bd-iter3-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter3-dsp-13"><a href="#lst-bd-iter3-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter3-dsp-14"><a href="#lst-bd-iter3-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal objective = 114.29
(u1, u2) = (4.00, 0.00)
lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
<p>Now that the difference between <code>lb</code> and <code>ub</code> is less than the preset threshold <code>eps</code>, we conclude that an optimal solution is reached and the computation resources are freed up.</p>
<div id="cell-76" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># release resources</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>rbmp.dispose()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dsp.dispose()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>env.dispose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="putting-it-together" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="putting-it-together"><span class="header-section-number">4.2.5</span> Putting it together</h3>
<p>It typically takes Benders decomposition many iterations to reach optimality or conclude infeasibility/unboundedness. In this section, we put everything we have learned from the manual approach above into an automatic workflow.</p>
<p><a href="#lst-bd-whole-status" class="quarto-xref">Listing&nbsp;<span>4.15</span></a> defines an <code>Enum</code> class that specifies four possible optimization statuses. The meanings of these statuses are self-explanatory from their corresponding names and further explanations are omitted here.</p>
<div id="cell-80" class="cell" data-execution_count="143">
<div id="lst-bd-whole-status" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-status-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.15: Optimization status
</figcaption>
<div aria-describedby="lst-bd-whole-status-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-status"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-status-1"><a href="#lst-bd-whole-status-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-bd-whole-status-2"><a href="#lst-bd-whole-status-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-bd-whole-status-3"><a href="#lst-bd-whole-status-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-bd-whole-status-4"><a href="#lst-bd-whole-status-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="lst-bd-whole-status-5"><a href="#lst-bd-whole-status-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-status-6"><a href="#lst-bd-whole-status-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OptStatus(Enum):</span>
<span id="lst-bd-whole-status-7"><a href="#lst-bd-whole-status-7" aria-hidden="true" tabindex="-1"></a>    OPTIMAL <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-bd-whole-status-8"><a href="#lst-bd-whole-status-8" aria-hidden="true" tabindex="-1"></a>    UNBOUNDED <span class="op">=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-status-9"><a href="#lst-bd-whole-status-9" aria-hidden="true" tabindex="-1"></a>    INFEASIBLE <span class="op">=</span> <span class="dv">2</span></span>
<span id="lst-bd-whole-status-10"><a href="#lst-bd-whole-status-10" aria-hidden="true" tabindex="-1"></a>    ERROR <span class="op">=</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-master" class="quarto-xref">Listing&nbsp;<span>4.16</span></a> defines a <code>MasterSolver</code> class that models the (<strong>RBMP</strong>). Its constructor contains the variable and objective function definitions. The ability to take in either feasibility or optimality cuts is implemented in separate functions <code>add_feasibility_cut()</code> and <code>add_optimality_cut()</code>, respectively. The <code>solve()</code> function is responsible for optimizing the model and retrieve the optimal solution if any.</p>
<div id="cell-82" class="cell" data-execution_count="298">
<div id="lst-bd-whole-master" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.16: Restricted Benders master model
</figcaption>
<div aria-describedby="lst-bd-whole-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-master"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-master-1"><a href="#lst-bd-whole-master-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MasterSolver:</span>
<span id="lst-bd-whole-master-2"><a href="#lst-bd-whole-master-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-3"><a href="#lst-bd-whole-master-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, env):</span>
<span id="lst-bd-whole-master-4"><a href="#lst-bd-whole-master-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'RBMP'</span>)</span>
<span id="lst-bd-whole-master-5"><a href="#lst-bd-whole-master-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-6"><a href="#lst-bd-whole-master-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-bd-whole-master-7"><a href="#lst-bd-whole-master-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y1 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-8"><a href="#lst-bd-whole-master-8" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y1'</span>)</span>
<span id="lst-bd-whole-master-9"><a href="#lst-bd-whole-master-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y2 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-10"><a href="#lst-bd-whole-master-10" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y2'</span>)</span>
<span id="lst-bd-whole-master-11"><a href="#lst-bd-whole-master-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-12"><a href="#lst-bd-whole-master-12" aria-hidden="true" tabindex="-1"></a>                                     lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-bd-whole-master-13"><a href="#lst-bd-whole-master-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-master-14"><a href="#lst-bd-whole-master-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-bd-whole-master-15"><a href="#lst-bd-whole-master-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="dv">15</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">+</span><span class="dv">18</span><span class="op">*</span><span class="va">self</span>._y2<span class="op">+</span><span class="va">self</span>._g, </span>
<span id="lst-bd-whole-master-16"><a href="#lst-bd-whole-master-16" aria-hidden="true" tabindex="-1"></a>                                 GRB.MINIMIZE)</span>
<span id="lst-bd-whole-master-17"><a href="#lst-bd-whole-master-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-18"><a href="#lst-bd-whole-master-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-19"><a href="#lst-bd-whole-master-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-20"><a href="#lst-bd-whole-master-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-21"><a href="#lst-bd-whole-master-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-22"><a href="#lst-bd-whole-master-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-23"><a href="#lst-bd-whole-master-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-bd-whole-master-24"><a href="#lst-bd-whole-master-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-master-25"><a href="#lst-bd-whole-master-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="lst-bd-whole-master-26"><a href="#lst-bd-whole-master-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-bd-whole-master-27"><a href="#lst-bd-whole-master-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-28"><a href="#lst-bd-whole-master-28" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-29"><a href="#lst-bd-whole-master-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-whole-master-30"><a href="#lst-bd-whole-master-30" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-bd-whole-master-31"><a href="#lst-bd-whole-master-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-bd-whole-master-32"><a href="#lst-bd-whole-master-32" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y1 <span class="op">=</span> <span class="va">self</span>._y1.X</span>
<span id="lst-bd-whole-master-33"><a href="#lst-bd-whole-master-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y2 <span class="op">=</span> <span class="va">self</span>._y2.X</span>
<span id="lst-bd-whole-master-34"><a href="#lst-bd-whole-master-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._g.X</span>
<span id="lst-bd-whole-master-35"><a href="#lst-bd-whole-master-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="lst-bd-whole-master-36"><a href="#lst-bd-whole-master-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-37"><a href="#lst-bd-whole-master-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y1=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y1<span class="sc">:.2f}</span><span class="ss">, opt_y2=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y2<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-38"><a href="#lst-bd-whole-master-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-39"><a href="#lst-bd-whole-master-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-whole-master-40"><a href="#lst-bd-whole-master-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="lst-bd-whole-master-41"><a href="#lst-bd-whole-master-41" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="lst-bd-whole-master-42"><a href="#lst-bd-whole-master-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-bd-whole-master-43"><a href="#lst-bd-whole-master-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="lst-bd-whole-master-44"><a href="#lst-bd-whole-master-44" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-bd-whole-master-45"><a href="#lst-bd-whole-master-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-46"><a href="#lst-bd-whole-master-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="lst-bd-whole-master-47"><a href="#lst-bd-whole-master-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-master-48"><a href="#lst-bd-whole-master-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="lst-bd-whole-master-49"><a href="#lst-bd-whole-master-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-50"><a href="#lst-bd-whole-master-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u1, ray_u2) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-bd-whole-master-51"><a href="#lst-bd-whole-master-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>ray_u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-master-52"><a href="#lst-bd-whole-master-52" aria-hidden="true" tabindex="-1"></a>                              (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>ray_u2 <span class="op">&lt;=</span> </span>
<span id="lst-bd-whole-master-53"><a href="#lst-bd-whole-master-53" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">0</span>)</span>
<span id="lst-bd-whole-master-54"><a href="#lst-bd-whole-master-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="lst-bd-whole-master-55"><a href="#lst-bd-whole-master-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-56"><a href="#lst-bd-whole-master-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u1, opt_u2) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-bd-whole-master-57"><a href="#lst-bd-whole-master-57" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>opt_u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-master-58"><a href="#lst-bd-whole-master-58" aria-hidden="true" tabindex="-1"></a>                              (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>opt_u2 <span class="op">&lt;=</span> </span>
<span id="lst-bd-whole-master-59"><a href="#lst-bd-whole-master-59" aria-hidden="true" tabindex="-1"></a>                              <span class="va">self</span>._g)</span>
<span id="lst-bd-whole-master-60"><a href="#lst-bd-whole-master-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="lst-bd-whole-master-61"><a href="#lst-bd-whole-master-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-62"><a href="#lst-bd-whole-master-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-63"><a href="#lst-bd-whole-master-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-bd-whole-master-64"><a href="#lst-bd-whole-master-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-65"><a href="#lst-bd-whole-master-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-66"><a href="#lst-bd-whole-master-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-67"><a href="#lst-bd-whole-master-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-bd-whole-master-68"><a href="#lst-bd-whole-master-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-69"><a href="#lst-bd-whole-master-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-70"><a href="#lst-bd-whole-master-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-71"><a href="#lst-bd-whole-master-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y1</span>
<span id="lst-bd-whole-master-72"><a href="#lst-bd-whole-master-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-73"><a href="#lst-bd-whole-master-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-74"><a href="#lst-bd-whole-master-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-75"><a href="#lst-bd-whole-master-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y2</span>
<span id="lst-bd-whole-master-76"><a href="#lst-bd-whole-master-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-77"><a href="#lst-bd-whole-master-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-78"><a href="#lst-bd-whole-master-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-79"><a href="#lst-bd-whole-master-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-dsp" class="quarto-xref">Listing&nbsp;<span>4.17</span></a> defines the Benders dual subproblem in a similar fashion. Notice that the <code>update_objective()</code> function is used to set an updated objective function based on the optimal solution identified in the restricted Benders master problem.</p>
<div id="cell-84" class="cell" data-execution_count="301">
<div id="lst-bd-whole-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.17: Dual subproblem model
</figcaption>
<div aria-describedby="lst-bd-whole-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-dsp-1"><a href="#lst-bd-whole-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DualSubprobSolver:</span>
<span id="lst-bd-whole-dsp-2"><a href="#lst-bd-whole-dsp-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-3"><a href="#lst-bd-whole-dsp-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, env):</span>
<span id="lst-bd-whole-dsp-4"><a href="#lst-bd-whole-dsp-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'DSP'</span>)</span>
<span id="lst-bd-whole-dsp-5"><a href="#lst-bd-whole-dsp-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-6"><a href="#lst-bd-whole-dsp-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-bd-whole-dsp-7"><a href="#lst-bd-whole-dsp-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u1 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-whole-dsp-8"><a href="#lst-bd-whole-dsp-8" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-9"><a href="#lst-bd-whole-dsp-9" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-10"><a href="#lst-bd-whole-dsp-10" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u1'</span>)</span>
<span id="lst-bd-whole-dsp-11"><a href="#lst-bd-whole-dsp-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u2 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-whole-dsp-12"><a href="#lst-bd-whole-dsp-12" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-13"><a href="#lst-bd-whole-dsp-13" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-14"><a href="#lst-bd-whole-dsp-14" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u2'</span>)</span>
<span id="lst-bd-whole-dsp-15"><a href="#lst-bd-whole-dsp-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-16"><a href="#lst-bd-whole-dsp-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-bd-whole-dsp-17"><a href="#lst-bd-whole-dsp-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">8</span>, name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-whole-dsp-18"><a href="#lst-bd-whole-dsp-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">3</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">12</span>, name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-whole-dsp-19"><a href="#lst-bd-whole-dsp-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">10</span>, name<span class="op">=</span><span class="st">'c3'</span>)</span>
<span id="lst-bd-whole-dsp-20"><a href="#lst-bd-whole-dsp-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-21"><a href="#lst-bd-whole-dsp-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="dv">1</span>, GRB.MAXIMIZE)</span>
<span id="lst-bd-whole-dsp-22"><a href="#lst-bd-whole-dsp-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-bd-whole-dsp-23"><a href="#lst-bd-whole-dsp-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-24"><a href="#lst-bd-whole-dsp-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-25"><a href="#lst-bd-whole-dsp-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-26"><a href="#lst-bd-whole-dsp-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-27"><a href="#lst-bd-whole-dsp-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-28"><a href="#lst-bd-whole-dsp-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-29"><a href="#lst-bd-whole-dsp-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-30"><a href="#lst-bd-whole-dsp-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-31"><a href="#lst-bd-whole-dsp-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-dsp-32"><a href="#lst-bd-whole-dsp-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="lst-bd-whole-dsp-33"><a href="#lst-bd-whole-dsp-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-bd-whole-dsp-34"><a href="#lst-bd-whole-dsp-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-35"><a href="#lst-bd-whole-dsp-35" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-36"><a href="#lst-bd-whole-dsp-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-whole-dsp-37"><a href="#lst-bd-whole-dsp-37" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-bd-whole-dsp-38"><a href="#lst-bd-whole-dsp-38" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u1 <span class="op">=</span> <span class="va">self</span>._u1.X</span>
<span id="lst-bd-whole-dsp-39"><a href="#lst-bd-whole-dsp-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u2 <span class="op">=</span> <span class="va">self</span>._u2.X</span>
<span id="lst-bd-whole-dsp-40"><a href="#lst-bd-whole-dsp-40" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-bd-whole-dsp-41"><a href="#lst-bd-whole-dsp-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="lst-bd-whole-dsp-42"><a href="#lst-bd-whole-dsp-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-dsp-43"><a href="#lst-bd-whole-dsp-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y1=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u1<span class="sc">:.2f}</span><span class="ss">, opt_y2=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u2<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-dsp-44"><a href="#lst-bd-whole-dsp-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-bd-whole-dsp-45"><a href="#lst-bd-whole-dsp-45" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="lst-bd-whole-dsp-46"><a href="#lst-bd-whole-dsp-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is unbounded!'</span>)</span>
<span id="lst-bd-whole-dsp-47"><a href="#lst-bd-whole-dsp-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u1 <span class="op">=</span> <span class="va">self</span>._u1.UnbdRay</span>
<span id="lst-bd-whole-dsp-48"><a href="#lst-bd-whole-dsp-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u2 <span class="op">=</span> <span class="va">self</span>._u2.UnbdRay</span>
<span id="lst-bd-whole-dsp-49"><a href="#lst-bd-whole-dsp-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">extreme ray (u1, u2) = (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_ray_u1<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_ray_u2<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-whole-dsp-50"><a href="#lst-bd-whole-dsp-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-bd-whole-dsp-51"><a href="#lst-bd-whole-dsp-51" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-bd-whole-dsp-52"><a href="#lst-bd-whole-dsp-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-53"><a href="#lst-bd-whole-dsp-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="lst-bd-whole-dsp-54"><a href="#lst-bd-whole-dsp-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-dsp-55"><a href="#lst-bd-whole-dsp-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="lst-bd-whole-dsp-56"><a href="#lst-bd-whole-dsp-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-57"><a href="#lst-bd-whole-dsp-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y1, opt_y2):</span>
<span id="lst-bd-whole-dsp-58"><a href="#lst-bd-whole-dsp-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="lst-bd-whole-dsp-59"><a href="#lst-bd-whole-dsp-59" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>opt_y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>opt_y2)<span class="op">*</span><span class="va">self</span>._u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-dsp-60"><a href="#lst-bd-whole-dsp-60" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>opt_y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>opt_y2)<span class="op">*</span><span class="va">self</span>._u2, </span>
<span id="lst-bd-whole-dsp-61"><a href="#lst-bd-whole-dsp-61" aria-hidden="true" tabindex="-1"></a>            GRB.MAXIMIZE)</span>
<span id="lst-bd-whole-dsp-62"><a href="#lst-bd-whole-dsp-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="lst-bd-whole-dsp-63"><a href="#lst-bd-whole-dsp-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-64"><a href="#lst-bd-whole-dsp-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-65"><a href="#lst-bd-whole-dsp-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-bd-whole-dsp-66"><a href="#lst-bd-whole-dsp-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-67"><a href="#lst-bd-whole-dsp-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-68"><a href="#lst-bd-whole-dsp-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-69"><a href="#lst-bd-whole-dsp-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-bd-whole-dsp-70"><a href="#lst-bd-whole-dsp-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-71"><a href="#lst-bd-whole-dsp-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-72"><a href="#lst-bd-whole-dsp-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-73"><a href="#lst-bd-whole-dsp-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u1</span>
<span id="lst-bd-whole-dsp-74"><a href="#lst-bd-whole-dsp-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-75"><a href="#lst-bd-whole-dsp-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-76"><a href="#lst-bd-whole-dsp-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-77"><a href="#lst-bd-whole-dsp-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u2</span>
<span id="lst-bd-whole-dsp-78"><a href="#lst-bd-whole-dsp-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-79"><a href="#lst-bd-whole-dsp-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-80"><a href="#lst-bd-whole-dsp-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-81"><a href="#lst-bd-whole-dsp-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u1</span>
<span id="lst-bd-whole-dsp-82"><a href="#lst-bd-whole-dsp-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-83"><a href="#lst-bd-whole-dsp-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-84"><a href="#lst-bd-whole-dsp-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-85"><a href="#lst-bd-whole-dsp-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-workflow" class="quarto-xref">Listing&nbsp;<span>4.18</span></a> shows the control flow of Benders decomposition. The main logic is stated as a <code>while</code> loop, in which the master problem and dual subproblem are solved sequentially within each iteration. Depending on whether the subproblem is optimal or unbounded, an optimality or feasibility cut is added to the master problem. The process continues until the gap between the lower bound and the upper bound is within a certain threshold.</p>
<div id="cell-86" class="cell" data-execution_count="303">
<div id="lst-bd-whole-workflow" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.18: Benders decomposition control flow
</figcaption>
<div aria-describedby="lst-bd-whole-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-workflow"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-workflow-1"><a href="#lst-bd-whole-workflow-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BendersDecomposition:</span>
<span id="lst-bd-whole-workflow-2"><a href="#lst-bd-whole-workflow-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-workflow-3"><a href="#lst-bd-whole-workflow-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, master_solver, dual_subprob_solver):</span>
<span id="lst-bd-whole-workflow-4"><a href="#lst-bd-whole-workflow-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._master_solver <span class="op">=</span> master_solver</span>
<span id="lst-bd-whole-workflow-5"><a href="#lst-bd-whole-workflow-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dual_subprob_solver <span class="op">=</span> dual_subprob_solver</span>
<span id="lst-bd-whole-workflow-6"><a href="#lst-bd-whole-workflow-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-workflow-7"><a href="#lst-bd-whole-workflow-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-workflow-8"><a href="#lst-bd-whole-workflow-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-bd-whole-workflow-9"><a href="#lst-bd-whole-workflow-9" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-bd-whole-workflow-10"><a href="#lst-bd-whole-workflow-10" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="lst-bd-whole-workflow-11"><a href="#lst-bd-whole-workflow-11" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="lst-bd-whole-workflow-12"><a href="#lst-bd-whole-workflow-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-workflow-13"><a href="#lst-bd-whole-workflow-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-workflow-14"><a href="#lst-bd-whole-workflow-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="lst-bd-whole-workflow-15"><a href="#lst-bd-whole-workflow-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Iteration: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="lst-bd-whole-workflow-16"><a href="#lst-bd-whole-workflow-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-workflow-17"><a href="#lst-bd-whole-workflow-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve master problem</span></span>
<span id="lst-bd-whole-workflow-18"><a href="#lst-bd-whole-workflow-18" aria-hidden="true" tabindex="-1"></a>            master_status <span class="op">=</span> <span class="va">self</span>._master_solver.solve()</span>
<span id="lst-bd-whole-workflow-19"><a href="#lst-bd-whole-workflow-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> master_status <span class="op">==</span> OptStatus.INFEASIBLE:</span>
<span id="lst-bd-whole-workflow-20"><a href="#lst-bd-whole-workflow-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> OptStatus.INFEASIBLE</span>
<span id="lst-bd-whole-workflow-21"><a href="#lst-bd-whole-workflow-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-22"><a href="#lst-bd-whole-workflow-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update lower bound</span></span>
<span id="lst-bd-whole-workflow-23"><a href="#lst-bd-whole-workflow-23" aria-hidden="true" tabindex="-1"></a>            lb <span class="op">=</span> np.<span class="bu">max</span>([lb, <span class="va">self</span>._master_solver.opt_obj])</span>
<span id="lst-bd-whole-workflow-24"><a href="#lst-bd-whole-workflow-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-workflow-25"><a href="#lst-bd-whole-workflow-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-26"><a href="#lst-bd-whole-workflow-26" aria-hidden="true" tabindex="-1"></a>            opt_y1 <span class="op">=</span> <span class="va">self</span>._master_solver.opt_y1</span>
<span id="lst-bd-whole-workflow-27"><a href="#lst-bd-whole-workflow-27" aria-hidden="true" tabindex="-1"></a>            opt_y2 <span class="op">=</span> <span class="va">self</span>._master_solver.opt_y2</span>
<span id="lst-bd-whole-workflow-28"><a href="#lst-bd-whole-workflow-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-29"><a href="#lst-bd-whole-workflow-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve subproblem</span></span>
<span id="lst-bd-whole-workflow-30"><a href="#lst-bd-whole-workflow-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._dual_subprob_solver.update_objective(opt_y1, opt_y2)</span>
<span id="lst-bd-whole-workflow-31"><a href="#lst-bd-whole-workflow-31" aria-hidden="true" tabindex="-1"></a>            dsp_status <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.solve()</span>
<span id="lst-bd-whole-workflow-32"><a href="#lst-bd-whole-workflow-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-33"><a href="#lst-bd-whole-workflow-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dsp_status <span class="op">==</span> OptStatus.OPTIMAL:</span>
<span id="lst-bd-whole-workflow-34"><a href="#lst-bd-whole-workflow-34" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update upper bound</span></span>
<span id="lst-bd-whole-workflow-35"><a href="#lst-bd-whole-workflow-35" aria-hidden="true" tabindex="-1"></a>                opt_obj <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_obj</span>
<span id="lst-bd-whole-workflow-36"><a href="#lst-bd-whole-workflow-36" aria-hidden="true" tabindex="-1"></a>                ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>opt_y1 <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>opt_y2 <span class="op">+</span> opt_obj])</span>
<span id="lst-bd-whole-workflow-37"><a href="#lst-bd-whole-workflow-37" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-workflow-38"><a href="#lst-bd-whole-workflow-38" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-whole-workflow-39"><a href="#lst-bd-whole-workflow-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ub <span class="op">-</span> lb <span class="op">&lt;=</span> eps:</span>
<span id="lst-bd-whole-workflow-40"><a href="#lst-bd-whole-workflow-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="lst-bd-whole-workflow-41"><a href="#lst-bd-whole-workflow-41" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-whole-workflow-42"><a href="#lst-bd-whole-workflow-42" aria-hidden="true" tabindex="-1"></a>                opt_u1 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_u1</span>
<span id="lst-bd-whole-workflow-43"><a href="#lst-bd-whole-workflow-43" aria-hidden="true" tabindex="-1"></a>                opt_u2 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_u2</span>
<span id="lst-bd-whole-workflow-44"><a href="#lst-bd-whole-workflow-44" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_optimality_cut(opt_u1, opt_u2) </span>
<span id="lst-bd-whole-workflow-45"><a href="#lst-bd-whole-workflow-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> dsp_status <span class="op">==</span> OptStatus.UNBOUNDED:</span>
<span id="lst-bd-whole-workflow-46"><a href="#lst-bd-whole-workflow-46" aria-hidden="true" tabindex="-1"></a>                ray_u1 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.ray_u1</span>
<span id="lst-bd-whole-workflow-47"><a href="#lst-bd-whole-workflow-47" aria-hidden="true" tabindex="-1"></a>                ray_u2 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.ray_u2</span>
<span id="lst-bd-whole-workflow-48"><a href="#lst-bd-whole-workflow-48" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_feasibility_cut(ray_u1, ray_u2) </span>
<span id="lst-bd-whole-workflow-49"><a href="#lst-bd-whole-workflow-49" aria-hidden="true" tabindex="-1"></a>            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-exp-1" class="quarto-xref">Listing&nbsp;<span>4.19</span></a> solves the LP problem using the wholesome Benders solver. The optimal solution agrees with the solution obtained in the manual approach.</p>
<div id="cell-88" class="cell" data-execution_count="304">
<div id="lst-bd-whole-exp-1" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-exp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.19: Solving the LP problem using Benders decomposition
</figcaption>
<div aria-describedby="lst-bd-whole-exp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-exp-1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-exp-1-1"><a href="#lst-bd-whole-exp-1-1" aria-hidden="true" tabindex="-1"></a>env <span class="op">=</span> gp.Env(<span class="st">'benders'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-bd-whole-exp-1-2"><a href="#lst-bd-whole-exp-1-2" aria-hidden="true" tabindex="-1"></a>env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-bd-whole-exp-1-3"><a href="#lst-bd-whole-exp-1-3" aria-hidden="true" tabindex="-1"></a>env.start()</span>
<span id="lst-bd-whole-exp-1-4"><a href="#lst-bd-whole-exp-1-4" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> MasterSolver(env)</span>
<span id="lst-bd-whole-exp-1-5"><a href="#lst-bd-whole-exp-1-5" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> DualSubprobSolver(env)</span>
<span id="lst-bd-whole-exp-1-6"><a href="#lst-bd-whole-exp-1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-exp-1-7"><a href="#lst-bd-whole-exp-1-7" aria-hidden="true" tabindex="-1"></a>benders_decomposition <span class="op">=</span> BendersDecomposition(master_solver, dual_subprob_solver)</span>
<span id="lst-bd-whole-exp-1-8"><a href="#lst-bd-whole-exp-1-8" aria-hidden="true" tabindex="-1"></a>benders_decomposition.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_y1=0.00, opt_y2=0.00
    opt_g=0.00
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_y1=4.00, opt_y2=0.00
Finish solving dual subproblem.
--------------------------------------------------
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_y1=0.00, opt_y2=60.00
    opt_g=0.00
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is unbounded!
    extreme ray (u1, u2) = (-2.0, 1.0)
Finish solving dual subproblem.
--------------------------------------------------
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_y1=0.00, opt_y2=54.29
    opt_g=114.29
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_y1=4.00, opt_y2=0.00
Finish solving dual subproblem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
</section>
<section id="a-generic-lp-benders-decomposition-solver" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="a-generic-lp-benders-decomposition-solver"><span class="header-section-number">4.2.6</span> A generic LP Benders decomposition solver</h3>
<p>The Benders decomposition solver we put together in the last section is a big step toward automating the interaction between the master solver and the dual subproblem solver. However, it is still rather limited in that both the master and subproblem solvers are tied to a specific problem. In this section, we aim to develop a more generic solver that is able to solver any LP problem following a specific form.</p>
<p><a href="#lst-generic-bd-master" class="quarto-xref">Listing&nbsp;<span>4.20</span></a> implements a LP solver class named <code>GenericLpMasterSolver</code> for (<strong>RBMP</strong>) characterized by the cost coefficient <code>f</code>, the constraint matrix <code>B</code> and right-hand side <code>b</code>. The constructor initializes the complicating variables <code>_y</code> and the dummy variable <code>_g</code>. The <code>solve()</code> function solves the problem and retrieves the optimal solution if exists. Moreover, the solver provides functions to add optimality and feasibility cuts to the existing model.</p>
<div id="cell-92" class="cell" data-execution_count="306">
<div id="lst-generic-bd-master" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-bd-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.20: Generic Benders master problem solver for LP problems
</figcaption>
<div aria-describedby="lst-generic-bd-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-bd-master"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-bd-master-1"><a href="#lst-generic-bd-master-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericLpMasterSolver:</span>
<span id="lst-generic-bd-master-2"><a href="#lst-generic-bd-master-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-3"><a href="#lst-generic-bd-master-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, f: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-bd-master-4"><a href="#lst-generic-bd-master-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-bd-master-5"><a href="#lst-generic-bd-master-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._f <span class="op">=</span> f</span>
<span id="lst-generic-bd-master-6"><a href="#lst-generic-bd-master-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-bd-master-7"><a href="#lst-generic-bd-master-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-bd-master-8"><a href="#lst-generic-bd-master-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-9"><a href="#lst-generic-bd-master-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-bd-master-10"><a href="#lst-generic-bd-master-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'MasterEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-generic-bd-master-11"><a href="#lst-generic-bd-master-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-generic-bd-master-12"><a href="#lst-generic-bd-master-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-generic-bd-master-13"><a href="#lst-generic-bd-master-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'MasterSolver'</span>)</span>
<span id="lst-generic-bd-master-14"><a href="#lst-generic-bd-master-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-15"><a href="#lst-generic-bd-master-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-bd-master-16"><a href="#lst-generic-bd-master-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_y_vars <span class="op">=</span> <span class="bu">len</span>(f)</span>
<span id="lst-generic-bd-master-17"><a href="#lst-generic-bd-master-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y <span class="op">=</span> <span class="va">self</span>._model.addVars(<span class="va">self</span>._num_y_vars, </span>
<span id="lst-generic-bd-master-18"><a href="#lst-generic-bd-master-18" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>,</span>
<span id="lst-generic-bd-master-19"><a href="#lst-generic-bd-master-19" aria-hidden="true" tabindex="-1"></a>                                      vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-generic-bd-master-20"><a href="#lst-generic-bd-master-20" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="lst-generic-bd-master-21"><a href="#lst-generic-bd-master-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-generic-bd-master-22"><a href="#lst-generic-bd-master-22" aria-hidden="true" tabindex="-1"></a>                                     lb<span class="op">=</span><span class="dv">0</span>, </span>
<span id="lst-generic-bd-master-23"><a href="#lst-generic-bd-master-23" aria-hidden="true" tabindex="-1"></a>                                     name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-generic-bd-master-24"><a href="#lst-generic-bd-master-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-25"><a href="#lst-generic-bd-master-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-generic-bd-master-26"><a href="#lst-generic-bd-master-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="lst-generic-bd-master-27"><a href="#lst-generic-bd-master-27" aria-hidden="true" tabindex="-1"></a>            gp.quicksum(<span class="va">self</span>._f[i] <span class="op">*</span> <span class="va">self</span>._y.get(i) </span>
<span id="lst-generic-bd-master-28"><a href="#lst-generic-bd-master-28" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)) <span class="op">+</span> </span>
<span id="lst-generic-bd-master-29"><a href="#lst-generic-bd-master-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._g,  </span>
<span id="lst-generic-bd-master-30"><a href="#lst-generic-bd-master-30" aria-hidden="true" tabindex="-1"></a>            GRB.MINIMIZE)</span>
<span id="lst-generic-bd-master-31"><a href="#lst-generic-bd-master-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-generic-bd-master-32"><a href="#lst-generic-bd-master-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-33"><a href="#lst-generic-bd-master-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-master-34"><a href="#lst-generic-bd-master-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-master-35"><a href="#lst-generic-bd-master-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-master-36"><a href="#lst-generic-bd-master-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-master-37"><a href="#lst-generic-bd-master-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-38"><a href="#lst-generic-bd-master-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-generic-bd-master-39"><a href="#lst-generic-bd-master-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-bd-master-40"><a href="#lst-generic-bd-master-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="lst-generic-bd-master-41"><a href="#lst-generic-bd-master-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-bd-master-42"><a href="#lst-generic-bd-master-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-43"><a href="#lst-generic-bd-master-43" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-master-44"><a href="#lst-generic-bd-master-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-generic-bd-master-45"><a href="#lst-generic-bd-master-45" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-bd-master-46"><a href="#lst-generic-bd-master-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-generic-bd-master-47"><a href="#lst-generic-bd-master-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y <span class="op">=</span> {</span>
<span id="lst-generic-bd-master-48"><a href="#lst-generic-bd-master-48" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._y.get(i).X</span>
<span id="lst-generic-bd-master-49"><a href="#lst-generic-bd-master-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-bd-master-50"><a href="#lst-generic-bd-master-50" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-bd-master-51"><a href="#lst-generic-bd-master-51" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._g.X</span>
<span id="lst-generic-bd-master-52"><a href="#lst-generic-bd-master-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">self</span>._opt_obj <span class="op">-</span> <span class="va">self</span>._opt_g</span>
<span id="lst-generic-bd-master-53"><a href="#lst-generic-bd-master-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="lst-generic-bd-master-54"><a href="#lst-generic-bd-master-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-master-55"><a href="#lst-generic-bd-master-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-master-56"><a href="#lst-generic-bd-master-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars):</span>
<span id="lst-generic-bd-master-57"><a href="#lst-generic-bd-master-57" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_y<span class="sc">.</span>get(j)<span class="sc">.</span>X<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-master-58"><a href="#lst-generic-bd-master-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-generic-bd-master-59"><a href="#lst-generic-bd-master-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="lst-generic-bd-master-60"><a href="#lst-generic-bd-master-60" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="lst-generic-bd-master-61"><a href="#lst-generic-bd-master-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-bd-master-62"><a href="#lst-generic-bd-master-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="lst-generic-bd-master-63"><a href="#lst-generic-bd-master-63" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-bd-master-64"><a href="#lst-generic-bd-master-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-65"><a href="#lst-generic-bd-master-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="lst-generic-bd-master-66"><a href="#lst-generic-bd-master-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-bd-master-67"><a href="#lst-generic-bd-master-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="lst-generic-bd-master-68"><a href="#lst-generic-bd-master-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-69"><a href="#lst-generic-bd-master-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-bd-master-70"><a href="#lst-generic-bd-master-70" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-bd-master-71"><a href="#lst-generic-bd-master-71" aria-hidden="true" tabindex="-1"></a>            ray_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-bd-master-72"><a href="#lst-generic-bd-master-72" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-bd-master-73"><a href="#lst-generic-bd-master-73" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-bd-master-74"><a href="#lst-generic-bd-master-74" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(</span>
<span id="lst-generic-bd-master-75"><a href="#lst-generic-bd-master-75" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-bd-master-76"><a href="#lst-generic-bd-master-76" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-bd-master-77"><a href="#lst-generic-bd-master-77" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-bd-master-78"><a href="#lst-generic-bd-master-78" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-bd-master-79"><a href="#lst-generic-bd-master-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> ray_u.keys()</span>
<span id="lst-generic-bd-master-80"><a href="#lst-generic-bd-master-80" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-bd-master-81"><a href="#lst-generic-bd-master-81" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(gp.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="dv">0</span>)</span>
<span id="lst-generic-bd-master-82"><a href="#lst-generic-bd-master-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="lst-generic-bd-master-83"><a href="#lst-generic-bd-master-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-84"><a href="#lst-generic-bd-master-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-bd-master-85"><a href="#lst-generic-bd-master-85" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-bd-master-86"><a href="#lst-generic-bd-master-86" aria-hidden="true" tabindex="-1"></a>            opt_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-bd-master-87"><a href="#lst-generic-bd-master-87" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-bd-master-88"><a href="#lst-generic-bd-master-88" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-bd-master-89"><a href="#lst-generic-bd-master-89" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(</span>
<span id="lst-generic-bd-master-90"><a href="#lst-generic-bd-master-90" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-bd-master-91"><a href="#lst-generic-bd-master-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-bd-master-92"><a href="#lst-generic-bd-master-92" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-bd-master-93"><a href="#lst-generic-bd-master-93" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-bd-master-94"><a href="#lst-generic-bd-master-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> opt_u.keys()</span>
<span id="lst-generic-bd-master-95"><a href="#lst-generic-bd-master-95" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-bd-master-96"><a href="#lst-generic-bd-master-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(gp.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="va">self</span>._g)</span>
<span id="lst-generic-bd-master-97"><a href="#lst-generic-bd-master-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-generic-bd-master-98"><a href="#lst-generic-bd-master-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="lst-generic-bd-master-99"><a href="#lst-generic-bd-master-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-100"><a href="#lst-generic-bd-master-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-101"><a href="#lst-generic-bd-master-101" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-generic-bd-master-102"><a href="#lst-generic-bd-master-102" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span>
<span id="lst-generic-bd-master-103"><a href="#lst-generic-bd-master-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-104"><a href="#lst-generic-bd-master-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-generic-bd-master-105"><a href="#lst-generic-bd-master-105" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-generic-bd-master-106"><a href="#lst-generic-bd-master-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-107"><a href="#lst-generic-bd-master-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-master-108"><a href="#lst-generic-bd-master-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-109"><a href="#lst-generic-bd-master-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._f</span>
<span id="lst-generic-bd-master-110"><a href="#lst-generic-bd-master-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-master-111"><a href="#lst-generic-bd-master-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-master-112"><a href="#lst-generic-bd-master-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-113"><a href="#lst-generic-bd-master-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-bd-master-114"><a href="#lst-generic-bd-master-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-115"><a href="#lst-generic-bd-master-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-master-116"><a href="#lst-generic-bd-master-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_y(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-117"><a href="#lst-generic-bd-master-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj_y</span>
<span id="lst-generic-bd-master-118"><a href="#lst-generic-bd-master-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-119"><a href="#lst-generic-bd-master-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-master-120"><a href="#lst-generic-bd-master-120" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-121"><a href="#lst-generic-bd-master-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y</span>
<span id="lst-generic-bd-master-122"><a href="#lst-generic-bd-master-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-master-123"><a href="#lst-generic-bd-master-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-master-124"><a href="#lst-generic-bd-master-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="lst-generic-bd-master-125"><a href="#lst-generic-bd-master-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-generic-bd-dsp" class="quarto-xref">Listing&nbsp;<span>4.21</span></a> presents a solver for (<strong>DSP</strong>) that’s defined by the objective function coefficient <code>c</code> and constraint matrix <code>A</code>. The model objective function could be updated by <code>update_objective()</code> with the latest value of <code>y</code>. Notice that, the optimal solution is saved to <code>_opt_u</code> if the underlying problem is optimal. Otherwise, an extreme ray is retrieved and stored in <code>_extreme_ray</code>.</p>
<div id="cell-94" class="cell" data-execution_count="318">
<div id="lst-generic-bd-dsp" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.21: Generic Benders dual subproblem solver for LP problems
</figcaption>
<div aria-describedby="lst-generic-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-bd-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-bd-dsp-1"><a href="#lst-generic-bd-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericLpSubprobSolver:</span>
<span id="lst-generic-bd-dsp-2"><a href="#lst-generic-bd-dsp-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-dsp-3"><a href="#lst-generic-bd-dsp-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, A: np.array, c: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-bd-dsp-4"><a href="#lst-generic-bd-dsp-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-bd-dsp-5"><a href="#lst-generic-bd-dsp-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._A <span class="op">=</span> A </span>
<span id="lst-generic-bd-dsp-6"><a href="#lst-generic-bd-dsp-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._c <span class="op">=</span> c </span>
<span id="lst-generic-bd-dsp-7"><a href="#lst-generic-bd-dsp-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-bd-dsp-8"><a href="#lst-generic-bd-dsp-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-bd-dsp-9"><a href="#lst-generic-bd-dsp-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-10"><a href="#lst-generic-bd-dsp-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-bd-dsp-11"><a href="#lst-generic-bd-dsp-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'SubprobEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-generic-bd-dsp-12"><a href="#lst-generic-bd-dsp-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-generic-bd-dsp-13"><a href="#lst-generic-bd-dsp-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-generic-bd-dsp-14"><a href="#lst-generic-bd-dsp-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'SubprobSolver'</span>)</span>
<span id="lst-generic-bd-dsp-15"><a href="#lst-generic-bd-dsp-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-bd-dsp-16"><a href="#lst-generic-bd-dsp-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-bd-dsp-17"><a href="#lst-generic-bd-dsp-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(b)</span>
<span id="lst-generic-bd-dsp-18"><a href="#lst-generic-bd-dsp-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u <span class="op">=</span> <span class="va">self</span>._model.addVars(<span class="va">self</span>._num_vars, </span>
<span id="lst-generic-bd-dsp-19"><a href="#lst-generic-bd-dsp-19" aria-hidden="true" tabindex="-1"></a>                                      vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-generic-bd-dsp-20"><a href="#lst-generic-bd-dsp-20" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-generic-bd-dsp-21"><a href="#lst-generic-bd-dsp-21" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-generic-bd-dsp-22"><a href="#lst-generic-bd-dsp-22" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u'</span>)</span>
<span id="lst-generic-bd-dsp-23"><a href="#lst-generic-bd-dsp-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-bd-dsp-24"><a href="#lst-generic-bd-dsp-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-generic-bd-dsp-25"><a href="#lst-generic-bd-dsp-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(c)):</span>
<span id="lst-generic-bd-dsp-26"><a href="#lst-generic-bd-dsp-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addConstr(</span>
<span id="lst-generic-bd-dsp-27"><a href="#lst-generic-bd-dsp-27" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(A[:,c_idx][i] <span class="op">*</span> <span class="va">self</span>._u.get(i) </span>
<span id="lst-generic-bd-dsp-28"><a href="#lst-generic-bd-dsp-28" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(b))) <span class="op">&lt;=</span> c[c_idx]</span>
<span id="lst-generic-bd-dsp-29"><a href="#lst-generic-bd-dsp-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-bd-dsp-30"><a href="#lst-generic-bd-dsp-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-31"><a href="#lst-generic-bd-dsp-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-dsp-32"><a href="#lst-generic-bd-dsp-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-dsp-33"><a href="#lst-generic-bd-dsp-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-dsp-34"><a href="#lst-generic-bd-dsp-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-35"><a href="#lst-generic-bd-dsp-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-generic-bd-dsp-36"><a href="#lst-generic-bd-dsp-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-bd-dsp-37"><a href="#lst-generic-bd-dsp-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="lst-generic-bd-dsp-38"><a href="#lst-generic-bd-dsp-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setParam(GRB.Param.DualReductions, <span class="dv">0</span>)</span>
<span id="lst-generic-bd-dsp-39"><a href="#lst-generic-bd-dsp-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setParam(GRB.Param.InfUnbdInfo, <span class="dv">1</span>)</span>
<span id="lst-generic-bd-dsp-40"><a href="#lst-generic-bd-dsp-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-bd-dsp-41"><a href="#lst-generic-bd-dsp-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-42"><a href="#lst-generic-bd-dsp-42" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-bd-dsp-43"><a href="#lst-generic-bd-dsp-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-generic-bd-dsp-44"><a href="#lst-generic-bd-dsp-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-generic-bd-dsp-45"><a href="#lst-generic-bd-dsp-45" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u <span class="op">=</span> {</span>
<span id="lst-generic-bd-dsp-46"><a href="#lst-generic-bd-dsp-46" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._u.get(i).X</span>
<span id="lst-generic-bd-dsp-47"><a href="#lst-generic-bd-dsp-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-bd-dsp-48"><a href="#lst-generic-bd-dsp-48" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-bd-dsp-49"><a href="#lst-generic-bd-dsp-49" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-bd-dsp-50"><a href="#lst-generic-bd-dsp-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="lst-generic-bd-dsp-51"><a href="#lst-generic-bd-dsp-51" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-dsp-52"><a href="#lst-generic-bd-dsp-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars):</span>
<span id="lst-generic-bd-dsp-53"><a href="#lst-generic-bd-dsp-53" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_u<span class="sc">.</span>get(i)<span class="sc">.</span>X<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-dsp-54"><a href="#lst-generic-bd-dsp-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-generic-bd-dsp-55"><a href="#lst-generic-bd-dsp-55" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="lst-generic-bd-dsp-56"><a href="#lst-generic-bd-dsp-56" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u <span class="op">=</span> {</span>
<span id="lst-generic-bd-dsp-57"><a href="#lst-generic-bd-dsp-57" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._u.get(i).UnbdRay</span>
<span id="lst-generic-bd-dsp-58"><a href="#lst-generic-bd-dsp-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-bd-dsp-59"><a href="#lst-generic-bd-dsp-59" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-bd-dsp-60"><a href="#lst-generic-bd-dsp-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem is unbounded'</span>)</span>
<span id="lst-generic-bd-dsp-61"><a href="#lst-generic-bd-dsp-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-bd-dsp-62"><a href="#lst-generic-bd-dsp-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem solve ERROR!'</span>)</span>
<span id="lst-generic-bd-dsp-63"><a href="#lst-generic-bd-dsp-63" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-bd-dsp-64"><a href="#lst-generic-bd-dsp-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-65"><a href="#lst-generic-bd-dsp-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="lst-generic-bd-dsp-66"><a href="#lst-generic-bd-dsp-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-bd-dsp-67"><a href="#lst-generic-bd-dsp-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="lst-generic-bd-dsp-68"><a href="#lst-generic-bd-dsp-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-bd-dsp-69"><a href="#lst-generic-bd-dsp-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y: <span class="bu">dict</span>):</span>
<span id="lst-generic-bd-dsp-70"><a href="#lst-generic-bd-dsp-70" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-generic-bd-dsp-71"><a href="#lst-generic-bd-dsp-71" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-bd-dsp-72"><a href="#lst-generic-bd-dsp-72" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-bd-dsp-73"><a href="#lst-generic-bd-dsp-73" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-bd-dsp-74"><a href="#lst-generic-bd-dsp-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">sum</span>(<span class="va">self</span>._B[u_idx][j] <span class="op">*</span> opt_y.get(j) </span>
<span id="lst-generic-bd-dsp-75"><a href="#lst-generic-bd-dsp-75" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(opt_y))</span>
<span id="lst-generic-bd-dsp-76"><a href="#lst-generic-bd-dsp-76" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-bd-dsp-77"><a href="#lst-generic-bd-dsp-77" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-bd-dsp-78"><a href="#lst-generic-bd-dsp-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-bd-dsp-79"><a href="#lst-generic-bd-dsp-79" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-bd-dsp-80"><a href="#lst-generic-bd-dsp-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(gp.quicksum(obj_expr), GRB.MAXIMIZE)</span>
<span id="lst-generic-bd-dsp-81"><a href="#lst-generic-bd-dsp-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="lst-generic-bd-dsp-82"><a href="#lst-generic-bd-dsp-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-dsp-83"><a href="#lst-generic-bd-dsp-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-generic-bd-dsp-84"><a href="#lst-generic-bd-dsp-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-generic-bd-dsp-85"><a href="#lst-generic-bd-dsp-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span>
<span id="lst-generic-bd-dsp-86"><a href="#lst-generic-bd-dsp-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-87"><a href="#lst-generic-bd-dsp-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-generic-bd-dsp-88"><a href="#lst-generic-bd-dsp-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-generic-bd-dsp-89"><a href="#lst-generic-bd-dsp-89" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-dsp-90"><a href="#lst-generic-bd-dsp-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-dsp-91"><a href="#lst-generic-bd-dsp-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-bd-dsp-92"><a href="#lst-generic-bd-dsp-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-bd-dsp-93"><a href="#lst-generic-bd-dsp-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-dsp-94"><a href="#lst-generic-bd-dsp-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-dsp-95"><a href="#lst-generic-bd-dsp-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u(<span class="va">self</span>):</span>
<span id="lst-generic-bd-dsp-96"><a href="#lst-generic-bd-dsp-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u</span>
<span id="lst-generic-bd-dsp-97"><a href="#lst-generic-bd-dsp-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-dsp-98"><a href="#lst-generic-bd-dsp-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-bd-dsp-99"><a href="#lst-generic-bd-dsp-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u(<span class="va">self</span>):</span>
<span id="lst-generic-bd-dsp-100"><a href="#lst-generic-bd-dsp-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-generic-bd-workflow" class="quarto-xref">Listing&nbsp;<span>4.22</span></a> generalizes the Benders decomposition control flow in <a href="#lst-bd-whole-workflow" class="quarto-xref">Listing&nbsp;<span>4.18</span></a>.</p>
<div id="cell-96" class="cell" data-execution_count="337">
<div id="lst-generic-bd-workflow" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-bd-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.22: Generic Benders decomposition for LP problems
</figcaption>
<div aria-describedby="lst-generic-bd-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-bd-workflow"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-bd-workflow-1"><a href="#lst-generic-bd-workflow-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericBendersSolver:</span>
<span id="lst-generic-bd-workflow-2"><a href="#lst-generic-bd-workflow-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-workflow-3"><a href="#lst-generic-bd-workflow-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, master_solver, dual_subprob_solver):</span>
<span id="lst-generic-bd-workflow-4"><a href="#lst-generic-bd-workflow-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._master_solver <span class="op">=</span> master_solver</span>
<span id="lst-generic-bd-workflow-5"><a href="#lst-generic-bd-workflow-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dual_subprob_solver <span class="op">=</span> dual_subprob_solver</span>
<span id="lst-generic-bd-workflow-6"><a href="#lst-generic-bd-workflow-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-bd-workflow-7"><a href="#lst-generic-bd-workflow-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>,) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-generic-bd-workflow-8"><a href="#lst-generic-bd-workflow-8" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-generic-bd-workflow-9"><a href="#lst-generic-bd-workflow-9" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="lst-generic-bd-workflow-10"><a href="#lst-generic-bd-workflow-10" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="lst-generic-bd-workflow-11"><a href="#lst-generic-bd-workflow-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-bd-workflow-12"><a href="#lst-generic-bd-workflow-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-generic-bd-workflow-13"><a href="#lst-generic-bd-workflow-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="lst-generic-bd-workflow-14"><a href="#lst-generic-bd-workflow-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-generic-bd-workflow-15"><a href="#lst-generic-bd-workflow-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Iteration: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-workflow-16"><a href="#lst-generic-bd-workflow-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve master problem</span></span>
<span id="lst-generic-bd-workflow-17"><a href="#lst-generic-bd-workflow-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># self._master_solver.save_model(f'master_iter{iter}.lp')</span></span>
<span id="lst-generic-bd-workflow-18"><a href="#lst-generic-bd-workflow-18" aria-hidden="true" tabindex="-1"></a>            master_status <span class="op">=</span> <span class="va">self</span>._master_solver.solve()</span>
<span id="lst-generic-bd-workflow-19"><a href="#lst-generic-bd-workflow-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> master_status <span class="op">==</span> OptStatus.INFEASIBLE:</span>
<span id="lst-generic-bd-workflow-20"><a href="#lst-generic-bd-workflow-20" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-generic-bd-workflow-21"><a href="#lst-generic-bd-workflow-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> OptStatus.INFEASIBLE</span>
<span id="lst-generic-bd-workflow-22"><a href="#lst-generic-bd-workflow-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-generic-bd-workflow-23"><a href="#lst-generic-bd-workflow-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update lower bound</span></span>
<span id="lst-generic-bd-workflow-24"><a href="#lst-generic-bd-workflow-24" aria-hidden="true" tabindex="-1"></a>            lb <span class="op">=</span> np.<span class="bu">max</span>([lb, <span class="va">self</span>._master_solver.opt_obj])</span>
<span id="lst-generic-bd-workflow-25"><a href="#lst-generic-bd-workflow-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-workflow-26"><a href="#lst-generic-bd-workflow-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-generic-bd-workflow-27"><a href="#lst-generic-bd-workflow-27" aria-hidden="true" tabindex="-1"></a>            opt_y <span class="op">=</span> <span class="va">self</span>._master_solver.opt_y</span>
<span id="lst-generic-bd-workflow-28"><a href="#lst-generic-bd-workflow-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-generic-bd-workflow-29"><a href="#lst-generic-bd-workflow-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve subproblem</span></span>
<span id="lst-generic-bd-workflow-30"><a href="#lst-generic-bd-workflow-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._dual_subprob_solver.update_objective(opt_y)</span>
<span id="lst-generic-bd-workflow-31"><a href="#lst-generic-bd-workflow-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># self._dual_subprob_solver.save_model(f'dsp_iter{iter}.lp')</span></span>
<span id="lst-generic-bd-workflow-32"><a href="#lst-generic-bd-workflow-32" aria-hidden="true" tabindex="-1"></a>            dsp_status <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.solve()</span>
<span id="lst-generic-bd-workflow-33"><a href="#lst-generic-bd-workflow-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-generic-bd-workflow-34"><a href="#lst-generic-bd-workflow-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dsp_status <span class="op">==</span> OptStatus.OPTIMAL:</span>
<span id="lst-generic-bd-workflow-35"><a href="#lst-generic-bd-workflow-35" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'DSP is optimal!'</span>)</span>
<span id="lst-generic-bd-workflow-36"><a href="#lst-generic-bd-workflow-36" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update upper bound</span></span>
<span id="lst-generic-bd-workflow-37"><a href="#lst-generic-bd-workflow-37" aria-hidden="true" tabindex="-1"></a>                opt_obj <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_obj</span>
<span id="lst-generic-bd-workflow-38"><a href="#lst-generic-bd-workflow-38" aria-hidden="true" tabindex="-1"></a>                opt_obj_y <span class="op">=</span> <span class="va">self</span>._master_solver.opt_obj_y</span>
<span id="lst-generic-bd-workflow-39"><a href="#lst-generic-bd-workflow-39" aria-hidden="true" tabindex="-1"></a>                ub <span class="op">=</span> np.<span class="bu">min</span>([ub, opt_obj_y <span class="op">+</span> opt_obj])</span>
<span id="lst-generic-bd-workflow-40"><a href="#lst-generic-bd-workflow-40" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-bd-workflow-41"><a href="#lst-generic-bd-workflow-41" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-generic-bd-workflow-42"><a href="#lst-generic-bd-workflow-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ub <span class="op">-</span> lb <span class="op">&lt;=</span> eps:</span>
<span id="lst-generic-bd-workflow-43"><a href="#lst-generic-bd-workflow-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="lst-generic-bd-workflow-44"><a href="#lst-generic-bd-workflow-44" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-generic-bd-workflow-45"><a href="#lst-generic-bd-workflow-45" aria-hidden="true" tabindex="-1"></a>                opt_u <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_u</span>
<span id="lst-generic-bd-workflow-46"><a href="#lst-generic-bd-workflow-46" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_optimality_cut(opt_u) </span>
<span id="lst-generic-bd-workflow-47"><a href="#lst-generic-bd-workflow-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> dsp_status <span class="op">==</span> OptStatus.UNBOUNDED:</span>
<span id="lst-generic-bd-workflow-48"><a href="#lst-generic-bd-workflow-48" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'DSP is unbounded!!!'</span>)</span>
<span id="lst-generic-bd-workflow-49"><a href="#lst-generic-bd-workflow-49" aria-hidden="true" tabindex="-1"></a>                ray_u <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.ray_u</span>
<span id="lst-generic-bd-workflow-50"><a href="#lst-generic-bd-workflow-50" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_feasibility_cut(ray_u) </span>
<span id="lst-generic-bd-workflow-51"><a href="#lst-generic-bd-workflow-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="lst-generic-bd-workflow-52"><a href="#lst-generic-bd-workflow-52" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"DSP solve ERROR!!!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-generic-benders-test-1" class="quarto-xref">Listing&nbsp;<span>4.23</span></a> solves the LP problem that we have been tackling in the previous sections. The output confirms that the same optimal solution is identified as in the last section.</p>
<div id="cell-98" class="cell" data-execution_count="320">
<div id="lst-generic-benders-test-1" class="python cell-code listing">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4.23: Solving the LP problem using Benders decomposition
</figcaption>
<div aria-describedby="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-benders-test-1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-benders-test-1-1"><a href="#lst-generic-benders-test-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-generic-benders-test-1-2"><a href="#lst-generic-benders-test-1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-generic-benders-test-1-3"><a href="#lst-generic-benders-test-1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-generic-benders-test-1-4"><a href="#lst-generic-benders-test-1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-5"><a href="#lst-generic-benders-test-1-5" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">10</span>])</span>
<span id="lst-generic-benders-test-1-6"><a href="#lst-generic-benders-test-1-6" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.array([<span class="dv">15</span>, <span class="dv">18</span>])</span>
<span id="lst-generic-benders-test-1-7"><a href="#lst-generic-benders-test-1-7" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([</span>
<span id="lst-generic-benders-test-1-8"><a href="#lst-generic-benders-test-1-8" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="lst-generic-benders-test-1-9"><a href="#lst-generic-benders-test-1-9" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="lst-generic-benders-test-1-10"><a href="#lst-generic-benders-test-1-10" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="lst-generic-benders-test-1-11"><a href="#lst-generic-benders-test-1-11" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([</span>
<span id="lst-generic-benders-test-1-12"><a href="#lst-generic-benders-test-1-12" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="lst-generic-benders-test-1-13"><a href="#lst-generic-benders-test-1-13" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="lst-generic-benders-test-1-14"><a href="#lst-generic-benders-test-1-14" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="lst-generic-benders-test-1-15"><a href="#lst-generic-benders-test-1-15" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([<span class="dv">300</span>, <span class="dv">220</span>])</span>
<span id="lst-generic-benders-test-1-16"><a href="#lst-generic-benders-test-1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-17"><a href="#lst-generic-benders-test-1-17" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericLpMasterSolver(f, B, b)</span>
<span id="lst-generic-benders-test-1-18"><a href="#lst-generic-benders-test-1-18" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericLpSubprobSolver(A, c, B, b)</span>
<span id="lst-generic-benders-test-1-19"><a href="#lst-generic-benders-test-1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-20"><a href="#lst-generic-benders-test-1-20" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersSolver(master_solver, dual_subprob_solver)</span>
<span id="lst-generic-benders-test-1-21"><a href="#lst-generic-benders-test-1-21" aria-hidden="true" tabindex="-1"></a>benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=0.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=60.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
dual subproblem is unbounded
Finish solving dual subproblem.
--------------------------------------------------
DSP is unbounded!!!
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_g=114.29
    opt_y0=0.0
    opt_y1=54.285714285714285
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
<section id="a-generic-solver-based-on-scip" class="level4" data-number="4.2.6.1">
<h4 data-number="4.2.6.1" class="anchored" data-anchor-id="a-generic-solver-based-on-scip"><span class="header-section-number">4.2.6.1</span> A generic solver based on SCIP</h4>
<div id="cell-100" class="cell" data-execution_count="334">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericLpMasterSolverSCIP:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, f: np.array, B: np.array, b: np.array):</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._f <span class="op">=</span> f</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> pyscipopt.Model(<span class="st">'MasterSolver'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_y_vars <span class="op">=</span> <span class="bu">len</span>(f)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y <span class="op">=</span> {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">'C'</span>, name<span class="op">=</span><span class="ss">f'y</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                                     vtype<span class="op">=</span><span class="st">'C'</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                                     name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            pyscipopt.quicksum(<span class="va">self</span>._f[i] <span class="op">*</span> <span class="va">self</span>._y.get(i) </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)) <span class="op">+</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._g,  </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'maximize'</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setPresolve(SCIP_PARAMSETTING.OFF)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setHeuristics(SCIP_PARAMSETTING.OFF)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.disablePropagation()</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'optimal'</span>:</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y <span class="op">=</span> {</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._model.getVal(<span class="va">self</span>._y.get(i))</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._model.getVal(<span class="va">self</span>._g)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">self</span>._opt_obj <span class="op">-</span> <span class="va">self</span>._opt_g</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars):</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y<span class="sc">.</span>get(j)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'infeasible'</span>:</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>            ray_u.get(u_idx) <span class="op">*</span> </span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> ray_u.keys()</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addCons(pyscipopt.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="dv">0</span>)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>            opt_u.get(u_idx) <span class="op">*</span> </span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> opt_u.keys()</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addCons(pyscipopt.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="va">self</span>._g)</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._f</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_y(<span class="va">self</span>):</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj_y</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y(<span class="va">self</span>):</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-101" class="cell" data-execution_count="335">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericLpSubprobSolverSCIP:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, A: np.array, c: np.array, B: np.array, b: np.array):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._A <span class="op">=</span> A </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._c <span class="op">=</span> c </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> pyscipopt.Model(<span class="st">'SubprobSolver'</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(b)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u <span class="op">=</span> {</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(vtype<span class="op">=</span><span class="st">'C'</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                                  lb<span class="op">=-</span><span class="va">self</span>._model.infinity(),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                                  ub<span class="op">=</span><span class="va">self</span>._model.infinity(),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                                  name<span class="op">=</span><span class="ss">f'u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(c)):</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(A[:,c_idx][i] <span class="op">*</span> <span class="va">self</span>._u.get(i) </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(b))) <span class="op">&lt;=</span> c[c_idx]</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setPresolve(SCIP_PARAMSETTING.OFF)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setHeuristics(SCIP_PARAMSETTING.OFF)</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.disablePropagation()</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'optimal'</span>:</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u <span class="op">=</span> {</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._model.getVal(<span class="va">self</span>._u.get(i))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars):</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u<span class="sc">.</span>get(i)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'unbounded'</span>:</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            hasRay <span class="op">=</span> <span class="va">self</span>._model.hasPrimalRay()</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'primal ray exists!'</span>)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>            ray <span class="op">=</span> <span class="va">self</span>._model.getPrimalRay()</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u <span class="op">=</span> {</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>                i: ray[i]</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem is unbounded'</span>)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem solve ERROR!'</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y: <span class="bu">dict</span>):</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._u.get(u_idx) <span class="op">*</span> </span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>                <span class="bu">sum</span>(<span class="va">self</span>._B[u_idx][j] <span class="op">*</span> opt_y.get(j) </span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(opt_y))</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(pyscipopt.quicksum(obj_expr), GRB.MAXIMIZE)</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u(<span class="va">self</span>):</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u(<span class="va">self</span>):</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-102" class="cell" data-execution_count="336">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericLpMasterSolverSCIP(f, B, b)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericLpSubprobSolverSCIP(A, c, B, b)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersSolver(master_solver, dual_subprob_solver)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'GenericLpMasterSolverSCIP' object has no attribute 'save_model'</code></pre>
</div>
</div>
</section>
<section id="detect-infeasibility" class="level4" data-number="4.2.6.2">
<h4 data-number="4.2.6.2" class="anchored" data-anchor-id="detect-infeasibility"><span class="header-section-number">4.2.6.2</span> Detect infeasibility</h4>
<div id="cell-104" class="cell" data-execution_count="313">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">142</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">6</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">15</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">6</span>, size<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">26</span>, size<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.random.randint(<span class="dv">20</span>, <span class="dv">50</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>obj_coeff <span class="op">=</span> np.concatenate([c, f])</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>constr_mat <span class="op">=</span> np.concatenate([A, B], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>rhs <span class="op">=</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-105" class="cell" data-execution_count="314">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>gurobi_solver <span class="op">=</span> LpSolverGurobi(obj_coeff, constr_mat, rhs)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>gurobi_solver.save_model(<span class="st">'problem2.lp'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>gurobi_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model is infeasible!</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-execution_count="315">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>scip_solver <span class="op">=</span> LpSolverSCIP(obj_coeff, constr_mat, rhs)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>scip_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model is infeasible!</code></pre>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="338">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericLpMasterSolver(f, B, b)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericLpSubprobSolver(A, c, B, b)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersSolver(master_solver, dual_subprob_solver)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=0.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=60.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
dual subproblem is unbounded
Finish solving dual subproblem.
--------------------------------------------------
DSP is unbounded!!!
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_g=114.29
    opt_y0=0.0
    opt_y1=54.285714285714285
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
</section>
</section>
<section id="implementation-with-callbacks" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="implementation-with-callbacks"><span class="header-section-number">4.2.7</span> Implementation with callbacks</h3>
</section>
<section id="implementation-with-scip" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8" class="anchored" data-anchor-id="implementation-with-scip"><span class="header-section-number">4.2.8</span> Implementation with SCIP</h3>
<div id="cell-110" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> Model</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> quicksum</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> SCIP_PARAMSETTING</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a model</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(<span class="st">"simple_lp"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define variables</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">"C"</span>, name<span class="op">=</span><span class="st">"x1"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">"C"</span>, name<span class="op">=</span><span class="st">"x2"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set objective function</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>model.setObjective(x1 <span class="op">+</span> x2, <span class="st">"maximize"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constraints</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># model.addCons(2 * x1 + x2 &gt;= 1, "constraint1")</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>model.addCons(x1 <span class="op">+</span> x2 <span class="op">&gt;=</span> <span class="dv">2</span>, <span class="st">"constraint2"</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve the model</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>model.setPresolve(SCIP_PARAMSETTING.OFF)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>model.setHeuristics(SCIP_PARAMSETTING.OFF)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>model.disablePropagation()</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>model.optimize()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> model.getStatus()</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'status = </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> model.getStatus() <span class="op">==</span> <span class="st">"optimal"</span>:</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Optimal solution found."</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x1: </span><span class="sc">{</span>model<span class="sc">.</span>getVal(x1)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x2: </span><span class="sc">{</span>model<span class="sc">.</span>getVal(x2)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Objective value: </span><span class="sc">{</span>model<span class="sc">.</span>getObjVal()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    hasRay <span class="op">=</span> model.hasPrimaryRay()</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(hasRay)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> model.getStatus() <span class="op">==</span> <span class="st">'unbounded'</span>:</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    hasRay <span class="op">=</span> model.hasPrimalRay()</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'hasRay=</span><span class="sc">{</span>hasRay<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    ray <span class="op">=</span> model.getPrimalRay()</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'ray=</span><span class="sc">{</span>ray<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Model could not be solved."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>status = unbounded
hasRay=True
ray=[0.5, 0.5]
presolving:
   (0.0s) symmetry computation started: requiring (bin +, int +, cont +), (fixed: bin -, int -, cont -)
   (0.0s) symmetry computation finished: 1 generators found (max: 1500, log10 of symmetry group size: 0.3) (symcode time: 0.00)
   (0.0s) no symmetry on binary variables present.
presolving (0 rounds: 0 fast, 0 medium, 0 exhaustive):
 0 deleted vars, 0 deleted constraints, 0 added constraints, 0 tightened bounds, 0 added holes, 0 changed sides, 0 changed coefficients
 0 implications, 0 cliques
presolved problem has 2 variables (0 bin, 0 int, 0 impl, 2 cont) and 2 constraints
      2 constraints of type &lt;linear&gt;
Presolving Time: 0.00

 time | node  | left  |LP iter|LP it/n|mem/heur|mdpt |vars |cons |rows |cuts |sepa|confs|strbr|  dualbound   | primalbound  |  gap   | compl. 
* 0.0s|     1 |     0 |     2 |     - |    LP  |   0 |   2 |   2 |   2 |   1 |  0 |   0 |   0 |      --      |      --      |   0.00%| unknown

SCIP Status        : problem is solved [unbounded]
Solving Time (sec) : 0.00
Solving Nodes      : 1
Primal Bound       : +1.00000000000000e+20 (1 solutions)
Dual Bound         : +1.00000000000000e+20
Gap                : 0.00 %</code></pre>
</div>
</div>
</section>
<section id="testing" class="level3" data-number="4.2.9">
<h3 data-number="4.2.9" class="anchored" data-anchor-id="testing"><span class="header-section-number">4.2.9</span> Testing</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./env-setup.html" class="pagination-link  aria-label=" &lt;span="" setup&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environment Setup</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>