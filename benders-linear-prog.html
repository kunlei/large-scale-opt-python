<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hands-on Large Scale Optimization in Python - 3&nbsp; Solving Linear Programming Problems with Benders Decomposition</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lagrange-theory.html" rel="next">
<link href="./benders-theory.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XM4LXJY2KJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XM4LXJY2KJ', { 'anonymize_ip': true});
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
    });
    </script>

<!-- This is what works with Quarto -->
<script>
    MathJax = {
        tex: {
            tags: 'ams'  // should be 'ams', 'none', or 'all'
        }
    };
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="Hands-on Large Scale Optimization in Python - 3&nbsp; Solving Linear Programming Problems with Benders Decomposition">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./benders-theory.html">Benders Decomposition</a></li><li class="breadcrumb-item"><a href="./benders-linear-prog.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Solving Linear Programming Problems with Benders Decomposition</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hands-on Large Scale Optimization in Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Benders Decomposition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./benders-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Benders Decomposition Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./benders-linear-prog.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Solving Linear Programming Problems with Benders Decomposition</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lagrangian Relaxation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lagrangian Relaxation Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Assignment Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-constrained-shortest-path.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Constrained Shortest Path Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-tsp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Traveling Salesman Problem</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Column Generation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Column Generation Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-cutting-stock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Cutting Stock Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-scheduling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Scheduling Optimization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lp-solvers-based-on-gurobi-and-scip" id="toc-lp-solvers-based-on-gurobi-and-scip" class="nav-link active" data-scroll-target="#lp-solvers-based-on-gurobi-and-scip"><span class="header-section-number">3.0.1</span> LP solvers based on Gurobi and SCIP</a></li>
  <li><a href="#a-serious-lp-problem-that-cannot-wait-to-be-decomposed" id="toc-a-serious-lp-problem-that-cannot-wait-to-be-decomposed" class="nav-link" data-scroll-target="#a-serious-lp-problem-that-cannot-wait-to-be-decomposed"><span class="header-section-number">3.0.2</span> A serious LP problem that cannot wait to be decomposed!</a></li>
  <li><a href="#benders-decomposition-formulations" id="toc-benders-decomposition-formulations" class="nav-link" data-scroll-target="#benders-decomposition-formulations"><span class="header-section-number">3.0.3</span> Benders decomposition formulations</a></li>
  <li><a href="#benders-decomposition-step-by-step" id="toc-benders-decomposition-step-by-step" class="nav-link" data-scroll-target="#benders-decomposition-step-by-step"><span class="header-section-number">3.0.4</span> Benders decomposition step by step</a></li>
  <li><a href="#benders-decomposition-automated" id="toc-benders-decomposition-automated" class="nav-link" data-scroll-target="#benders-decomposition-automated"><span class="header-section-number">3.0.5</span> Benders decomposition automated</a></li>
  <li><a href="#benders-decomposition---design-and-implementation" id="toc-benders-decomposition---design-and-implementation" class="nav-link" data-scroll-target="#benders-decomposition---design-and-implementation"><span class="header-section-number">3.0.6</span> Benders decomposition - design and implementation</a></li>
  <li><a href="#implementation-with-callbacks" id="toc-implementation-with-callbacks" class="nav-link" data-scroll-target="#implementation-with-callbacks"><span class="header-section-number">3.0.7</span> Implementation with callbacks</a></li>
  <li><a href="#testing-and-validation" id="toc-testing-and-validation" class="nav-link" data-scroll-target="#testing-and-validation"><span class="header-section-number">3.0.8</span> Testing and validation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./benders-theory.html">Benders Decomposition</a></li><li class="breadcrumb-item"><a href="./benders-linear-prog.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Solving Linear Programming Problems with Benders Decomposition</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Solving Linear Programming Problems with Benders Decomposition</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter, we use Benders decomposition to solve several linear programming (LP) problems in order to demonstrate the decomposition logic, especially how the restricted Benders master problem interacts with the subproblem in an iterative approach to reach final optimality. Most linear programs could be solved efficiently nowadays by either open source or commercial solvers without resorting to any decomposition approaches. However, by working through the example problems in the following sections, we aim to showcase the implementation details when applying Benders decomposition algorithm on real problems, which helps solidify our understanding of Benders decomposition. Hopefully, by the end of this chapter, we will build up enough intuition as well as hands-on experience such that we are ready to tackle most involved problems in the following chapters.</p>
<p>In the following sections, we employ several steps to illustrate the problem solving process of Benders decomposition.</p>
<ul>
<li>We will first create two linear programming solvers based on Gurobi and SCIP that can solve any linear programs defined in the standard form. They are used in later section to validate the correctness of the solutions produced by Benders decomposition.</li>
<li>Next, we use a specific linear program and give the corresponding RBMP and DSP to prepare for the implementations.</li>
<li>Then, we will solve the example linear program step by step by examining the outputs of the RBMP and DSP to decided the next set of actions.</li>
<li>Futhermore, a holistic Benders decomposition implementation is then developed to solve the example linear program.</li>
<li>Following the previous step, a more generic Benders decomposition implementation is created.</li>
<li>Then, we will examine an alternative implementation using Gurobi callback functions.</li>
<li>We will also provide an implementation based on SCIP.</li>
<li>In the final section, we will do several benchmarking testing.</li>
</ul>
<section id="lp-solvers-based-on-gurobi-and-scip" class="level3" data-number="3.0.1">
<h3 data-number="3.0.1" class="anchored" data-anchor-id="lp-solvers-based-on-gurobi-and-scip"><span class="header-section-number">3.0.1</span> LP solvers based on Gurobi and SCIP</h3>
<p>We aim to use Benders decomposition to solve several linear programming problems in the following sections. To do that, we intentionally decompose the LP problem under consideration into two sets, one set of <em>complicating</em> variables and the other set containing the remaining variables. In order to validate the correctness of the results obtained by Benders decomposition, we implement two additional ways of solving the target linear programming problems directly. The first option is based on the Gurobi API in python and the other is based on the open source solve SCIP. The two implementations defined here assume the LP problems under consideration follow the below standard form:</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \mathbf{c}^T \mathbf{x} \\
    \text{s.t.} &amp;\quad \mathbf{A} \mathbf{x} = \mathbf{b} \\
    &amp;\quad \mathbf{x} \geq 0
\end{align}\]</span></p>
<p><a href="#lst-solver-gurobi" class="quarto-xref">Listing&nbsp;<span>3.1</span></a> defines a solver for LP problems using Gurobi. It takes three constructor parameters:</p>
<ul>
<li><code>obj_coeff</code>: this corresponds to the objective coefficients <span class="math inline">\(\mathbf{c}\)</span>.</li>
<li><code>constr_mat</code>: this refers to the constraint matrix <span class="math inline">\(\mathbf{A}\)</span>.</li>
<li><code>rhs</code>: this is the right-hand side <span class="math inline">\(\mathbf{b}\)</span>.</li>
</ul>
<p>Inside the constructor <code>__init__()</code>, a solver environment <code>_env</code> is first created and then used to initialize a model object <code>_model</code>. The input parameters are then used to create decision variables <code>_vars</code>, constraints <code>_constrs</code> and objective function respectively. The <code>optimize()</code> function simply solves the problem and shows the solving status. Finally, the <code>clean_up()</code> function frees up the computing resources.</p>
<div id="cell-8" class="cell" data-execution_count="211">
<div id="lst-solver-gurobi" class="python cell-code listing quarto-float" data-code-line-numbers="true">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.1: A LP solver based on Gurobi
</figcaption>
<div aria-describedby="lst-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-solver-gurobi" data-code-line-numbers="true"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-solver-gurobi-1"><a href="#lst-solver-gurobi-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-solver-gurobi-2"><a href="#lst-solver-gurobi-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-solver-gurobi-3"><a href="#lst-solver-gurobi-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-solver-gurobi-4"><a href="#lst-solver-gurobi-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-solver-gurobi-5"><a href="#lst-solver-gurobi-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LpSolverGurobi:</span>
<span id="lst-solver-gurobi-6"><a href="#lst-solver-gurobi-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-7"><a href="#lst-solver-gurobi-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-gurobi-8"><a href="#lst-solver-gurobi-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># initialize environment and model</span></span>
<span id="lst-solver-gurobi-9"><a href="#lst-solver-gurobi-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'GurobiEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-solver-gurobi-10"><a href="#lst-solver-gurobi-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self._env.setParam('LogToConsole', 1 if verbose else 0)</span></span>
<span id="lst-solver-gurobi-11"><a href="#lst-solver-gurobi-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">'OutputFlag'</span>, <span class="dv">1</span> <span class="cf">if</span> verbose <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="lst-solver-gurobi-12"><a href="#lst-solver-gurobi-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-solver-gurobi-13"><a href="#lst-solver-gurobi-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'GurobiLpSolver'</span>)</span>
<span id="lst-solver-gurobi-14"><a href="#lst-solver-gurobi-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-15"><a href="#lst-solver-gurobi-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prepare data</span></span>
<span id="lst-solver-gurobi-16"><a href="#lst-solver-gurobi-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._obj_coeff <span class="op">=</span> obj_coeff</span>
<span id="lst-solver-gurobi-17"><a href="#lst-solver-gurobi-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(self._obj_coeff)</span></span>
<span id="lst-solver-gurobi-18"><a href="#lst-solver-gurobi-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._constr_mat <span class="op">=</span> constr_mat</span>
<span id="lst-solver-gurobi-19"><a href="#lst-solver-gurobi-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(self._constr_mat)</span></span>
<span id="lst-solver-gurobi-20"><a href="#lst-solver-gurobi-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rhs <span class="op">=</span> rhs</span>
<span id="lst-solver-gurobi-21"><a href="#lst-solver-gurobi-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>._obj_coeff)</span>
<span id="lst-solver-gurobi-22"><a href="#lst-solver-gurobi-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_constrs <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>._rhs)</span>
<span id="lst-solver-gurobi-23"><a href="#lst-solver-gurobi-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-24"><a href="#lst-solver-gurobi-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-solver-gurobi-25"><a href="#lst-solver-gurobi-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> <span class="va">self</span>._model.addMVar(<span class="va">self</span>._num_vars, </span>
<span id="lst-solver-gurobi-26"><a href="#lst-solver-gurobi-26" aria-hidden="true" tabindex="-1"></a>                                         vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-solver-gurobi-27"><a href="#lst-solver-gurobi-27" aria-hidden="true" tabindex="-1"></a>                                         lb<span class="op">=</span><span class="dv">0</span>)</span>
<span id="lst-solver-gurobi-28"><a href="#lst-solver-gurobi-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-29"><a href="#lst-solver-gurobi-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-solver-gurobi-30"><a href="#lst-solver-gurobi-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._constrs <span class="op">=</span> <span class="va">self</span>._model.addConstr(</span>
<span id="lst-solver-gurobi-31"><a href="#lst-solver-gurobi-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._constr_mat<span class="op">@</span>self._vars <span class="op">==</span> <span class="va">self</span>._rhs</span>
<span id="lst-solver-gurobi-32"><a href="#lst-solver-gurobi-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="lst-solver-gurobi-33"><a href="#lst-solver-gurobi-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-gurobi-34"><a href="#lst-solver-gurobi-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-solver-gurobi-35"><a href="#lst-solver-gurobi-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="va">self</span>._obj_coeff<span class="op">@</span>self._vars, </span>
<span id="lst-solver-gurobi-36"><a href="#lst-solver-gurobi-36" aria-hidden="true" tabindex="-1"></a>                                 GRB.MINIMIZE)</span>
<span id="lst-solver-gurobi-37"><a href="#lst-solver-gurobi-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-38"><a href="#lst-solver-gurobi-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-gurobi-39"><a href="#lst-solver-gurobi-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-solver-gurobi-40"><a href="#lst-solver-gurobi-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-solver-gurobi-41"><a href="#lst-solver-gurobi-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal solution found!'</span>)</span>
<span id="lst-solver-gurobi-42"><a href="#lst-solver-gurobi-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_model<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-solver-gurobi-43"><a href="#lst-solver-gurobi-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-solver-gurobi-44"><a href="#lst-solver-gurobi-44" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-solver-gurobi-45"><a href="#lst-solver-gurobi-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-solver-gurobi-46"><a href="#lst-solver-gurobi-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-solver-gurobi-47"><a href="#lst-solver-gurobi-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-solver-gurobi-48"><a href="#lst-solver-gurobi-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span>
<span id="lst-solver-gurobi-49"><a href="#lst-solver-gurobi-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-solver-gurobi-50"><a href="#lst-solver-gurobi-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-solver-gurobi-51"><a href="#lst-solver-gurobi-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-solver-gurobi-52"><a href="#lst-solver-gurobi-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-gurobi-53"><a href="#lst-solver-gurobi-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-solver-gurobi-54"><a href="#lst-solver-gurobi-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-solver-gurobi-55"><a href="#lst-solver-gurobi-55" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-solver-scip" class="quarto-xref">Listing&nbsp;<span>3.2</span></a> presents an LP solver implementation in class <code>LpSolverSCIP</code> using SCIP. The constructor requires the same of parameters as defined in <code>LpSolverGurobi</code>. The model building process is similar with minor changes when required to create decision variables, constraints and the objective function.</p>
<div id="cell-10" class="cell" data-execution_count="205">
<div id="lst-solver-scip" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-solver-scip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.2: A LP solver based on SCIP
</figcaption>
<div aria-describedby="lst-solver-scip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-solver-scip"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-solver-scip-1"><a href="#lst-solver-scip-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt <span class="im">as</span> scip</span>
<span id="lst-solver-scip-2"><a href="#lst-solver-scip-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> SCIP_PARAMSETTING</span>
<span id="lst-solver-scip-3"><a href="#lst-solver-scip-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-solver-scip-4"><a href="#lst-solver-scip-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LpSolverSCIP:</span>
<span id="lst-solver-scip-5"><a href="#lst-solver-scip-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-6"><a href="#lst-solver-scip-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-solver-scip-7"><a href="#lst-solver-scip-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> scip.Model(<span class="st">'LpModel'</span>)</span>
<span id="lst-solver-scip-8"><a href="#lst-solver-scip-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> verbose:</span>
<span id="lst-solver-scip-9"><a href="#lst-solver-scip-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.hideOutput()</span>
<span id="lst-solver-scip-10"><a href="#lst-solver-scip-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-11"><a href="#lst-solver-scip-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-solver-scip-12"><a href="#lst-solver-scip-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> {</span>
<span id="lst-solver-scip-13"><a href="#lst-solver-scip-13" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">'C'</span>)</span>
<span id="lst-solver-scip-14"><a href="#lst-solver-scip-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-15"><a href="#lst-solver-scip-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-solver-scip-16"><a href="#lst-solver-scip-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-solver-scip-17"><a href="#lst-solver-scip-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-solver-scip-18"><a href="#lst-solver-scip-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(rhs)):</span>
<span id="lst-solver-scip-19"><a href="#lst-solver-scip-19" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> [</span>
<span id="lst-solver-scip-20"><a href="#lst-solver-scip-20" aria-hidden="true" tabindex="-1"></a>                constr_mat[c][j] <span class="op">*</span> <span class="va">self</span>._vars.get(j)</span>
<span id="lst-solver-scip-21"><a href="#lst-solver-scip-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-22"><a href="#lst-solver-scip-22" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="lst-solver-scip-23"><a href="#lst-solver-scip-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(scip.quicksum(expr) <span class="op">==</span> rhs[c])</span>
<span id="lst-solver-scip-24"><a href="#lst-solver-scip-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-solver-scip-25"><a href="#lst-solver-scip-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-solver-scip-26"><a href="#lst-solver-scip-26" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-solver-scip-27"><a href="#lst-solver-scip-27" aria-hidden="true" tabindex="-1"></a>            obj_coeff[i] <span class="op">*</span> <span class="va">self</span>._vars.get(i)</span>
<span id="lst-solver-scip-28"><a href="#lst-solver-scip-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(obj_coeff))</span>
<span id="lst-solver-scip-29"><a href="#lst-solver-scip-29" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-solver-scip-30"><a href="#lst-solver-scip-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(scip.quicksum(obj_expr), <span class="st">"minimize"</span>)</span>
<span id="lst-solver-scip-31"><a href="#lst-solver-scip-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-solver-scip-32"><a href="#lst-solver-scip-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>):</span>
<span id="lst-solver-scip-33"><a href="#lst-solver-scip-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-solver-scip-34"><a href="#lst-solver-scip-34" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">self</span>._model.getStatus()</span>
<span id="lst-solver-scip-35"><a href="#lst-solver-scip-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> status <span class="op">==</span> <span class="st">"optimal"</span>:</span>
<span id="lst-solver-scip-36"><a href="#lst-solver-scip-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal solution found!'</span>)</span>
<span id="lst-solver-scip-37"><a href="#lst-solver-scip-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_model<span class="sc">.</span>getObjVal()<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-solver-scip-38"><a href="#lst-solver-scip-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"unbounded"</span>:</span>
<span id="lst-solver-scip-39"><a href="#lst-solver-scip-39" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-solver-scip-40"><a href="#lst-solver-scip-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"infeasible"</span>:</span>
<span id="lst-solver-scip-41"><a href="#lst-solver-scip-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-solver-scip-42"><a href="#lst-solver-scip-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-solver-scip-43"><a href="#lst-solver-scip-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-lp-exp1" class="quarto-xref">Listing&nbsp;<span>3.3</span></a> generates a LP problem with 20 decision variables and 5 constraints.</p>
<div id="cell-12" class="cell" data-execution_count="106">
<div id="lst-lp-exp1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-exp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.3: A randomly generated LP problem
</figcaption>
<div aria-describedby="lst-lp-exp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-exp1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp-exp1-1"><a href="#lst-lp-exp1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-lp-exp1-2"><a href="#lst-lp-exp1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp-exp1-3"><a href="#lst-lp-exp1-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="lst-lp-exp1-4"><a href="#lst-lp-exp1-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="lst-lp-exp1-5"><a href="#lst-lp-exp1-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">12</span>, size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">20</span>))</span>
<span id="lst-lp-exp1-6"><a href="#lst-lp-exp1-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.random.randint(<span class="dv">20</span>, <span class="dv">100</span>, size<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-lp-solver-gurobi-test1" class="quarto-xref">Listing&nbsp;<span>3.4</span></a> solves the generated LP using <code>LpSolverGurobi</code> and the solver output shows that an optimal solution was found with objective value of 36.90.</p>
<div id="cell-14" class="cell" data-execution_count="107">
<div id="lst-lp-solver-gurobi-test1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-solver-gurobi-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.4: Solving the generated LP with Gurobi
</figcaption>
<div aria-describedby="lst-lp-solver-gurobi-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-solver-gurobi-test1"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-lp-solver-gurobi-test1-1"><a href="#lst-lp-solver-gurobi-test1-1" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi <span class="op">=</span> LpSolverGurobi(obj_coeff<span class="op">=</span>c, constr_mat<span class="op">=</span>A, rhs<span class="op">=</span>b)</span>
<span id="lst-lp-solver-gurobi-test1-2"><a href="#lst-lp-solver-gurobi-test1-2" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 36.90</code></pre>
</div>
</div>
<p><a href="#lst-lp-solver-scip-test1" class="quarto-xref">Listing&nbsp;<span>3.5</span></a> solves the same LP problem using SCIP and not surprisingly, the same optimal objective value was found. This is not exciting, as it only indicates that the two solvers agree on the optimal solution on such a small LP problem as expected. However, they will become more useful in the following sections when we use them to validate our Benders decomposition results.</p>
<div id="cell-16" class="cell" data-execution_count="108">
<div id="lst-lp-solver-scip-test1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp-solver-scip-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.5: Solving the generated LP with SCIP
</figcaption>
<div aria-describedby="lst-lp-solver-scip-test1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp-solver-scip-test1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp-solver-scip-test1-1"><a href="#lst-lp-solver-scip-test1-1" aria-hidden="true" tabindex="-1"></a>lpsolver_scip <span class="op">=</span> LpSolverSCIP(obj_coeff<span class="op">=</span>c, constr_mat<span class="op">=</span>A, rhs<span class="op">=</span>b)</span>
<span id="lst-lp-solver-scip-test1-2"><a href="#lst-lp-solver-scip-test1-2" aria-hidden="true" tabindex="-1"></a>lpsolver_scip.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 36.90</code></pre>
</div>
</div>
</section>
<section id="a-serious-lp-problem-that-cannot-wait-to-be-decomposed" class="level3" data-number="3.0.2">
<h3 data-number="3.0.2" class="anchored" data-anchor-id="a-serious-lp-problem-that-cannot-wait-to-be-decomposed"><span class="header-section-number">3.0.2</span> A serious LP problem that cannot wait to be decomposed!</h3>
<p>With the validation tools available for use, we are ready to solve some serious LP problems using Benders decomposition! What we have below is a LP problem with five decision variables, three of which are denoted by <span class="math inline">\(\mathbf{x} = (x_1, x_2, x_3)\)</span> and the remaining two variables are denoted by <span class="math inline">\(\mathbf{y} = (y_1, y_2)\)</span>. We assume that <span class="math inline">\(\mathbf{y}\)</span> are the complicating variables.</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 8x_1 + 12x_2 +10x_3 + 15y_1 + 18y_2 \\
    \text{s.t.} &amp;\quad 2x_1 + 3x_2 + 2x_3 + 4y_1 + 5y_2 = 300 \\
    &amp;\quad 4x_1 + 2x_2 + 3x_3 + 2y_1 + 3y_2 = 220 \\
    &amp;\quad x_i \geq 0, \ \forall i = 1, \cdots, 3 \\
    &amp;\quad y_i \geq 0, \ \forall j = 1, 2
\end{align*}\]</span></p>
<p>According to the standard LP form presented in the previous section, <span class="math inline">\(\mathbf{c}^T = (8, 12, 10)\)</span>, <span class="math inline">\(\mathbf{f}^T = (15, 18)\)</span> and <span class="math inline">\(\mathbf{b}^T = (300, 220)\)</span>. In addition,</p>
<p><span class="math display">\[\begin{equation*}
\mathbf{A} =
\begin{bmatrix}
    2 &amp; 3 &amp; 2 \\
    4 &amp; 2 &amp; 3 \\
\end{bmatrix}
\qquad
\mathbf{B} =
\begin{bmatrix}
    4 &amp; 5 \\
    2 &amp; 3 \\
\end{bmatrix}
\end{equation*}\]</span></p>
<p><a href="#lst-lp2" class="quarto-xref">Listing&nbsp;<span>3.6</span></a> solves the LP problem using the two solvers define above. Both solvers confirm the optimal objective value is 1091.43. With this information in mind, we will apply Benders decomposition to see if the same optimal solution could be identified or not.</p>
<div id="cell-23" class="cell" data-execution_count="282">
<div id="lst-lp2" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.6: Solve the LP problem with Gurobi and SCIP
</figcaption>
<div aria-describedby="lst-lp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-lp2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-lp2-1"><a href="#lst-lp2-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">10</span>])</span>
<span id="lst-lp2-2"><a href="#lst-lp2-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.array([<span class="dv">15</span>, <span class="dv">18</span>])</span>
<span id="lst-lp2-3"><a href="#lst-lp2-3" aria-hidden="true" tabindex="-1"></a>obj_coeff <span class="op">=</span> np.concatenate([c, f])</span>
<span id="lst-lp2-4"><a href="#lst-lp2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-5"><a href="#lst-lp2-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="lst-lp2-6"><a href="#lst-lp2-6" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-lp2-7"><a href="#lst-lp2-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([[<span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="lst-lp2-8"><a href="#lst-lp2-8" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-lp2-9"><a href="#lst-lp2-9" aria-hidden="true" tabindex="-1"></a>constr_mat <span class="op">=</span> np.concatenate([A, B], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="lst-lp2-10"><a href="#lst-lp2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-11"><a href="#lst-lp2-11" aria-hidden="true" tabindex="-1"></a>rhs <span class="op">=</span> np.array([<span class="dv">300</span>, <span class="dv">220</span>])</span>
<span id="lst-lp2-12"><a href="#lst-lp2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-13"><a href="#lst-lp2-13" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi <span class="op">=</span> LpSolverGurobi(obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="lst-lp2-14"><a href="#lst-lp2-14" aria-hidden="true" tabindex="-1"></a>lpsolver_gurobi.optimize()</span>
<span id="lst-lp2-15"><a href="#lst-lp2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal objective = 1091.43</span></span>
<span id="lst-lp2-16"><a href="#lst-lp2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-lp2-17"><a href="#lst-lp2-17" aria-hidden="true" tabindex="-1"></a>lpsolver_scip <span class="op">=</span> LpSolverSCIP(obj_coeff, constr_mat, rhs, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="lst-lp2-18"><a href="#lst-lp2-18" aria-hidden="true" tabindex="-1"></a>lpsolver_scip.optimize()</span>
<span id="lst-lp2-19"><a href="#lst-lp2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal objective = 1091.43</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 1091.43
Optimal solution found!
Optimal objective = 1091.43</code></pre>
</div>
</div>
</section>
<section id="benders-decomposition-formulations" class="level3" data-number="3.0.3">
<h3 data-number="3.0.3" class="anchored" data-anchor-id="benders-decomposition-formulations"><span class="header-section-number">3.0.3</span> Benders decomposition formulations</h3>
<p>With <span class="math inline">\(\mathbf{y}\)</span> being the complicating variable, we state the Benders subproblem (<strong>SP</strong>) below for the <span class="math inline">\(\mathbf{y}\)</span> assuming fixed values <span class="math inline">\(\mathbf{\bar{y}} = (\bar{y_1}, \bar{y_2})\)</span>:</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 8x_1 + 12x_2 +10x_3 \\
    \text{s.t.} &amp;\quad 2x_1 + 3x_2 + 2x_3 = 300 - 4\bar{y_1} - 5\bar{y_2} \\
    &amp;\quad 4x_1 + 2x_2 + 3x_3 = 220 - 2\bar{y_1} - 3\bar{y_2} \\
    &amp;\quad x_i \geq 0, \ \forall i = 1, \cdots, 3
\end{align*}\]</span></p>
<p>We define the dual variable <span class="math inline">\(\mathbf{u} = (u_1, u_2)\)</span> to associate with the constraints in the (<strong>SP</strong>). The dual subproblem (<strong>DSP</strong>) could then be stated as follows:</p>
<p><span class="math display">\[\begin{align*}
    \text{max.} &amp;\quad (300 - 4\bar{y_1} - 5\bar{y_2}) u_1 + (220 - 2\bar{y_1} - 3\bar{y_2}) u_2 \\
    \text{s.t.} &amp;\quad 2u_1 + 4u_2 \leq 8\\
    &amp;\quad 3u_1 + 2u_2 \leq 12 \\
    &amp;\quad 2u_1 + 3u_2 \leq 10 \\
    &amp;\quad u_1, u_2\  \text{unrestricted}
\end{align*}\]</span></p>
<p>The (<strong>RBMP</strong>) can be stated as below. Note that <span class="math inline">\(\mathbf{u} = (0, 0)\)</span> is a feasible solution to (<strong>DSP</strong>) and the corresponding objective value is 0, which is the reason we restrict the variable <span class="math inline">\(g\)</span> to be nonnegative.</p>
<p><span class="math display">\[\begin{align*}
    \text{min.} &amp;\quad 15 y_1 + 18 y_2 + g \\
    \text{s.t.} &amp;\quad  y_1, y_2 \geq 0 \\
    &amp;\quad g \geq 0
\end{align*}\]</span></p>
</section>
<section id="benders-decomposition-step-by-step" class="level3" data-number="3.0.4">
<h3 data-number="3.0.4" class="anchored" data-anchor-id="benders-decomposition-step-by-step"><span class="header-section-number">3.0.4</span> Benders decomposition step by step</h3>
<p>Benders decomposition defines a problem solving process in which the restricted Benders master problem and the dual subproblem interact iteratively to identify the optimal solution or conclude infeasibility/unboundedness. To facilitate our understanding of the process, we demonstrate in this section the workings of Benders decomposition by solving the target LP problem step by step.</p>
<p><a href="#lst-bd-rbmp" class="quarto-xref">Listing&nbsp;<span>3.7</span></a> shows the codes that initialize the lower bound <code>lb</code>, upper bound <code>ub</code> and threshold value <code>eps</code>. Furthermore, the restricted Benders master problem <code>rbmp</code> is created with three variables and a minimizing objective function. Note that no constraints are yet included in the model at this moment.</p>
<div id="cell-34" class="cell" data-execution_count="283">
<div id="lst-bd-rbmp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.7: Gurobi solver setup and restricted master problem initialization
</figcaption>
<div aria-describedby="lst-bd-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-rbmp"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-bd-rbmp-1"><a href="#lst-bd-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-bd-rbmp-2"><a href="#lst-bd-rbmp-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-bd-rbmp-3"><a href="#lst-bd-rbmp-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-bd-rbmp-4"><a href="#lst-bd-rbmp-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-5"><a href="#lst-bd-rbmp-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize lower/upper bounds and threshold value</span></span>
<span id="lst-bd-rbmp-6"><a href="#lst-bd-rbmp-6" aria-hidden="true" tabindex="-1"></a>lb <span class="op">=</span> <span class="op">-</span>GRB.INFINITY</span>
<span id="lst-bd-rbmp-7"><a href="#lst-bd-rbmp-7" aria-hidden="true" tabindex="-1"></a>ub <span class="op">=</span> GRB.INFINITY</span>
<span id="lst-bd-rbmp-8"><a href="#lst-bd-rbmp-8" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-bd-rbmp-9"><a href="#lst-bd-rbmp-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-10"><a href="#lst-bd-rbmp-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create restricted Benders master problem</span></span>
<span id="lst-bd-rbmp-11"><a href="#lst-bd-rbmp-11" aria-hidden="true" tabindex="-1"></a>env <span class="op">=</span> gp.Env(<span class="st">'benders'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-bd-rbmp-12"><a href="#lst-bd-rbmp-12" aria-hidden="true" tabindex="-1"></a>env.setParam(<span class="st">'OutputFlag'</span>, <span class="dv">0</span>)</span>
<span id="lst-bd-rbmp-13"><a href="#lst-bd-rbmp-13" aria-hidden="true" tabindex="-1"></a>env.start()</span>
<span id="lst-bd-rbmp-14"><a href="#lst-bd-rbmp-14" aria-hidden="true" tabindex="-1"></a>rbmp <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'RBMP'</span>)</span>
<span id="lst-bd-rbmp-15"><a href="#lst-bd-rbmp-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-16"><a href="#lst-bd-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create decision variables</span></span>
<span id="lst-bd-rbmp-17"><a href="#lst-bd-rbmp-17" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y1'</span>)</span>
<span id="lst-bd-rbmp-18"><a href="#lst-bd-rbmp-18" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y2'</span>)</span>
<span id="lst-bd-rbmp-19"><a href="#lst-bd-rbmp-19" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> rbmp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-bd-rbmp-20"><a href="#lst-bd-rbmp-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-rbmp-21"><a href="#lst-bd-rbmp-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create objective</span></span>
<span id="lst-bd-rbmp-22"><a href="#lst-bd-rbmp-22" aria-hidden="true" tabindex="-1"></a>rbmp.setObjective(<span class="dv">15</span><span class="op">*</span>y1 <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2 <span class="op">+</span> g, GRB.MINIMIZE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-dsp" class="quarto-xref">Listing&nbsp;<span>3.8</span></a> initializes the Benders subproblem with two decision variables and three constraints.</p>
<div id="cell-36" class="cell" data-execution_count="286">
<div id="lst-bd-dsp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.8: Dual subproblem initialization
</figcaption>
<div aria-describedby="lst-bd-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-dsp-1"><a href="#lst-bd-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dual subproblem</span></span>
<span id="lst-bd-dsp-2"><a href="#lst-bd-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'DSP'</span>)</span>
<span id="lst-bd-dsp-3"><a href="#lst-bd-dsp-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-4"><a href="#lst-bd-dsp-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create decision variables</span></span>
<span id="lst-bd-dsp-5"><a href="#lst-bd-dsp-5" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> dsp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-dsp-6"><a href="#lst-bd-dsp-6" aria-hidden="true" tabindex="-1"></a>                lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-7"><a href="#lst-bd-dsp-7" aria-hidden="true" tabindex="-1"></a>                ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-8"><a href="#lst-bd-dsp-8" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'u1'</span>)</span>
<span id="lst-bd-dsp-9"><a href="#lst-bd-dsp-9" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> dsp.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-dsp-10"><a href="#lst-bd-dsp-10" aria-hidden="true" tabindex="-1"></a>                lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-11"><a href="#lst-bd-dsp-11" aria-hidden="true" tabindex="-1"></a>                ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-dsp-12"><a href="#lst-bd-dsp-12" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'u2'</span>)</span>
<span id="lst-bd-dsp-13"><a href="#lst-bd-dsp-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-14"><a href="#lst-bd-dsp-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create objective function</span></span>
<span id="lst-bd-dsp-15"><a href="#lst-bd-dsp-15" aria-hidden="true" tabindex="-1"></a>dsp.setObjective(<span class="dv">300</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">220</span><span class="op">*</span>u2)</span>
<span id="lst-bd-dsp-16"><a href="#lst-bd-dsp-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-17"><a href="#lst-bd-dsp-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create constraints</span></span>
<span id="lst-bd-dsp-18"><a href="#lst-bd-dsp-18" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">2</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">8</span>, name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-dsp-19"><a href="#lst-bd-dsp-19" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">3</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">12</span>, name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-dsp-20"><a href="#lst-bd-dsp-20" aria-hidden="true" tabindex="-1"></a>dsp.addConstr(<span class="dv">2</span><span class="op">*</span>u1 <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>u2 <span class="op">&lt;=</span> <span class="dv">10</span>, name<span class="op">=</span><span class="st">'c3'</span>)</span>
<span id="lst-bd-dsp-21"><a href="#lst-bd-dsp-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-dsp-22"><a href="#lst-bd-dsp-22" aria-hidden="true" tabindex="-1"></a>dsp.update()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>In <a href="#lst-bd-iter1-rbmp" class="quarto-xref">Listing&nbsp;<span>3.9</span></a>, we solve the (<strong>RBMP</strong>) for the first time. It has an optimal solution with <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 0, 0)\)</span> and optimal objective value of 0. This is expected as all the variables assume their minimal possible values in order to minimize the objective function. This objective value also serves as the new lower bound.</p>
<div id="cell-38" class="cell" data-execution_count="287">
<div id="lst-bd-iter1-rbmp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter1-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.9: Iteration 1 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter1-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter1-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter1-rbmp-1"><a href="#lst-bd-iter1-rbmp-1" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter1-rbmp-2"><a href="#lst-bd-iter1-rbmp-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter1-rbmp-3"><a href="#lst-bd-iter1-rbmp-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter1-rbmp-4"><a href="#lst-bd-iter1-rbmp-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-rbmp-5"><a href="#lst-bd-iter1-rbmp-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-rbmp-6"><a href="#lst-bd-iter1-rbmp-6" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter1-rbmp-7"><a href="#lst-bd-iter1-rbmp-7" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter1-rbmp-8"><a href="#lst-bd-iter1-rbmp-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-rbmp-9"><a href="#lst-bd-iter1-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter1-rbmp-10"><a href="#lst-bd-iter1-rbmp-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-rbmp-11"><a href="#lst-bd-iter1-rbmp-11" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter1-rbmp-12"><a href="#lst-bd-iter1-rbmp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 0.00
(y1, y2, g) = (0.00, 0.00, 0.00)
lb=0.0, ub=1e+100</code></pre>
</div>
</div>
<p>Given that <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 0, 0)\)</span>, we now feed the values of <span class="math inline">\(\bar{y_1}\)</span> and <span class="math inline">\(\bar{y_2}\)</span> into the Benders dual subproblem <strong>(DSP)</strong> by updating its objective function, as shown in <a href="#lst-bd-iter1-dsp" class="quarto-xref">Listing&nbsp;<span>3.10</span></a>:</p>
<div id="cell-40" class="cell" data-execution_count="288">
<div id="lst-bd-iter1-dsp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter1-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.10: Iteration 1 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter1-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter1-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter1-dsp-1"><a href="#lst-bd-iter1-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter1-dsp-2"><a href="#lst-bd-iter1-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 <span class="op">+</span> </span>
<span id="lst-bd-iter1-dsp-3"><a href="#lst-bd-iter1-dsp-3" aria-hidden="true" tabindex="-1"></a>                 (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter1-dsp-4"><a href="#lst-bd-iter1-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter1-dsp-5"><a href="#lst-bd-iter1-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter1-dsp-6"><a href="#lst-bd-iter1-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter1-dsp-7"><a href="#lst-bd-iter1-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter1-dsp-8"><a href="#lst-bd-iter1-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter1-dsp-9"><a href="#lst-bd-iter1-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter1-dsp-10"><a href="#lst-bd-iter1-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter1-dsp-11"><a href="#lst-bd-iter1-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter1-dsp-12"><a href="#lst-bd-iter1-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter1-dsp-13"><a href="#lst-bd-iter1-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter1-dsp-14"><a href="#lst-bd-iter1-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal objective = 1200.00
(u1, u2) = (4.00, 0.00)
lb=0.0, ub=1200.0</code></pre>
</div>
</div>
<p>We see that the dual subproblem has an optimal solution. The upper bound <code>ub</code> is also updated. Since the optimal objective value of the subproblem turns out to be 1200 and is greater than <span class="math inline">\(\bar{g} = 0\)</span>, which implies that an optimality cut is needed to make sure that the variable <span class="math inline">\(g\)</span> in the restricted Benders master problem reflects this newly obtained information from the subproblem.</p>
<p>In <a href="#lst-bd-iter2-rbmp" class="quarto-xref">Listing&nbsp;<span>3.11</span></a>, the new optimality cut is added to the (<strong>RBMP</strong>), which is then solved to optimality.</p>
<div id="cell-43" class="cell" data-execution_count="289">
<div id="lst-bd-iter2-rbmp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter2-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.11: Iteration 2 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter2-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter2-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter2-rbmp-1"><a href="#lst-bd-iter2-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add optimality cut</span></span>
<span id="lst-bd-iter2-rbmp-2"><a href="#lst-bd-iter2-rbmp-2" aria-hidden="true" tabindex="-1"></a>rbmp.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2)<span class="op">*</span>u1_opt </span>
<span id="lst-bd-iter2-rbmp-3"><a href="#lst-bd-iter2-rbmp-3" aria-hidden="true" tabindex="-1"></a>               <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2)<span class="op">*</span>u2_opt <span class="op">&lt;=</span> g, </span>
<span id="lst-bd-iter2-rbmp-4"><a href="#lst-bd-iter2-rbmp-4" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-iter2-rbmp-5"><a href="#lst-bd-iter2-rbmp-5" aria-hidden="true" tabindex="-1"></a>rbmp.update()</span>
<span id="lst-bd-iter2-rbmp-6"><a href="#lst-bd-iter2-rbmp-6" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter2-rbmp-7"><a href="#lst-bd-iter2-rbmp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter2-rbmp-8"><a href="#lst-bd-iter2-rbmp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter2-rbmp-9"><a href="#lst-bd-iter2-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-rbmp-10"><a href="#lst-bd-iter2-rbmp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-rbmp-11"><a href="#lst-bd-iter2-rbmp-11" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter2-rbmp-12"><a href="#lst-bd-iter2-rbmp-12" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter2-rbmp-13"><a href="#lst-bd-iter2-rbmp-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-rbmp-14"><a href="#lst-bd-iter2-rbmp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-rbmp-15"><a href="#lst-bd-iter2-rbmp-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-rbmp-16"><a href="#lst-bd-iter2-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter2-rbmp-17"><a href="#lst-bd-iter2-rbmp-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 1080.00
(y1, y2, g) = (0.00, 60.00, 0.00)
lb=1080.0, ub=1200.0</code></pre>
</div>
</div>
<p>Armed with the optimal solution <span class="math inline">\((\bar{y_1}, \bar{y_2}, \bar{g}) = (0, 60, 0)\)</span>, <a href="#lst-bd-iter2-dsp" class="quarto-xref">Listing&nbsp;<span>3.12</span></a> updates the objective function of the (<strong>DSP</strong>) and obtains its optimal solution.</p>
<div id="cell-45" class="cell" data-execution_count="293">
<div id="lst-bd-iter2-dsp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter2-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.12: Iteration 2 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter2-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter2-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter2-dsp-1"><a href="#lst-bd-iter2-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter2-dsp-2"><a href="#lst-bd-iter2-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 </span>
<span id="lst-bd-iter2-dsp-3"><a href="#lst-bd-iter2-dsp-3" aria-hidden="true" tabindex="-1"></a>                 <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter2-dsp-4"><a href="#lst-bd-iter2-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter2-dsp-5"><a href="#lst-bd-iter2-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter2-dsp-6"><a href="#lst-bd-iter2-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter2-dsp-7"><a href="#lst-bd-iter2-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter2-dsp-8"><a href="#lst-bd-iter2-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter2-dsp-9"><a href="#lst-bd-iter2-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter2-dsp-10"><a href="#lst-bd-iter2-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter2-dsp-11"><a href="#lst-bd-iter2-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-dsp-12"><a href="#lst-bd-iter2-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-dsp-13"><a href="#lst-bd-iter2-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter2-dsp-14"><a href="#lst-bd-iter2-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter2-dsp-15"><a href="#lst-bd-iter2-dsp-15" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> dsp.Status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-bd-iter2-dsp-16"><a href="#lst-bd-iter2-dsp-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'DSP is unbounded!'</span>)</span>
<span id="lst-bd-iter2-dsp-17"><a href="#lst-bd-iter2-dsp-17" aria-hidden="true" tabindex="-1"></a>    u1_ray <span class="op">=</span> u1.UnbdRay</span>
<span id="lst-bd-iter2-dsp-18"><a href="#lst-bd-iter2-dsp-18" aria-hidden="true" tabindex="-1"></a>    u2_ray <span class="op">=</span> u2.UnbdRay</span>
<span id="lst-bd-iter2-dsp-19"><a href="#lst-bd-iter2-dsp-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'retrieve extreme ray (u1, u2) = (</span><span class="sc">{</span>u1_ray<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>u2_ray<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter2-dsp-20"><a href="#lst-bd-iter2-dsp-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="lst-bd-iter2-dsp-21"><a href="#lst-bd-iter2-dsp-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'DSP solve error'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>DSP is unbounded!
retrieve extreme ray (u1, u2) = (-2.0, 1.0)</code></pre>
</div>
</div>
<p>Since the dual subproblem is unbounded, a feasibility cut is further needed. In <a href="#lst-bd-iter3-rbmp" class="quarto-xref">Listing&nbsp;<span>3.13</span></a>, we add the new cut and solve the restricted Benders master problem again.</p>
<div id="cell-47" class="cell" data-execution_count="294">
<div id="lst-bd-iter3-rbmp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter3-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.13: Iteration 3 - solving the restricted Benders master problem
</figcaption>
<div aria-describedby="lst-bd-iter3-rbmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter3-rbmp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter3-rbmp-1"><a href="#lst-bd-iter3-rbmp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add optimality cut</span></span>
<span id="lst-bd-iter3-rbmp-2"><a href="#lst-bd-iter3-rbmp-2" aria-hidden="true" tabindex="-1"></a>rbmp.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2)<span class="op">*</span>u1_ray</span>
<span id="lst-bd-iter3-rbmp-3"><a href="#lst-bd-iter3-rbmp-3" aria-hidden="true" tabindex="-1"></a>               <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2)<span class="op">*</span>u2_ray <span class="op">&lt;=</span> <span class="dv">0</span>, </span>
<span id="lst-bd-iter3-rbmp-4"><a href="#lst-bd-iter3-rbmp-4" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-iter3-rbmp-5"><a href="#lst-bd-iter3-rbmp-5" aria-hidden="true" tabindex="-1"></a>rbmp.update()</span>
<span id="lst-bd-iter3-rbmp-6"><a href="#lst-bd-iter3-rbmp-6" aria-hidden="true" tabindex="-1"></a>rbmp.optimize()</span>
<span id="lst-bd-iter3-rbmp-7"><a href="#lst-bd-iter3-rbmp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter3-rbmp-8"><a href="#lst-bd-iter3-rbmp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> rbmp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter3-rbmp-9"><a href="#lst-bd-iter3-rbmp-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal solution found! Objective value = </span><span class="sc">{</span>rbmp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-rbmp-10"><a href="#lst-bd-iter3-rbmp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-rbmp-11"><a href="#lst-bd-iter3-rbmp-11" aria-hidden="true" tabindex="-1"></a>    y1_opt, y2_opt, g_opt <span class="op">=</span> y1.X, y2.X, g.X</span>
<span id="lst-bd-iter3-rbmp-12"><a href="#lst-bd-iter3-rbmp-12" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> np.<span class="bu">max</span>([lb, rbmp.objVal])</span>
<span id="lst-bd-iter3-rbmp-13"><a href="#lst-bd-iter3-rbmp-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-rbmp-14"><a href="#lst-bd-iter3-rbmp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(y1, y2, g) = (</span><span class="sc">{</span>y1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>y2_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>g_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter3-rbmp-15"><a href="#lst-bd-iter3-rbmp-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-rbmp-16"><a href="#lst-bd-iter3-rbmp-16" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> rbmp.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-iter3-rbmp-17"><a href="#lst-bd-iter3-rbmp-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'original problem is infeasible!'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found! Objective value = 1091.43
(y1, y2, g) = (0.00, 54.29, 114.29)
lb=1091.43, ub=1200.00</code></pre>
</div>
</div>
<p>Note that a new lower bound is obtained after solving the master problem. Since there is still a large gap between the lower bound and upper bound, we continue solving the subproblem in <a href="#lst-bd-iter3-dsp" class="quarto-xref">Listing&nbsp;<span>3.14</span></a>.</p>
<div id="cell-49" class="cell" data-execution_count="295">
<div id="lst-bd-iter3-dsp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-iter3-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.14: Iteration 3 - solving the dual subproblem
</figcaption>
<div aria-describedby="lst-bd-iter3-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-iter3-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-iter3-dsp-1"><a href="#lst-bd-iter3-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update objective function</span></span>
<span id="lst-bd-iter3-dsp-2"><a href="#lst-bd-iter3-dsp-2" aria-hidden="true" tabindex="-1"></a>dsp.setObjective((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">5</span><span class="op">*</span>y2_opt)<span class="op">*</span>u1 </span>
<span id="lst-bd-iter3-dsp-3"><a href="#lst-bd-iter3-dsp-3" aria-hidden="true" tabindex="-1"></a>                 <span class="op">+</span> (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>y1_opt<span class="op">-</span><span class="dv">3</span><span class="op">*</span>y2_opt)<span class="op">*</span>u2, </span>
<span id="lst-bd-iter3-dsp-4"><a href="#lst-bd-iter3-dsp-4" aria-hidden="true" tabindex="-1"></a>                 GRB.MAXIMIZE)</span>
<span id="lst-bd-iter3-dsp-5"><a href="#lst-bd-iter3-dsp-5" aria-hidden="true" tabindex="-1"></a>dsp.update()</span>
<span id="lst-bd-iter3-dsp-6"><a href="#lst-bd-iter3-dsp-6" aria-hidden="true" tabindex="-1"></a>dsp.optimize()</span>
<span id="lst-bd-iter3-dsp-7"><a href="#lst-bd-iter3-dsp-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-iter3-dsp-8"><a href="#lst-bd-iter3-dsp-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dsp.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-iter3-dsp-9"><a href="#lst-bd-iter3-dsp-9" aria-hidden="true" tabindex="-1"></a>    u1_opt, u2_opt <span class="op">=</span> u1.X, u2.X</span>
<span id="lst-bd-iter3-dsp-10"><a href="#lst-bd-iter3-dsp-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-iter3-dsp-11"><a href="#lst-bd-iter3-dsp-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span>dsp<span class="sc">.</span>objVal<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-iter3-dsp-12"><a href="#lst-bd-iter3-dsp-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'(u1, u2) = (</span><span class="sc">{</span>u1_opt<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>u2_opt<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-iter3-dsp-13"><a href="#lst-bd-iter3-dsp-13" aria-hidden="true" tabindex="-1"></a>    ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>y1_opt <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>y2_opt <span class="op">+</span> dsp.objVal])</span>
<span id="lst-bd-iter3-dsp-14"><a href="#lst-bd-iter3-dsp-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal objective = 114.29
(u1, u2) = (4.00, 0.00)
lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
<p>Now that the difference between <code>lb</code> and <code>ub</code> is less than the preset threshold <code>eps</code>, we conclude that an optimal solution is reached and the computation resources are freed up.</p>
<div id="cell-51" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># release resources</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>rbmp.dispose()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dsp.dispose()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>env.dispose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benders-decomposition-automated" class="level3" data-number="3.0.5">
<h3 data-number="3.0.5" class="anchored" data-anchor-id="benders-decomposition-automated"><span class="header-section-number">3.0.5</span> Benders decomposition automated</h3>
<p>It typically takes Benders decomposition many iterations to reach optimality or conclude infeasibility/unboundedness. In this section, we put everything we have learned from the manual approach above into an automatic workflow.</p>
<p><a href="#lst-bd-whole-status" class="quarto-xref">Listing&nbsp;<span>3.15</span></a> defines an <code>Enum</code> class that specifies four possible optimization statuses. The meanings of these statuses are self-explanatory from their corresponding names and further explanations are omitted here.</p>
<div id="cell-55" class="cell" data-execution_count="2">
<div id="lst-bd-whole-status" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-status-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.15: Optimization status
</figcaption>
<div aria-describedby="lst-bd-whole-status-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-status"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-status-1"><a href="#lst-bd-whole-status-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gurobipy <span class="im">as</span> gp</span>
<span id="lst-bd-whole-status-2"><a href="#lst-bd-whole-status-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gurobipy <span class="im">import</span> GRB</span>
<span id="lst-bd-whole-status-3"><a href="#lst-bd-whole-status-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-bd-whole-status-4"><a href="#lst-bd-whole-status-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="lst-bd-whole-status-5"><a href="#lst-bd-whole-status-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-status-6"><a href="#lst-bd-whole-status-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OptStatus(Enum):</span>
<span id="lst-bd-whole-status-7"><a href="#lst-bd-whole-status-7" aria-hidden="true" tabindex="-1"></a>    OPTIMAL <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-bd-whole-status-8"><a href="#lst-bd-whole-status-8" aria-hidden="true" tabindex="-1"></a>    UNBOUNDED <span class="op">=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-status-9"><a href="#lst-bd-whole-status-9" aria-hidden="true" tabindex="-1"></a>    INFEASIBLE <span class="op">=</span> <span class="dv">2</span></span>
<span id="lst-bd-whole-status-10"><a href="#lst-bd-whole-status-10" aria-hidden="true" tabindex="-1"></a>    ERROR <span class="op">=</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-master" class="quarto-xref">Listing&nbsp;<span>3.16</span></a> defines a <code>ManualBendersMasterSolver</code> class that models the (<strong>RBMP</strong>). Its constructor contains the variable and objective function definitions. The ability to take in either feasibility or optimality cuts is implemented in separate functions <code>add_feasibility_cut()</code> and <code>add_optimality_cut()</code>, respectively. The <code>solve()</code> function is responsible for optimizing the model and retrieve the optimal solution if any.</p>
<div id="cell-57" class="cell" data-execution_count="3">
<div id="lst-bd-whole-master" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.16: Restricted Benders master model
</figcaption>
<div aria-describedby="lst-bd-whole-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-master"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-master-1"><a href="#lst-bd-whole-master-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ManualBendersMasterSolver:</span>
<span id="lst-bd-whole-master-2"><a href="#lst-bd-whole-master-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-3"><a href="#lst-bd-whole-master-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, env):</span>
<span id="lst-bd-whole-master-4"><a href="#lst-bd-whole-master-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'RBMP'</span>)</span>
<span id="lst-bd-whole-master-5"><a href="#lst-bd-whole-master-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-6"><a href="#lst-bd-whole-master-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-bd-whole-master-7"><a href="#lst-bd-whole-master-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y1 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-8"><a href="#lst-bd-whole-master-8" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y1'</span>)</span>
<span id="lst-bd-whole-master-9"><a href="#lst-bd-whole-master-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y2 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-10"><a href="#lst-bd-whole-master-10" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'y2'</span>)</span>
<span id="lst-bd-whole-master-11"><a href="#lst-bd-whole-master-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-bd-whole-master-12"><a href="#lst-bd-whole-master-12" aria-hidden="true" tabindex="-1"></a>                                     lb<span class="op">=</span><span class="dv">0</span>, name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-bd-whole-master-13"><a href="#lst-bd-whole-master-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-master-14"><a href="#lst-bd-whole-master-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-bd-whole-master-15"><a href="#lst-bd-whole-master-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="dv">15</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">+</span><span class="dv">18</span><span class="op">*</span><span class="va">self</span>._y2<span class="op">+</span><span class="va">self</span>._g, </span>
<span id="lst-bd-whole-master-16"><a href="#lst-bd-whole-master-16" aria-hidden="true" tabindex="-1"></a>                                 GRB.MINIMIZE)</span>
<span id="lst-bd-whole-master-17"><a href="#lst-bd-whole-master-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-18"><a href="#lst-bd-whole-master-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-19"><a href="#lst-bd-whole-master-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-20"><a href="#lst-bd-whole-master-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-21"><a href="#lst-bd-whole-master-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-22"><a href="#lst-bd-whole-master-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-23"><a href="#lst-bd-whole-master-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-bd-whole-master-24"><a href="#lst-bd-whole-master-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-master-25"><a href="#lst-bd-whole-master-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="lst-bd-whole-master-26"><a href="#lst-bd-whole-master-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-bd-whole-master-27"><a href="#lst-bd-whole-master-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-28"><a href="#lst-bd-whole-master-28" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-master-29"><a href="#lst-bd-whole-master-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-whole-master-30"><a href="#lst-bd-whole-master-30" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-bd-whole-master-31"><a href="#lst-bd-whole-master-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-bd-whole-master-32"><a href="#lst-bd-whole-master-32" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y1 <span class="op">=</span> <span class="va">self</span>._y1.X</span>
<span id="lst-bd-whole-master-33"><a href="#lst-bd-whole-master-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y2 <span class="op">=</span> <span class="va">self</span>._y2.X</span>
<span id="lst-bd-whole-master-34"><a href="#lst-bd-whole-master-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._g.X</span>
<span id="lst-bd-whole-master-35"><a href="#lst-bd-whole-master-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="lst-bd-whole-master-36"><a href="#lst-bd-whole-master-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-37"><a href="#lst-bd-whole-master-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y1=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y1<span class="sc">:.2f}</span><span class="ss">, opt_y2=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y2<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-38"><a href="#lst-bd-whole-master-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-master-39"><a href="#lst-bd-whole-master-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-bd-whole-master-40"><a href="#lst-bd-whole-master-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="lst-bd-whole-master-41"><a href="#lst-bd-whole-master-41" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="lst-bd-whole-master-42"><a href="#lst-bd-whole-master-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-bd-whole-master-43"><a href="#lst-bd-whole-master-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="lst-bd-whole-master-44"><a href="#lst-bd-whole-master-44" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-bd-whole-master-45"><a href="#lst-bd-whole-master-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-46"><a href="#lst-bd-whole-master-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="lst-bd-whole-master-47"><a href="#lst-bd-whole-master-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-master-48"><a href="#lst-bd-whole-master-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="lst-bd-whole-master-49"><a href="#lst-bd-whole-master-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-50"><a href="#lst-bd-whole-master-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u1, ray_u2) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-bd-whole-master-51"><a href="#lst-bd-whole-master-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>ray_u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-master-52"><a href="#lst-bd-whole-master-52" aria-hidden="true" tabindex="-1"></a>                              (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>ray_u2 <span class="op">&lt;=</span> </span>
<span id="lst-bd-whole-master-53"><a href="#lst-bd-whole-master-53" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">0</span>)</span>
<span id="lst-bd-whole-master-54"><a href="#lst-bd-whole-master-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="lst-bd-whole-master-55"><a href="#lst-bd-whole-master-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-56"><a href="#lst-bd-whole-master-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u1, opt_u2) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-bd-whole-master-57"><a href="#lst-bd-whole-master-57" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr((<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>opt_u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-master-58"><a href="#lst-bd-whole-master-58" aria-hidden="true" tabindex="-1"></a>                              (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._y2)<span class="op">*</span>opt_u2 <span class="op">&lt;=</span> </span>
<span id="lst-bd-whole-master-59"><a href="#lst-bd-whole-master-59" aria-hidden="true" tabindex="-1"></a>                              <span class="va">self</span>._g)</span>
<span id="lst-bd-whole-master-60"><a href="#lst-bd-whole-master-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="lst-bd-whole-master-61"><a href="#lst-bd-whole-master-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-62"><a href="#lst-bd-whole-master-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-63"><a href="#lst-bd-whole-master-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-bd-whole-master-64"><a href="#lst-bd-whole-master-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-master-65"><a href="#lst-bd-whole-master-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-66"><a href="#lst-bd-whole-master-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-67"><a href="#lst-bd-whole-master-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-bd-whole-master-68"><a href="#lst-bd-whole-master-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-69"><a href="#lst-bd-whole-master-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-70"><a href="#lst-bd-whole-master-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-71"><a href="#lst-bd-whole-master-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y1</span>
<span id="lst-bd-whole-master-72"><a href="#lst-bd-whole-master-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-73"><a href="#lst-bd-whole-master-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-74"><a href="#lst-bd-whole-master-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-75"><a href="#lst-bd-whole-master-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y2</span>
<span id="lst-bd-whole-master-76"><a href="#lst-bd-whole-master-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-master-77"><a href="#lst-bd-whole-master-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-master-78"><a href="#lst-bd-whole-master-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="lst-bd-whole-master-79"><a href="#lst-bd-whole-master-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-dsp" class="quarto-xref">Listing&nbsp;<span>3.17</span></a> defines the Benders dual subproblem in a similar fashion. Notice that the <code>update_objective()</code> function is used to set an updated objective function based on the optimal solution identified in the restricted Benders master problem.</p>
<div id="cell-59" class="cell" data-execution_count="4">
<div id="lst-bd-whole-dsp" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.17: Dual subproblem model
</figcaption>
<div aria-describedby="lst-bd-whole-dsp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-dsp"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-dsp-1"><a href="#lst-bd-whole-dsp-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ManualBendersSubprobSolver:</span>
<span id="lst-bd-whole-dsp-2"><a href="#lst-bd-whole-dsp-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-3"><a href="#lst-bd-whole-dsp-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, env):</span>
<span id="lst-bd-whole-dsp-4"><a href="#lst-bd-whole-dsp-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span>env, name<span class="op">=</span><span class="st">'DSP'</span>)</span>
<span id="lst-bd-whole-dsp-5"><a href="#lst-bd-whole-dsp-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-6"><a href="#lst-bd-whole-dsp-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-bd-whole-dsp-7"><a href="#lst-bd-whole-dsp-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u1 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-whole-dsp-8"><a href="#lst-bd-whole-dsp-8" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-9"><a href="#lst-bd-whole-dsp-9" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-10"><a href="#lst-bd-whole-dsp-10" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u1'</span>)</span>
<span id="lst-bd-whole-dsp-11"><a href="#lst-bd-whole-dsp-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u2 <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-bd-whole-dsp-12"><a href="#lst-bd-whole-dsp-12" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-13"><a href="#lst-bd-whole-dsp-13" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-bd-whole-dsp-14"><a href="#lst-bd-whole-dsp-14" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u2'</span>)</span>
<span id="lst-bd-whole-dsp-15"><a href="#lst-bd-whole-dsp-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-16"><a href="#lst-bd-whole-dsp-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-bd-whole-dsp-17"><a href="#lst-bd-whole-dsp-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">4</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">8</span>, name<span class="op">=</span><span class="st">'c1'</span>)</span>
<span id="lst-bd-whole-dsp-18"><a href="#lst-bd-whole-dsp-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">3</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">12</span>, name<span class="op">=</span><span class="st">'c2'</span>)</span>
<span id="lst-bd-whole-dsp-19"><a href="#lst-bd-whole-dsp-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(<span class="dv">2</span><span class="op">*</span><span class="va">self</span>._u1<span class="op">+</span><span class="dv">3</span><span class="op">*</span><span class="va">self</span>._u2 <span class="op">&lt;=</span> <span class="dv">10</span>, name<span class="op">=</span><span class="st">'c3'</span>)</span>
<span id="lst-bd-whole-dsp-20"><a href="#lst-bd-whole-dsp-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-21"><a href="#lst-bd-whole-dsp-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(<span class="dv">1</span>, GRB.MAXIMIZE)</span>
<span id="lst-bd-whole-dsp-22"><a href="#lst-bd-whole-dsp-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-bd-whole-dsp-23"><a href="#lst-bd-whole-dsp-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-24"><a href="#lst-bd-whole-dsp-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-25"><a href="#lst-bd-whole-dsp-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-26"><a href="#lst-bd-whole-dsp-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-27"><a href="#lst-bd-whole-dsp-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u1 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-28"><a href="#lst-bd-whole-dsp-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u2 <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-29"><a href="#lst-bd-whole-dsp-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-30"><a href="#lst-bd-whole-dsp-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-31"><a href="#lst-bd-whole-dsp-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-dsp-32"><a href="#lst-bd-whole-dsp-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="lst-bd-whole-dsp-33"><a href="#lst-bd-whole-dsp-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-bd-whole-dsp-34"><a href="#lst-bd-whole-dsp-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-35"><a href="#lst-bd-whole-dsp-35" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-bd-whole-dsp-36"><a href="#lst-bd-whole-dsp-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-bd-whole-dsp-37"><a href="#lst-bd-whole-dsp-37" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-bd-whole-dsp-38"><a href="#lst-bd-whole-dsp-38" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u1 <span class="op">=</span> <span class="va">self</span>._u1.X</span>
<span id="lst-bd-whole-dsp-39"><a href="#lst-bd-whole-dsp-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u2 <span class="op">=</span> <span class="va">self</span>._u2.X</span>
<span id="lst-bd-whole-dsp-40"><a href="#lst-bd-whole-dsp-40" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-bd-whole-dsp-41"><a href="#lst-bd-whole-dsp-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="lst-bd-whole-dsp-42"><a href="#lst-bd-whole-dsp-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-dsp-43"><a href="#lst-bd-whole-dsp-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y1=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u1<span class="sc">:.2f}</span><span class="ss">, opt_y2=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u2<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-dsp-44"><a href="#lst-bd-whole-dsp-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-bd-whole-dsp-45"><a href="#lst-bd-whole-dsp-45" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="lst-bd-whole-dsp-46"><a href="#lst-bd-whole-dsp-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is unbounded!'</span>)</span>
<span id="lst-bd-whole-dsp-47"><a href="#lst-bd-whole-dsp-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u1 <span class="op">=</span> <span class="va">self</span>._u1.UnbdRay</span>
<span id="lst-bd-whole-dsp-48"><a href="#lst-bd-whole-dsp-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u2 <span class="op">=</span> <span class="va">self</span>._u2.UnbdRay</span>
<span id="lst-bd-whole-dsp-49"><a href="#lst-bd-whole-dsp-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">extreme ray (u1, u2) = (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_ray_u1<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_ray_u2<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="lst-bd-whole-dsp-50"><a href="#lst-bd-whole-dsp-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-bd-whole-dsp-51"><a href="#lst-bd-whole-dsp-51" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-bd-whole-dsp-52"><a href="#lst-bd-whole-dsp-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-53"><a href="#lst-bd-whole-dsp-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="lst-bd-whole-dsp-54"><a href="#lst-bd-whole-dsp-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-bd-whole-dsp-55"><a href="#lst-bd-whole-dsp-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="lst-bd-whole-dsp-56"><a href="#lst-bd-whole-dsp-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-57"><a href="#lst-bd-whole-dsp-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y1, opt_y2):</span>
<span id="lst-bd-whole-dsp-58"><a href="#lst-bd-whole-dsp-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="lst-bd-whole-dsp-59"><a href="#lst-bd-whole-dsp-59" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">300</span><span class="op">-</span><span class="dv">4</span><span class="op">*</span>opt_y1<span class="op">-</span><span class="dv">5</span><span class="op">*</span>opt_y2)<span class="op">*</span><span class="va">self</span>._u1 <span class="op">+</span> </span>
<span id="lst-bd-whole-dsp-60"><a href="#lst-bd-whole-dsp-60" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">220</span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>opt_y1<span class="op">-</span><span class="dv">3</span><span class="op">*</span>opt_y2)<span class="op">*</span><span class="va">self</span>._u2, </span>
<span id="lst-bd-whole-dsp-61"><a href="#lst-bd-whole-dsp-61" aria-hidden="true" tabindex="-1"></a>            GRB.MAXIMIZE)</span>
<span id="lst-bd-whole-dsp-62"><a href="#lst-bd-whole-dsp-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="lst-bd-whole-dsp-63"><a href="#lst-bd-whole-dsp-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-64"><a href="#lst-bd-whole-dsp-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-65"><a href="#lst-bd-whole-dsp-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-bd-whole-dsp-66"><a href="#lst-bd-whole-dsp-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-dsp-67"><a href="#lst-bd-whole-dsp-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-68"><a href="#lst-bd-whole-dsp-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-69"><a href="#lst-bd-whole-dsp-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-bd-whole-dsp-70"><a href="#lst-bd-whole-dsp-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-71"><a href="#lst-bd-whole-dsp-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-72"><a href="#lst-bd-whole-dsp-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-73"><a href="#lst-bd-whole-dsp-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u1</span>
<span id="lst-bd-whole-dsp-74"><a href="#lst-bd-whole-dsp-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-75"><a href="#lst-bd-whole-dsp-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-76"><a href="#lst-bd-whole-dsp-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-77"><a href="#lst-bd-whole-dsp-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u2</span>
<span id="lst-bd-whole-dsp-78"><a href="#lst-bd-whole-dsp-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-79"><a href="#lst-bd-whole-dsp-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-80"><a href="#lst-bd-whole-dsp-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u1(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-81"><a href="#lst-bd-whole-dsp-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u1</span>
<span id="lst-bd-whole-dsp-82"><a href="#lst-bd-whole-dsp-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-dsp-83"><a href="#lst-bd-whole-dsp-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-bd-whole-dsp-84"><a href="#lst-bd-whole-dsp-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u2(<span class="va">self</span>):</span>
<span id="lst-bd-whole-dsp-85"><a href="#lst-bd-whole-dsp-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-workflow" class="quarto-xref">Listing&nbsp;<span>3.18</span></a> shows the control flow of Benders decomposition. The main logic is stated as a <code>while</code> loop, in which the master problem and dual subproblem are solved sequentially within each iteration. Depending on whether the subproblem is optimal or unbounded, an optimality or feasibility cut is added to the master problem. The process continues until the gap between the lower bound and the upper bound is within a certain threshold.</p>
<div id="cell-61" class="cell" data-execution_count="5">
<div id="lst-bd-whole-workflow" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.18: Benders decomposition control flow
</figcaption>
<div aria-describedby="lst-bd-whole-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-workflow"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-workflow-1"><a href="#lst-bd-whole-workflow-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ManualBendersDecomposition:</span>
<span id="lst-bd-whole-workflow-2"><a href="#lst-bd-whole-workflow-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-workflow-3"><a href="#lst-bd-whole-workflow-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, master_solver, dual_subprob_solver):</span>
<span id="lst-bd-whole-workflow-4"><a href="#lst-bd-whole-workflow-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._master_solver <span class="op">=</span> master_solver</span>
<span id="lst-bd-whole-workflow-5"><a href="#lst-bd-whole-workflow-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dual_subprob_solver <span class="op">=</span> dual_subprob_solver</span>
<span id="lst-bd-whole-workflow-6"><a href="#lst-bd-whole-workflow-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-workflow-7"><a href="#lst-bd-whole-workflow-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-whole-workflow-8"><a href="#lst-bd-whole-workflow-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-bd-whole-workflow-9"><a href="#lst-bd-whole-workflow-9" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-bd-whole-workflow-10"><a href="#lst-bd-whole-workflow-10" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="lst-bd-whole-workflow-11"><a href="#lst-bd-whole-workflow-11" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="lst-bd-whole-workflow-12"><a href="#lst-bd-whole-workflow-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-whole-workflow-13"><a href="#lst-bd-whole-workflow-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-workflow-14"><a href="#lst-bd-whole-workflow-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="lst-bd-whole-workflow-15"><a href="#lst-bd-whole-workflow-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Iteration: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="lst-bd-whole-workflow-16"><a href="#lst-bd-whole-workflow-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-bd-whole-workflow-17"><a href="#lst-bd-whole-workflow-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve master problem</span></span>
<span id="lst-bd-whole-workflow-18"><a href="#lst-bd-whole-workflow-18" aria-hidden="true" tabindex="-1"></a>            master_status <span class="op">=</span> <span class="va">self</span>._master_solver.solve()</span>
<span id="lst-bd-whole-workflow-19"><a href="#lst-bd-whole-workflow-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> master_status <span class="op">==</span> OptStatus.INFEASIBLE:</span>
<span id="lst-bd-whole-workflow-20"><a href="#lst-bd-whole-workflow-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> OptStatus.INFEASIBLE</span>
<span id="lst-bd-whole-workflow-21"><a href="#lst-bd-whole-workflow-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-22"><a href="#lst-bd-whole-workflow-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update lower bound</span></span>
<span id="lst-bd-whole-workflow-23"><a href="#lst-bd-whole-workflow-23" aria-hidden="true" tabindex="-1"></a>            lb <span class="op">=</span> np.<span class="bu">max</span>([lb, <span class="va">self</span>._master_solver.opt_obj])</span>
<span id="lst-bd-whole-workflow-24"><a href="#lst-bd-whole-workflow-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-workflow-25"><a href="#lst-bd-whole-workflow-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-26"><a href="#lst-bd-whole-workflow-26" aria-hidden="true" tabindex="-1"></a>            opt_y1 <span class="op">=</span> <span class="va">self</span>._master_solver.opt_y1</span>
<span id="lst-bd-whole-workflow-27"><a href="#lst-bd-whole-workflow-27" aria-hidden="true" tabindex="-1"></a>            opt_y2 <span class="op">=</span> <span class="va">self</span>._master_solver.opt_y2</span>
<span id="lst-bd-whole-workflow-28"><a href="#lst-bd-whole-workflow-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-29"><a href="#lst-bd-whole-workflow-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve subproblem</span></span>
<span id="lst-bd-whole-workflow-30"><a href="#lst-bd-whole-workflow-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._dual_subprob_solver.update_objective(opt_y1, opt_y2)</span>
<span id="lst-bd-whole-workflow-31"><a href="#lst-bd-whole-workflow-31" aria-hidden="true" tabindex="-1"></a>            dsp_status <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.solve()</span>
<span id="lst-bd-whole-workflow-32"><a href="#lst-bd-whole-workflow-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-whole-workflow-33"><a href="#lst-bd-whole-workflow-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dsp_status <span class="op">==</span> OptStatus.OPTIMAL:</span>
<span id="lst-bd-whole-workflow-34"><a href="#lst-bd-whole-workflow-34" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update upper bound</span></span>
<span id="lst-bd-whole-workflow-35"><a href="#lst-bd-whole-workflow-35" aria-hidden="true" tabindex="-1"></a>                opt_obj <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_obj</span>
<span id="lst-bd-whole-workflow-36"><a href="#lst-bd-whole-workflow-36" aria-hidden="true" tabindex="-1"></a>                ub <span class="op">=</span> np.<span class="bu">min</span>([ub, <span class="dv">15</span><span class="op">*</span>opt_y1 <span class="op">+</span> <span class="dv">18</span><span class="op">*</span>opt_y2 <span class="op">+</span> opt_obj])</span>
<span id="lst-bd-whole-workflow-37"><a href="#lst-bd-whole-workflow-37" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-whole-workflow-38"><a href="#lst-bd-whole-workflow-38" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-whole-workflow-39"><a href="#lst-bd-whole-workflow-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ub <span class="op">-</span> lb <span class="op">&lt;=</span> eps:</span>
<span id="lst-bd-whole-workflow-40"><a href="#lst-bd-whole-workflow-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="lst-bd-whole-workflow-41"><a href="#lst-bd-whole-workflow-41" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-whole-workflow-42"><a href="#lst-bd-whole-workflow-42" aria-hidden="true" tabindex="-1"></a>                opt_u1 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_u1</span>
<span id="lst-bd-whole-workflow-43"><a href="#lst-bd-whole-workflow-43" aria-hidden="true" tabindex="-1"></a>                opt_u2 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.opt_u2</span>
<span id="lst-bd-whole-workflow-44"><a href="#lst-bd-whole-workflow-44" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_optimality_cut(opt_u1, opt_u2) </span>
<span id="lst-bd-whole-workflow-45"><a href="#lst-bd-whole-workflow-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> dsp_status <span class="op">==</span> OptStatus.UNBOUNDED:</span>
<span id="lst-bd-whole-workflow-46"><a href="#lst-bd-whole-workflow-46" aria-hidden="true" tabindex="-1"></a>                ray_u1 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.ray_u1</span>
<span id="lst-bd-whole-workflow-47"><a href="#lst-bd-whole-workflow-47" aria-hidden="true" tabindex="-1"></a>                ray_u2 <span class="op">=</span> <span class="va">self</span>._dual_subprob_solver.ray_u2</span>
<span id="lst-bd-whole-workflow-48"><a href="#lst-bd-whole-workflow-48" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_solver.add_feasibility_cut(ray_u1, ray_u2) </span>
<span id="lst-bd-whole-workflow-49"><a href="#lst-bd-whole-workflow-49" aria-hidden="true" tabindex="-1"></a>            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-bd-whole-exp-1" class="quarto-xref">Listing&nbsp;<span>3.19</span></a> solves the LP problem using the wholesome Benders solver. The optimal solution agrees with the solution obtained in the manual approach.</p>
<div id="cell-63" class="cell" data-execution_count="6">
<div id="lst-bd-whole-exp-1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-whole-exp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.19: Solving the LP problem using Benders decomposition
</figcaption>
<div aria-describedby="lst-bd-whole-exp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-whole-exp-1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-whole-exp-1-1"><a href="#lst-bd-whole-exp-1-1" aria-hidden="true" tabindex="-1"></a>env <span class="op">=</span> gp.Env(<span class="st">'benders'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-bd-whole-exp-1-2"><a href="#lst-bd-whole-exp-1-2" aria-hidden="true" tabindex="-1"></a>env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-bd-whole-exp-1-3"><a href="#lst-bd-whole-exp-1-3" aria-hidden="true" tabindex="-1"></a>env.start()</span>
<span id="lst-bd-whole-exp-1-4"><a href="#lst-bd-whole-exp-1-4" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> ManualBendersMasterSolver(env)</span>
<span id="lst-bd-whole-exp-1-5"><a href="#lst-bd-whole-exp-1-5" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> ManualBendersSubprobSolver(env)</span>
<span id="lst-bd-whole-exp-1-6"><a href="#lst-bd-whole-exp-1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-bd-whole-exp-1-7"><a href="#lst-bd-whole-exp-1-7" aria-hidden="true" tabindex="-1"></a>benders_decomposition <span class="op">=</span> ManualBendersDecomposition(master_solver, dual_subprob_solver)</span>
<span id="lst-bd-whole-exp-1-8"><a href="#lst-bd-whole-exp-1-8" aria-hidden="true" tabindex="-1"></a>benders_decomposition.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_y1=0.00, opt_y2=0.00
    opt_g=0.00
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_y1=4.00, opt_y2=0.00
Finish solving dual subproblem.
--------------------------------------------------
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_y1=0.00, opt_y2=60.00
    opt_g=0.00
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is unbounded!
    extreme ray (u1, u2) = (-2.0, 1.0)
Finish solving dual subproblem.
--------------------------------------------------
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_y1=0.00, opt_y2=54.29
    opt_g=114.29
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_y1=4.00, opt_y2=0.00
Finish solving dual subproblem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
</section>
<section id="benders-decomposition---design-and-implementation" class="level3" data-number="3.0.6">
<h3 data-number="3.0.6" class="anchored" data-anchor-id="benders-decomposition---design-and-implementation"><span class="header-section-number">3.0.6</span> Benders decomposition - design and implementation</h3>
<p>The Benders decomposition algorithm we put together in the last section is a big step towards automating the interaction between the master problem optimizer and the dual subproblem optimizer. However, it is still limited in that both optimizers are tied to a specific problem instance. Even a slight change in the instance data requires an updated optimizer implementation. Ideally, we would like to to have an algorithm that could solve various LP problems as long as they follow the same form.</p>
<p>In addition, we might want to have the flexibility to switch to different solvers within the master and dual subproblem optimizers. A good algorithm design should allow alternative implementations with minimal impact on the overall algorithm structure.</p>
<p>With these needs in mind, in this section, we aim to design a Benders decomposition algorithm that can solve any LP problems following a standard form and allow various implementations in both the master problem and dual subproblem optimizers.</p>
<p>We develop the algorithm in three steps. First, we present a Benders decomposition algorithm design that focuses on the overall algorithm workflow and only the abstract implementations of the master problem and dual subproblem optimizers. Next, an implementation of the Benders decomposition based on Gurobi is demonstrated. Lastly, an alternative implementation based on the open source solver SCIP is illustrated.</p>
<section id="benders-decomposition-algorithm-design" class="level4" data-number="3.0.6.1">
<h4 data-number="3.0.6.1" class="anchored" data-anchor-id="benders-decomposition-algorithm-design"><span class="header-section-number">3.0.6.1</span> Benders decomposition algorithm design</h4>
<p>We could see from the previous sections that Benders decomposition involves three key components:</p>
<ul>
<li>An optimizer that solves the master problem</li>
<li>An optimizer that solves the dual subproblem</li>
<li>An orchestrator that dictates the interaction between the two optimizers</li>
</ul>
<p>To be able to solve LP problems of various sizes, both the master and dual subproblem optimizers must take a generic form and not be tied to a fixed number of various and/or constraints. Furthermore, to be able to switch to different solvers, both optimizers need to conform to a common interface.</p>
<p>To this end, <a href="#lst-base-class-master" class="quarto-xref">Listing&nbsp;<span>3.21</span></a> defines a base class for master problem optimizers. The constructor <code>__init__()</code> takes three inputs, namely, objective coefficients, constraint matrix and the right-hand side. Any concrete implementation of the base class is responsible for constructing a model from these three input values using solver-specific modeling languages. The base class also defines several other key functions:</p>
<ul>
<li><code>solve()</code>: this is the function that invokes solver-specific optimization process and saves the corresponding optimization results.</li>
<li><code>add_feasibility_cut()</code>: this function takes an extreme ray identified by the dual subproblem optimizer and adds a feasibility cut to the master problem.</li>
<li><code>add_optimality_cut()</code>: this function takes an optimal solution identified by the dual subproblem optimizer and adds an optimality cut to the master problem.</li>
<li><code>opt_obj_val()</code>: this function returns the optimal objective value obtained.</li>
<li><code>opt_val_for_complicating_vars()</code>: this function returns the optimal solution values for all the complicating decision variables.</li>
<li><code>opt_val_for_surrogate_var()</code>: this function returns the optimal value of the surrogate variable.</li>
</ul>
<div id="cell-69" class="cell" data-execution_count="41">
<div id="lst-base-class-master" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-base-class-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.20: Base class for restricted master problem implementations
</figcaption>
<div aria-describedby="lst-base-class-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-base-class-master"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-base-class-master-1"><a href="#lst-base-class-master-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="lst-base-class-master-2"><a href="#lst-base-class-master-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict</span>
<span id="lst-base-class-master-3"><a href="#lst-base-class-master-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-base-class-master-4"><a href="#lst-base-class-master-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-5"><a href="#lst-base-class-master-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BendersMasterOptimizer(ABC):</span>
<span id="lst-base-class-master-6"><a href="#lst-base-class-master-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""base class for master solver implementation</span></span>
<span id="lst-base-class-master-7"><a href="#lst-base-class-master-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-8"><a href="#lst-base-class-master-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="lst-base-class-master-9"><a href="#lst-base-class-master-9" aria-hidden="true" tabindex="-1"></a><span class="co">        ABC (ABCMeta): helper class</span></span>
<span id="lst-base-class-master-10"><a href="#lst-base-class-master-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="lst-base-class-master-11"><a href="#lst-base-class-master-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-12"><a href="#lst-base-class-master-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, objective_coefficients: np.array, </span>
<span id="lst-base-class-master-13"><a href="#lst-base-class-master-13" aria-hidden="true" tabindex="-1"></a>                 constraint_matrix: np.array, </span>
<span id="lst-base-class-master-14"><a href="#lst-base-class-master-14" aria-hidden="true" tabindex="-1"></a>                 right_hand_side: np.array):</span>
<span id="lst-base-class-master-15"><a href="#lst-base-class-master-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""constructor for master problem model initialization.</span></span>
<span id="lst-base-class-master-16"><a href="#lst-base-class-master-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Note that two types of variables will be created:</span></span>
<span id="lst-base-class-master-17"><a href="#lst-base-class-master-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - the complicating variables</span></span>
<span id="lst-base-class-master-18"><a href="#lst-base-class-master-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - the surrogate variable</span></span>
<span id="lst-base-class-master-19"><a href="#lst-base-class-master-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-20"><a href="#lst-base-class-master-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="lst-base-class-master-21"><a href="#lst-base-class-master-21" aria-hidden="true" tabindex="-1"></a><span class="co">            objective_coefficients (np.array): an array of size n that </span></span>
<span id="lst-base-class-master-22"><a href="#lst-base-class-master-22" aria-hidden="true" tabindex="-1"></a><span class="co">                defines the coefficient value for each variable in the </span></span>
<span id="lst-base-class-master-23"><a href="#lst-base-class-master-23" aria-hidden="true" tabindex="-1"></a><span class="co">                master problem objective function.</span></span>
<span id="lst-base-class-master-24"><a href="#lst-base-class-master-24" aria-hidden="true" tabindex="-1"></a><span class="co">            constraint_matrix (np.array): a matrix of size m * n that </span></span>
<span id="lst-base-class-master-25"><a href="#lst-base-class-master-25" aria-hidden="true" tabindex="-1"></a><span class="co">                defines the constraint coefficients.</span></span>
<span id="lst-base-class-master-26"><a href="#lst-base-class-master-26" aria-hidden="true" tabindex="-1"></a><span class="co">            right_hand_side (np.array): an array of size n that </span></span>
<span id="lst-base-class-master-27"><a href="#lst-base-class-master-27" aria-hidden="true" tabindex="-1"></a><span class="co">                defines the right hand side for each constraint.</span></span>
<span id="lst-base-class-master-28"><a href="#lst-base-class-master-28" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-29"><a href="#lst-base-class-master-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-30"><a href="#lst-base-class-master-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-31"><a href="#lst-base-class-master-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-32"><a href="#lst-base-class-master-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-base-class-master-33"><a href="#lst-base-class-master-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""solve the problem and return optimization status</span></span>
<span id="lst-base-class-master-34"><a href="#lst-base-class-master-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-35"><a href="#lst-base-class-master-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-36"><a href="#lst-base-class-master-36" aria-hidden="true" tabindex="-1"></a><span class="co">            OptStatus: an enum object</span></span>
<span id="lst-base-class-master-37"><a href="#lst-base-class-master-37" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-38"><a href="#lst-base-class-master-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-39"><a href="#lst-base-class-master-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-40"><a href="#lst-base-class-master-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-41"><a href="#lst-base-class-master-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, extreme_ray: Dict[<span class="bu">int</span>, <span class="bu">float</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-base-class-master-42"><a href="#lst-base-class-master-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""add feasibility cut.</span></span>
<span id="lst-base-class-master-43"><a href="#lst-base-class-master-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-44"><a href="#lst-base-class-master-44" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="lst-base-class-master-45"><a href="#lst-base-class-master-45" aria-hidden="true" tabindex="-1"></a><span class="co">            extreme_ray (Dict[int, float]): a mapping between variable key </span></span>
<span id="lst-base-class-master-46"><a href="#lst-base-class-master-46" aria-hidden="true" tabindex="-1"></a><span class="co">                and extreme ray element. For example:</span></span>
<span id="lst-base-class-master-47"><a href="#lst-base-class-master-47" aria-hidden="true" tabindex="-1"></a><span class="co">                extreme_ray = {</span></span>
<span id="lst-base-class-master-48"><a href="#lst-base-class-master-48" aria-hidden="true" tabindex="-1"></a><span class="co">                    0: 1.0,</span></span>
<span id="lst-base-class-master-49"><a href="#lst-base-class-master-49" aria-hidden="true" tabindex="-1"></a><span class="co">                    1: 2.0</span></span>
<span id="lst-base-class-master-50"><a href="#lst-base-class-master-50" aria-hidden="true" tabindex="-1"></a><span class="co">                }</span></span>
<span id="lst-base-class-master-51"><a href="#lst-base-class-master-51" aria-hidden="true" tabindex="-1"></a><span class="co">                It is assumed that the key type is integer.</span></span>
<span id="lst-base-class-master-52"><a href="#lst-base-class-master-52" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-53"><a href="#lst-base-class-master-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-54"><a href="#lst-base-class-master-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-55"><a href="#lst-base-class-master-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-56"><a href="#lst-base-class-master-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_sol: Dict[<span class="bu">int</span>, <span class="bu">float</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-base-class-master-57"><a href="#lst-base-class-master-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""add optimality cut.</span></span>
<span id="lst-base-class-master-58"><a href="#lst-base-class-master-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-59"><a href="#lst-base-class-master-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="lst-base-class-master-60"><a href="#lst-base-class-master-60" aria-hidden="true" tabindex="-1"></a><span class="co">            opt_sol (Dict[int, float]): a mapping between variable key </span></span>
<span id="lst-base-class-master-61"><a href="#lst-base-class-master-61" aria-hidden="true" tabindex="-1"></a><span class="co">                and optimal solution element. For example:</span></span>
<span id="lst-base-class-master-62"><a href="#lst-base-class-master-62" aria-hidden="true" tabindex="-1"></a><span class="co">                opt_sol = {</span></span>
<span id="lst-base-class-master-63"><a href="#lst-base-class-master-63" aria-hidden="true" tabindex="-1"></a><span class="co">                    0: 1.0,</span></span>
<span id="lst-base-class-master-64"><a href="#lst-base-class-master-64" aria-hidden="true" tabindex="-1"></a><span class="co">                    1: 2.0</span></span>
<span id="lst-base-class-master-65"><a href="#lst-base-class-master-65" aria-hidden="true" tabindex="-1"></a><span class="co">                }</span></span>
<span id="lst-base-class-master-66"><a href="#lst-base-class-master-66" aria-hidden="true" tabindex="-1"></a><span class="co">                It is assumed that the key type is integer.</span></span>
<span id="lst-base-class-master-67"><a href="#lst-base-class-master-67" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-68"><a href="#lst-base-class-master-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-69"><a href="#lst-base-class-master-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-70"><a href="#lst-base-class-master-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-71"><a href="#lst-base-class-master-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_val(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="lst-base-class-master-72"><a href="#lst-base-class-master-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal objective value if exists</span></span>
<span id="lst-base-class-master-73"><a href="#lst-base-class-master-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-74"><a href="#lst-base-class-master-74" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-75"><a href="#lst-base-class-master-75" aria-hidden="true" tabindex="-1"></a><span class="co">            float: objective value</span></span>
<span id="lst-base-class-master-76"><a href="#lst-base-class-master-76" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-77"><a href="#lst-base-class-master-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-78"><a href="#lst-base-class-master-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-79"><a href="#lst-base-class-master-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-80"><a href="#lst-base-class-master-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_val_comp(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="lst-base-class-master-81"><a href="#lst-base-class-master-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal objective value for the complicating variables</span></span>
<span id="lst-base-class-master-82"><a href="#lst-base-class-master-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-83"><a href="#lst-base-class-master-83" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-84"><a href="#lst-base-class-master-84" aria-hidden="true" tabindex="-1"></a><span class="co">            float: objective value for the complicating variables</span></span>
<span id="lst-base-class-master-85"><a href="#lst-base-class-master-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-86"><a href="#lst-base-class-master-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-87"><a href="#lst-base-class-master-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-88"><a href="#lst-base-class-master-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-89"><a href="#lst-base-class-master-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_val_for_complicating_vars(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">int</span>, <span class="bu">float</span>]:</span>
<span id="lst-base-class-master-90"><a href="#lst-base-class-master-90" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal solution values for complicating variables</span></span>
<span id="lst-base-class-master-91"><a href="#lst-base-class-master-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-92"><a href="#lst-base-class-master-92" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-93"><a href="#lst-base-class-master-93" aria-hidden="true" tabindex="-1"></a><span class="co">            Dict[int, float]: mapping between variable key and optimal value.</span></span>
<span id="lst-base-class-master-94"><a href="#lst-base-class-master-94" aria-hidden="true" tabindex="-1"></a><span class="co">            For example, opt_val = {</span></span>
<span id="lst-base-class-master-95"><a href="#lst-base-class-master-95" aria-hidden="true" tabindex="-1"></a><span class="co">                0: 2.0,</span></span>
<span id="lst-base-class-master-96"><a href="#lst-base-class-master-96" aria-hidden="true" tabindex="-1"></a><span class="co">                1: 3.0</span></span>
<span id="lst-base-class-master-97"><a href="#lst-base-class-master-97" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="lst-base-class-master-98"><a href="#lst-base-class-master-98" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-99"><a href="#lst-base-class-master-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-100"><a href="#lst-base-class-master-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-101"><a href="#lst-base-class-master-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-102"><a href="#lst-base-class-master-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_val_for_surrogate_var(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="lst-base-class-master-103"><a href="#lst-base-class-master-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal value for the surrogate variable</span></span>
<span id="lst-base-class-master-104"><a href="#lst-base-class-master-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-105"><a href="#lst-base-class-master-105" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-106"><a href="#lst-base-class-master-106" aria-hidden="true" tabindex="-1"></a><span class="co">            float: optimal value for the surrogate variable</span></span>
<span id="lst-base-class-master-107"><a href="#lst-base-class-master-107" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-108"><a href="#lst-base-class-master-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Similarly, <a href="#lst-base-class-master" class="quarto-xref">Listing&nbsp;<span>3.21</span></a> presents a base class for dual subproblem optimizers. The constructor <code>__init__()</code> takes the objective coefficients and constraint matrix that correspond to the variables in the subproblem. These information are required to create variables and constraints for the dual subproblem. However, the objective function will not be instantiated without the optimal solution of the restricted master problem. This base class also contains several other key functions:</p>
<ul>
<li><code>solve()</code>: this is the function that calls solver-specific procedure to solve the underlying dual subproblem.</li>
<li><code>update_objective()</code>: this function takes the optimal solution obtained by the master problem optimizer and updates the objective function for the dual subproblem.</li>
<li><code>opt_obj_val()</code>: this function returns the optimal objective values identified by the optimizer.</li>
<li><code>opt_sol()</code>: this function returns the optimal solution identified by the optimizer.</li>
<li><code>extreme_ray()</code>: this function returns the extreme ray identified by the optimizer.</li>
</ul>
<div id="cell-71" class="cell" data-execution_count="40">
<div id="lst-base-class-master" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-base-class-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.21: Base class for restricted master problem implementations
</figcaption>
<div aria-describedby="lst-base-class-master-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-base-class-master"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-base-class-master-1"><a href="#lst-base-class-master-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="lst-base-class-master-2"><a href="#lst-base-class-master-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict</span>
<span id="lst-base-class-master-3"><a href="#lst-base-class-master-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-base-class-master-4"><a href="#lst-base-class-master-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-5"><a href="#lst-base-class-master-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BendersDspOptimizer(ABC):</span>
<span id="lst-base-class-master-6"><a href="#lst-base-class-master-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""base class for dual subproblem implementation</span></span>
<span id="lst-base-class-master-7"><a href="#lst-base-class-master-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-8"><a href="#lst-base-class-master-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="lst-base-class-master-9"><a href="#lst-base-class-master-9" aria-hidden="true" tabindex="-1"></a><span class="co">        ABC (ABCMeta): helper class</span></span>
<span id="lst-base-class-master-10"><a href="#lst-base-class-master-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="lst-base-class-master-11"><a href="#lst-base-class-master-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-12"><a href="#lst-base-class-master-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-13"><a href="#lst-base-class-master-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, objective_coefficients: np.array, </span>
<span id="lst-base-class-master-14"><a href="#lst-base-class-master-14" aria-hidden="true" tabindex="-1"></a>                 constraint_matrix: np.array):</span>
<span id="lst-base-class-master-15"><a href="#lst-base-class-master-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""constructor for dual subproblem model initialization.</span></span>
<span id="lst-base-class-master-16"><a href="#lst-base-class-master-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-17"><a href="#lst-base-class-master-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="lst-base-class-master-18"><a href="#lst-base-class-master-18" aria-hidden="true" tabindex="-1"></a><span class="co">            objective_coefficients (np.array): an array of size m that </span></span>
<span id="lst-base-class-master-19"><a href="#lst-base-class-master-19" aria-hidden="true" tabindex="-1"></a><span class="co">                represents the coefficient value for each variable in the </span></span>
<span id="lst-base-class-master-20"><a href="#lst-base-class-master-20" aria-hidden="true" tabindex="-1"></a><span class="co">                original problem objective function.</span></span>
<span id="lst-base-class-master-21"><a href="#lst-base-class-master-21" aria-hidden="true" tabindex="-1"></a><span class="co">            constraint_matrix (np.array): a matrix of size m * n that </span></span>
<span id="lst-base-class-master-22"><a href="#lst-base-class-master-22" aria-hidden="true" tabindex="-1"></a><span class="co">                defines the constraint coefficients in the original problem.</span></span>
<span id="lst-base-class-master-23"><a href="#lst-base-class-master-23" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-24"><a href="#lst-base-class-master-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-25"><a href="#lst-base-class-master-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-26"><a href="#lst-base-class-master-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-27"><a href="#lst-base-class-master-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-base-class-master-28"><a href="#lst-base-class-master-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""solve the problem and return optimization status</span></span>
<span id="lst-base-class-master-29"><a href="#lst-base-class-master-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-30"><a href="#lst-base-class-master-30" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-31"><a href="#lst-base-class-master-31" aria-hidden="true" tabindex="-1"></a><span class="co">            OptStatus: an enum object</span></span>
<span id="lst-base-class-master-32"><a href="#lst-base-class-master-32" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-33"><a href="#lst-base-class-master-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-34"><a href="#lst-base-class-master-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-35"><a href="#lst-base-class-master-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-36"><a href="#lst-base-class-master-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_sol_rbmp: Dict[<span class="bu">int</span>, <span class="bu">float</span>],</span>
<span id="lst-base-class-master-37"><a href="#lst-base-class-master-37" aria-hidden="true" tabindex="-1"></a>                         constraint_matrix_rbmp: np.array,</span>
<span id="lst-base-class-master-38"><a href="#lst-base-class-master-38" aria-hidden="true" tabindex="-1"></a>                         right_hand_side_rbmp: np.array) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-base-class-master-39"><a href="#lst-base-class-master-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""update the objective function for the dual subproblem.</span></span>
<span id="lst-base-class-master-40"><a href="#lst-base-class-master-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-41"><a href="#lst-base-class-master-41" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="lst-base-class-master-42"><a href="#lst-base-class-master-42" aria-hidden="true" tabindex="-1"></a><span class="co">            opt_sol_rbmp (Dict[int, float]): optimal solution of the </span></span>
<span id="lst-base-class-master-43"><a href="#lst-base-class-master-43" aria-hidden="true" tabindex="-1"></a><span class="co">                restricted master problem</span></span>
<span id="lst-base-class-master-44"><a href="#lst-base-class-master-44" aria-hidden="true" tabindex="-1"></a><span class="co">            constraint_matrix_rbmp (np.array): constraint matrix </span></span>
<span id="lst-base-class-master-45"><a href="#lst-base-class-master-45" aria-hidden="true" tabindex="-1"></a><span class="co">                associated with the complicating variables in the </span></span>
<span id="lst-base-class-master-46"><a href="#lst-base-class-master-46" aria-hidden="true" tabindex="-1"></a><span class="co">                master problem</span></span>
<span id="lst-base-class-master-47"><a href="#lst-base-class-master-47" aria-hidden="true" tabindex="-1"></a><span class="co">            right_hand_side_rbmp (np.array): right-hand side of </span></span>
<span id="lst-base-class-master-48"><a href="#lst-base-class-master-48" aria-hidden="true" tabindex="-1"></a><span class="co">                the original problem</span></span>
<span id="lst-base-class-master-49"><a href="#lst-base-class-master-49" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-50"><a href="#lst-base-class-master-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-51"><a href="#lst-base-class-master-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-52"><a href="#lst-base-class-master-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-53"><a href="#lst-base-class-master-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_val(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="lst-base-class-master-54"><a href="#lst-base-class-master-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal objective value if exists</span></span>
<span id="lst-base-class-master-55"><a href="#lst-base-class-master-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-56"><a href="#lst-base-class-master-56" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-57"><a href="#lst-base-class-master-57" aria-hidden="true" tabindex="-1"></a><span class="co">            float: objective value</span></span>
<span id="lst-base-class-master-58"><a href="#lst-base-class-master-58" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-59"><a href="#lst-base-class-master-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-60"><a href="#lst-base-class-master-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-61"><a href="#lst-base-class-master-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-62"><a href="#lst-base-class-master-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_sol(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">int</span>, <span class="bu">float</span>]:</span>
<span id="lst-base-class-master-63"><a href="#lst-base-class-master-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the optimal solution values</span></span>
<span id="lst-base-class-master-64"><a href="#lst-base-class-master-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-65"><a href="#lst-base-class-master-65" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-66"><a href="#lst-base-class-master-66" aria-hidden="true" tabindex="-1"></a><span class="co">            Dict[int, float]: mapping between variable key and optimal value.</span></span>
<span id="lst-base-class-master-67"><a href="#lst-base-class-master-67" aria-hidden="true" tabindex="-1"></a><span class="co">            For example, opt_sol = {</span></span>
<span id="lst-base-class-master-68"><a href="#lst-base-class-master-68" aria-hidden="true" tabindex="-1"></a><span class="co">                0: 2.0,</span></span>
<span id="lst-base-class-master-69"><a href="#lst-base-class-master-69" aria-hidden="true" tabindex="-1"></a><span class="co">                1: 4.0</span></span>
<span id="lst-base-class-master-70"><a href="#lst-base-class-master-70" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="lst-base-class-master-71"><a href="#lst-base-class-master-71" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-72"><a href="#lst-base-class-master-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="lst-base-class-master-73"><a href="#lst-base-class-master-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-base-class-master-74"><a href="#lst-base-class-master-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="lst-base-class-master-75"><a href="#lst-base-class-master-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extreme_ray(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">int</span>, <span class="bu">float</span>]:</span>
<span id="lst-base-class-master-76"><a href="#lst-base-class-master-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""return the identified extreme ray</span></span>
<span id="lst-base-class-master-77"><a href="#lst-base-class-master-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-base-class-master-78"><a href="#lst-base-class-master-78" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-base-class-master-79"><a href="#lst-base-class-master-79" aria-hidden="true" tabindex="-1"></a><span class="co">            Dict[int, float]: mapping between variable key and ray element.</span></span>
<span id="lst-base-class-master-80"><a href="#lst-base-class-master-80" aria-hidden="true" tabindex="-1"></a><span class="co">            For example, extreme_ray = {</span></span>
<span id="lst-base-class-master-81"><a href="#lst-base-class-master-81" aria-hidden="true" tabindex="-1"></a><span class="co">                0: 3.5,</span></span>
<span id="lst-base-class-master-82"><a href="#lst-base-class-master-82" aria-hidden="true" tabindex="-1"></a><span class="co">                1: 6.0</span></span>
<span id="lst-base-class-master-83"><a href="#lst-base-class-master-83" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="lst-base-class-master-84"><a href="#lst-base-class-master-84" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-base-class-master-85"><a href="#lst-base-class-master-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="9">
<div id="lst-bd-console" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-bd-console-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.22: Generic Benders decomposition for LP problems
</figcaption>
<div aria-describedby="lst-bd-console-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-bd-console"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-bd-console-1"><a href="#lst-bd-console-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BendersOptimizerConsole:</span>
<span id="lst-bd-console-2"><a href="#lst-bd-console-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-console-3"><a href="#lst-bd-console-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, master_optimizer: BendersMasterOptimizer, </span>
<span id="lst-bd-console-4"><a href="#lst-bd-console-4" aria-hidden="true" tabindex="-1"></a>                 dsp_optimizer: BendersDspOptimizer):</span>
<span id="lst-bd-console-5"><a href="#lst-bd-console-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._master_optimizer <span class="op">=</span> master_optimizer</span>
<span id="lst-bd-console-6"><a href="#lst-bd-console-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dsp_optimizer <span class="op">=</span> dsp_optimizer</span>
<span id="lst-bd-console-7"><a href="#lst-bd-console-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-bd-console-8"><a href="#lst-bd-console-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-bd-console-9"><a href="#lst-bd-console-9" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-5</span></span>
<span id="lst-bd-console-10"><a href="#lst-bd-console-10" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="lst-bd-console-11"><a href="#lst-bd-console-11" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="lst-bd-console-12"><a href="#lst-bd-console-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-bd-console-13"><a href="#lst-bd-console-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-bd-console-14"><a href="#lst-bd-console-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="lst-bd-console-15"><a href="#lst-bd-console-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-bd-console-16"><a href="#lst-bd-console-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: </span>
<span id="lst-bd-console-17"><a href="#lst-bd-console-17" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Iteration: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-bd-console-18"><a href="#lst-bd-console-18" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-console-19"><a href="#lst-bd-console-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve master problem</span></span>
<span id="lst-bd-console-20"><a href="#lst-bd-console-20" aria-hidden="true" tabindex="-1"></a>            master_status <span class="op">=</span> <span class="va">self</span>._master_optimizer.solve()</span>
<span id="lst-bd-console-21"><a href="#lst-bd-console-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> master_status <span class="op">==</span> OptStatus.INFEASIBLE:</span>
<span id="lst-bd-console-22"><a href="#lst-bd-console-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-23"><a href="#lst-bd-console-23" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-bd-console-24"><a href="#lst-bd-console-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> OptStatus.INFEASIBLE</span>
<span id="lst-bd-console-25"><a href="#lst-bd-console-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-console-26"><a href="#lst-bd-console-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update lower bound</span></span>
<span id="lst-bd-console-27"><a href="#lst-bd-console-27" aria-hidden="true" tabindex="-1"></a>            lb <span class="op">=</span> np.<span class="bu">max</span>([lb, <span class="va">self</span>._master_optimizer.opt_obj_val])</span>
<span id="lst-bd-console-28"><a href="#lst-bd-console-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-29"><a href="#lst-bd-console-29" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-console-30"><a href="#lst-bd-console-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-console-31"><a href="#lst-bd-console-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve subproblem</span></span>
<span id="lst-bd-console-32"><a href="#lst-bd-console-32" aria-hidden="true" tabindex="-1"></a>            opt_val_comp <span class="op">=</span> <span class="va">self</span>._master_optimizer.opt_val_for_complicating_vars</span>
<span id="lst-bd-console-33"><a href="#lst-bd-console-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._dsp_optimizer.update_objective(opt_val_comp)</span>
<span id="lst-bd-console-34"><a href="#lst-bd-console-34" aria-hidden="true" tabindex="-1"></a>            dsp_status <span class="op">=</span> <span class="va">self</span>._dsp_optimizer.solve()</span>
<span id="lst-bd-console-35"><a href="#lst-bd-console-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-bd-console-36"><a href="#lst-bd-console-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dsp_status <span class="op">==</span> OptStatus.OPTIMAL:</span>
<span id="lst-bd-console-37"><a href="#lst-bd-console-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-38"><a href="#lst-bd-console-38" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'DSP is optimal!'</span>)</span>
<span id="lst-bd-console-39"><a href="#lst-bd-console-39" aria-hidden="true" tabindex="-1"></a>                <span class="co"># update upper bound</span></span>
<span id="lst-bd-console-40"><a href="#lst-bd-console-40" aria-hidden="true" tabindex="-1"></a>                opt_obj <span class="op">=</span> <span class="va">self</span>._dsp_optimizer.opt_obj_val                </span>
<span id="lst-bd-console-41"><a href="#lst-bd-console-41" aria-hidden="true" tabindex="-1"></a>                opt_obj_val_comp <span class="op">=</span> <span class="va">self</span>._master_optimizer.opt_obj_val_comp</span>
<span id="lst-bd-console-42"><a href="#lst-bd-console-42" aria-hidden="true" tabindex="-1"></a>                ub <span class="op">=</span> np.<span class="bu">min</span>([ub, opt_obj_val_comp <span class="op">+</span> opt_obj])</span>
<span id="lst-bd-console-43"><a href="#lst-bd-console-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-44"><a href="#lst-bd-console-44" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'Bounds: lb=</span><span class="sc">{</span>lb<span class="sc">:.2f}</span><span class="ss">, ub=</span><span class="sc">{</span>ub<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-bd-console-45"><a href="#lst-bd-console-45" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-console-46"><a href="#lst-bd-console-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ub <span class="op">-</span> lb <span class="op">&lt;=</span> eps:</span>
<span id="lst-bd-console-47"><a href="#lst-bd-console-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> OptStatus.OPTIMAL</span>
<span id="lst-bd-console-48"><a href="#lst-bd-console-48" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-bd-console-49"><a href="#lst-bd-console-49" aria-hidden="true" tabindex="-1"></a>                opt_sol <span class="op">=</span> <span class="va">self</span>._dsp_optimizer.opt_sol</span>
<span id="lst-bd-console-50"><a href="#lst-bd-console-50" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_optimizer.add_optimality_cut(opt_sol) </span>
<span id="lst-bd-console-51"><a href="#lst-bd-console-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> dsp_status <span class="op">==</span> OptStatus.UNBOUNDED:</span>
<span id="lst-bd-console-52"><a href="#lst-bd-console-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-53"><a href="#lst-bd-console-53" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'DSP is unbounded!!!'</span>)</span>
<span id="lst-bd-console-54"><a href="#lst-bd-console-54" aria-hidden="true" tabindex="-1"></a>                extreme_ray <span class="op">=</span> <span class="va">self</span>._dsp_optimizer.extreme_ray</span>
<span id="lst-bd-console-55"><a href="#lst-bd-console-55" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._master_optimizer.add_feasibility_cut(extreme_ray)</span>
<span id="lst-bd-console-56"><a href="#lst-bd-console-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="lst-bd-console-57"><a href="#lst-bd-console-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose:</span>
<span id="lst-bd-console-58"><a href="#lst-bd-console-58" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"DSP solve ERROR!!!"</span>)</span>
<span id="lst-bd-console-59"><a href="#lst-bd-console-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> OptStatus.ERROR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="master-and-subproblem-solvers-based-on-gurobi" class="level4" data-number="3.0.6.2">
<h4 data-number="3.0.6.2" class="anchored" data-anchor-id="master-and-subproblem-solvers-based-on-gurobi"><span class="header-section-number">3.0.6.2</span> Master and subproblem solvers based on Gurobi</h4>
<p><a href="#lst-generic-master-solver-gurobi" class="quarto-xref">Listing&nbsp;<span>3.23</span></a> implements a master problem solver class named <code>GenericMasterSolverGurobi</code> for (<strong>RBMP</strong>) characterized by the cost coefficient <code>f</code>, the constraint matrix <code>B</code> and right-hand side <code>b</code>. The constructor initializes the complicating variables <code>_y</code> and the dummy variable <code>_g</code>. The <code>solve()</code> function solves the problem and retrieves the optimal solution if exists. Moreover, the solver provides functions to add optimality and feasibility cuts to the existing model.</p>
<div id="cell-76" class="cell" data-execution_count="10">
<div id="lst-generic-master-solver-gurobi" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-master-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.23: Generic Benders master problem solver for LP problems
</figcaption>
<div aria-describedby="lst-generic-master-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-master-solver-gurobi"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-master-solver-gurobi-1"><a href="#lst-generic-master-solver-gurobi-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BendersMasterOptimizerGurobi(BendersMasterOptimizer):</span>
<span id="lst-generic-master-solver-gurobi-2"><a href="#lst-generic-master-solver-gurobi-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-3"><a href="#lst-generic-master-solver-gurobi-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, f: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-master-solver-gurobi-4"><a href="#lst-generic-master-solver-gurobi-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-master-solver-gurobi-5"><a href="#lst-generic-master-solver-gurobi-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._f <span class="op">=</span> f</span>
<span id="lst-generic-master-solver-gurobi-6"><a href="#lst-generic-master-solver-gurobi-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-master-solver-gurobi-7"><a href="#lst-generic-master-solver-gurobi-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-master-solver-gurobi-8"><a href="#lst-generic-master-solver-gurobi-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-9"><a href="#lst-generic-master-solver-gurobi-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-master-solver-gurobi-10"><a href="#lst-generic-master-solver-gurobi-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'MasterEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-generic-master-solver-gurobi-11"><a href="#lst-generic-master-solver-gurobi-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-generic-master-solver-gurobi-12"><a href="#lst-generic-master-solver-gurobi-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-generic-master-solver-gurobi-13"><a href="#lst-generic-master-solver-gurobi-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'MasterSolver'</span>)</span>
<span id="lst-generic-master-solver-gurobi-14"><a href="#lst-generic-master-solver-gurobi-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-15"><a href="#lst-generic-master-solver-gurobi-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-master-solver-gurobi-16"><a href="#lst-generic-master-solver-gurobi-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_y_vars <span class="op">=</span> <span class="bu">len</span>(f)</span>
<span id="lst-generic-master-solver-gurobi-17"><a href="#lst-generic-master-solver-gurobi-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y <span class="op">=</span> <span class="va">self</span>._model.addVars(<span class="va">self</span>._num_y_vars, </span>
<span id="lst-generic-master-solver-gurobi-18"><a href="#lst-generic-master-solver-gurobi-18" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=</span><span class="dv">0</span>,</span>
<span id="lst-generic-master-solver-gurobi-19"><a href="#lst-generic-master-solver-gurobi-19" aria-hidden="true" tabindex="-1"></a>                                      vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-generic-master-solver-gurobi-20"><a href="#lst-generic-master-solver-gurobi-20" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="lst-generic-master-solver-gurobi-21"><a href="#lst-generic-master-solver-gurobi-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(vtype<span class="op">=</span>GRB.CONTINUOUS, </span>
<span id="lst-generic-master-solver-gurobi-22"><a href="#lst-generic-master-solver-gurobi-22" aria-hidden="true" tabindex="-1"></a>                                     lb<span class="op">=</span><span class="dv">0</span>, </span>
<span id="lst-generic-master-solver-gurobi-23"><a href="#lst-generic-master-solver-gurobi-23" aria-hidden="true" tabindex="-1"></a>                                     name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-generic-master-solver-gurobi-24"><a href="#lst-generic-master-solver-gurobi-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-25"><a href="#lst-generic-master-solver-gurobi-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-generic-master-solver-gurobi-26"><a href="#lst-generic-master-solver-gurobi-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="lst-generic-master-solver-gurobi-27"><a href="#lst-generic-master-solver-gurobi-27" aria-hidden="true" tabindex="-1"></a>            gp.quicksum(<span class="va">self</span>._f[i] <span class="op">*</span> <span class="va">self</span>._y.get(i) </span>
<span id="lst-generic-master-solver-gurobi-28"><a href="#lst-generic-master-solver-gurobi-28" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)) <span class="op">+</span> </span>
<span id="lst-generic-master-solver-gurobi-29"><a href="#lst-generic-master-solver-gurobi-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._g,  </span>
<span id="lst-generic-master-solver-gurobi-30"><a href="#lst-generic-master-solver-gurobi-30" aria-hidden="true" tabindex="-1"></a>            GRB.MINIMIZE)</span>
<span id="lst-generic-master-solver-gurobi-31"><a href="#lst-generic-master-solver-gurobi-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-generic-master-solver-gurobi-32"><a href="#lst-generic-master-solver-gurobi-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-33"><a href="#lst-generic-master-solver-gurobi-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-gurobi-34"><a href="#lst-generic-master-solver-gurobi-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-gurobi-35"><a href="#lst-generic-master-solver-gurobi-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-gurobi-36"><a href="#lst-generic-master-solver-gurobi-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-gurobi-37"><a href="#lst-generic-master-solver-gurobi-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-38"><a href="#lst-generic-master-solver-gurobi-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-generic-master-solver-gurobi-39"><a href="#lst-generic-master-solver-gurobi-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-master-solver-gurobi-40"><a href="#lst-generic-master-solver-gurobi-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="lst-generic-master-solver-gurobi-41"><a href="#lst-generic-master-solver-gurobi-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-master-solver-gurobi-42"><a href="#lst-generic-master-solver-gurobi-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-43"><a href="#lst-generic-master-solver-gurobi-43" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-gurobi-44"><a href="#lst-generic-master-solver-gurobi-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-generic-master-solver-gurobi-45"><a href="#lst-generic-master-solver-gurobi-45" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-master-solver-gurobi-46"><a href="#lst-generic-master-solver-gurobi-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-generic-master-solver-gurobi-47"><a href="#lst-generic-master-solver-gurobi-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y <span class="op">=</span> {</span>
<span id="lst-generic-master-solver-gurobi-48"><a href="#lst-generic-master-solver-gurobi-48" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._y.get(i).X</span>
<span id="lst-generic-master-solver-gurobi-49"><a href="#lst-generic-master-solver-gurobi-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-gurobi-50"><a href="#lst-generic-master-solver-gurobi-50" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-master-solver-gurobi-51"><a href="#lst-generic-master-solver-gurobi-51" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._g.X</span>
<span id="lst-generic-master-solver-gurobi-52"><a href="#lst-generic-master-solver-gurobi-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">self</span>._opt_obj <span class="op">-</span> <span class="va">self</span>._opt_g</span>
<span id="lst-generic-master-solver-gurobi-53"><a href="#lst-generic-master-solver-gurobi-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="lst-generic-master-solver-gurobi-54"><a href="#lst-generic-master-solver-gurobi-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-gurobi-55"><a href="#lst-generic-master-solver-gurobi-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-gurobi-56"><a href="#lst-generic-master-solver-gurobi-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars):</span>
<span id="lst-generic-master-solver-gurobi-57"><a href="#lst-generic-master-solver-gurobi-57" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_y<span class="sc">.</span>get(j)<span class="sc">.</span>X<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-gurobi-58"><a href="#lst-generic-master-solver-gurobi-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.INFEASIBLE:</span>
<span id="lst-generic-master-solver-gurobi-59"><a href="#lst-generic-master-solver-gurobi-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="lst-generic-master-solver-gurobi-60"><a href="#lst-generic-master-solver-gurobi-60" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="lst-generic-master-solver-gurobi-61"><a href="#lst-generic-master-solver-gurobi-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-master-solver-gurobi-62"><a href="#lst-generic-master-solver-gurobi-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="lst-generic-master-solver-gurobi-63"><a href="#lst-generic-master-solver-gurobi-63" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-master-solver-gurobi-64"><a href="#lst-generic-master-solver-gurobi-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-65"><a href="#lst-generic-master-solver-gurobi-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="lst-generic-master-solver-gurobi-66"><a href="#lst-generic-master-solver-gurobi-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-master-solver-gurobi-67"><a href="#lst-generic-master-solver-gurobi-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="lst-generic-master-solver-gurobi-68"><a href="#lst-generic-master-solver-gurobi-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-69"><a href="#lst-generic-master-solver-gurobi-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-master-solver-gurobi-70"><a href="#lst-generic-master-solver-gurobi-70" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-master-solver-gurobi-71"><a href="#lst-generic-master-solver-gurobi-71" aria-hidden="true" tabindex="-1"></a>            ray_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-master-solver-gurobi-72"><a href="#lst-generic-master-solver-gurobi-72" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-master-solver-gurobi-73"><a href="#lst-generic-master-solver-gurobi-73" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-master-solver-gurobi-74"><a href="#lst-generic-master-solver-gurobi-74" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(</span>
<span id="lst-generic-master-solver-gurobi-75"><a href="#lst-generic-master-solver-gurobi-75" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-master-solver-gurobi-76"><a href="#lst-generic-master-solver-gurobi-76" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-gurobi-77"><a href="#lst-generic-master-solver-gurobi-77" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-master-solver-gurobi-78"><a href="#lst-generic-master-solver-gurobi-78" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-master-solver-gurobi-79"><a href="#lst-generic-master-solver-gurobi-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> ray_u.keys()</span>
<span id="lst-generic-master-solver-gurobi-80"><a href="#lst-generic-master-solver-gurobi-80" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-master-solver-gurobi-81"><a href="#lst-generic-master-solver-gurobi-81" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(gp.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="dv">0</span>)</span>
<span id="lst-generic-master-solver-gurobi-82"><a href="#lst-generic-master-solver-gurobi-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="lst-generic-master-solver-gurobi-83"><a href="#lst-generic-master-solver-gurobi-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-84"><a href="#lst-generic-master-solver-gurobi-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-master-solver-gurobi-85"><a href="#lst-generic-master-solver-gurobi-85" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-master-solver-gurobi-86"><a href="#lst-generic-master-solver-gurobi-86" aria-hidden="true" tabindex="-1"></a>            opt_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-master-solver-gurobi-87"><a href="#lst-generic-master-solver-gurobi-87" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-master-solver-gurobi-88"><a href="#lst-generic-master-solver-gurobi-88" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-master-solver-gurobi-89"><a href="#lst-generic-master-solver-gurobi-89" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(</span>
<span id="lst-generic-master-solver-gurobi-90"><a href="#lst-generic-master-solver-gurobi-90" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-master-solver-gurobi-91"><a href="#lst-generic-master-solver-gurobi-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-gurobi-92"><a href="#lst-generic-master-solver-gurobi-92" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-master-solver-gurobi-93"><a href="#lst-generic-master-solver-gurobi-93" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-master-solver-gurobi-94"><a href="#lst-generic-master-solver-gurobi-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> opt_u.keys()</span>
<span id="lst-generic-master-solver-gurobi-95"><a href="#lst-generic-master-solver-gurobi-95" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-master-solver-gurobi-96"><a href="#lst-generic-master-solver-gurobi-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addConstr(gp.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="va">self</span>._g)</span>
<span id="lst-generic-master-solver-gurobi-97"><a href="#lst-generic-master-solver-gurobi-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-generic-master-solver-gurobi-98"><a href="#lst-generic-master-solver-gurobi-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="lst-generic-master-solver-gurobi-99"><a href="#lst-generic-master-solver-gurobi-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-100"><a href="#lst-generic-master-solver-gurobi-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-101"><a href="#lst-generic-master-solver-gurobi-101" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-generic-master-solver-gurobi-102"><a href="#lst-generic-master-solver-gurobi-102" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span>
<span id="lst-generic-master-solver-gurobi-103"><a href="#lst-generic-master-solver-gurobi-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-104"><a href="#lst-generic-master-solver-gurobi-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-generic-master-solver-gurobi-105"><a href="#lst-generic-master-solver-gurobi-105" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-generic-master-solver-gurobi-106"><a href="#lst-generic-master-solver-gurobi-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-107"><a href="#lst-generic-master-solver-gurobi-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-gurobi-108"><a href="#lst-generic-master-solver-gurobi-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-109"><a href="#lst-generic-master-solver-gurobi-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._f</span>
<span id="lst-generic-master-solver-gurobi-110"><a href="#lst-generic-master-solver-gurobi-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-gurobi-111"><a href="#lst-generic-master-solver-gurobi-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-gurobi-112"><a href="#lst-generic-master-solver-gurobi-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-113"><a href="#lst-generic-master-solver-gurobi-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-master-solver-gurobi-114"><a href="#lst-generic-master-solver-gurobi-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-115"><a href="#lst-generic-master-solver-gurobi-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-gurobi-116"><a href="#lst-generic-master-solver-gurobi-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_y(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-117"><a href="#lst-generic-master-solver-gurobi-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj_y</span>
<span id="lst-generic-master-solver-gurobi-118"><a href="#lst-generic-master-solver-gurobi-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-119"><a href="#lst-generic-master-solver-gurobi-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-gurobi-120"><a href="#lst-generic-master-solver-gurobi-120" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-121"><a href="#lst-generic-master-solver-gurobi-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y</span>
<span id="lst-generic-master-solver-gurobi-122"><a href="#lst-generic-master-solver-gurobi-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-gurobi-123"><a href="#lst-generic-master-solver-gurobi-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-gurobi-124"><a href="#lst-generic-master-solver-gurobi-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-gurobi-125"><a href="#lst-generic-master-solver-gurobi-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#lst-generic-subprob-solver-gurobi" class="quarto-xref">Listing&nbsp;<span>3.24</span></a> presents a solver for (<strong>DSP</strong>) thats defined by the objective function coefficient <code>c</code> and constraint matrix <code>A</code>. The model objective function could be updated by <code>update_objective()</code> with the latest value of <code>y</code>. Notice that, the optimal solution is saved to <code>_opt_u</code> if the underlying problem is optimal. Otherwise, an extreme ray is retrieved and stored in <code>_extreme_ray</code>.</p>
<div id="cell-78" class="cell" data-execution_count="12">
<div id="lst-generic-subprob-solver-gurobi" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-subprob-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.24: Generic Benders dual subproblem solver for LP problems
</figcaption>
<div aria-describedby="lst-generic-subprob-solver-gurobi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-subprob-solver-gurobi"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-subprob-solver-gurobi-1"><a href="#lst-generic-subprob-solver-gurobi-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericSubprobSolverGurobi:</span>
<span id="lst-generic-subprob-solver-gurobi-2"><a href="#lst-generic-subprob-solver-gurobi-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-gurobi-3"><a href="#lst-generic-subprob-solver-gurobi-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, A: np.array, c: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-subprob-solver-gurobi-4"><a href="#lst-generic-subprob-solver-gurobi-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-subprob-solver-gurobi-5"><a href="#lst-generic-subprob-solver-gurobi-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._A <span class="op">=</span> A </span>
<span id="lst-generic-subprob-solver-gurobi-6"><a href="#lst-generic-subprob-solver-gurobi-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._c <span class="op">=</span> c </span>
<span id="lst-generic-subprob-solver-gurobi-7"><a href="#lst-generic-subprob-solver-gurobi-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-subprob-solver-gurobi-8"><a href="#lst-generic-subprob-solver-gurobi-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-subprob-solver-gurobi-9"><a href="#lst-generic-subprob-solver-gurobi-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-10"><a href="#lst-generic-subprob-solver-gurobi-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-subprob-solver-gurobi-11"><a href="#lst-generic-subprob-solver-gurobi-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env <span class="op">=</span> gp.Env(<span class="st">'SubprobEnv'</span>, empty<span class="op">=</span><span class="va">True</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-12"><a href="#lst-generic-subprob-solver-gurobi-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.setParam(<span class="st">"OutputFlag"</span>,<span class="dv">0</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-13"><a href="#lst-generic-subprob-solver-gurobi-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.start()</span>
<span id="lst-generic-subprob-solver-gurobi-14"><a href="#lst-generic-subprob-solver-gurobi-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> gp.Model(env<span class="op">=</span><span class="va">self</span>._env, name<span class="op">=</span><span class="st">'SubprobSolver'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-15"><a href="#lst-generic-subprob-solver-gurobi-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-gurobi-16"><a href="#lst-generic-subprob-solver-gurobi-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-subprob-solver-gurobi-17"><a href="#lst-generic-subprob-solver-gurobi-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(b)</span>
<span id="lst-generic-subprob-solver-gurobi-18"><a href="#lst-generic-subprob-solver-gurobi-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u <span class="op">=</span> <span class="va">self</span>._model.addVars(<span class="va">self</span>._num_vars, </span>
<span id="lst-generic-subprob-solver-gurobi-19"><a href="#lst-generic-subprob-solver-gurobi-19" aria-hidden="true" tabindex="-1"></a>                                      vtype<span class="op">=</span>GRB.CONTINUOUS,</span>
<span id="lst-generic-subprob-solver-gurobi-20"><a href="#lst-generic-subprob-solver-gurobi-20" aria-hidden="true" tabindex="-1"></a>                                      lb<span class="op">=-</span>GRB.INFINITY,</span>
<span id="lst-generic-subprob-solver-gurobi-21"><a href="#lst-generic-subprob-solver-gurobi-21" aria-hidden="true" tabindex="-1"></a>                                      ub<span class="op">=</span>GRB.INFINITY,</span>
<span id="lst-generic-subprob-solver-gurobi-22"><a href="#lst-generic-subprob-solver-gurobi-22" aria-hidden="true" tabindex="-1"></a>                                      name<span class="op">=</span><span class="st">'u'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-23"><a href="#lst-generic-subprob-solver-gurobi-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-gurobi-24"><a href="#lst-generic-subprob-solver-gurobi-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-generic-subprob-solver-gurobi-25"><a href="#lst-generic-subprob-solver-gurobi-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(c)):</span>
<span id="lst-generic-subprob-solver-gurobi-26"><a href="#lst-generic-subprob-solver-gurobi-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addConstr(</span>
<span id="lst-generic-subprob-solver-gurobi-27"><a href="#lst-generic-subprob-solver-gurobi-27" aria-hidden="true" tabindex="-1"></a>                gp.quicksum(A[:,c_idx][i] <span class="op">*</span> <span class="va">self</span>._u.get(i) </span>
<span id="lst-generic-subprob-solver-gurobi-28"><a href="#lst-generic-subprob-solver-gurobi-28" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(b))) <span class="op">&lt;=</span> c[c_idx]</span>
<span id="lst-generic-subprob-solver-gurobi-29"><a href="#lst-generic-subprob-solver-gurobi-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-subprob-solver-gurobi-30"><a href="#lst-generic-subprob-solver-gurobi-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-31"><a href="#lst-generic-subprob-solver-gurobi-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-gurobi-32"><a href="#lst-generic-subprob-solver-gurobi-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-gurobi-33"><a href="#lst-generic-subprob-solver-gurobi-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-gurobi-34"><a href="#lst-generic-subprob-solver-gurobi-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-35"><a href="#lst-generic-subprob-solver-gurobi-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-36"><a href="#lst-generic-subprob-solver-gurobi-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-37"><a href="#lst-generic-subprob-solver-gurobi-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-38"><a href="#lst-generic-subprob-solver-gurobi-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setParam(GRB.Param.DualReductions, <span class="dv">0</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-39"><a href="#lst-generic-subprob-solver-gurobi-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setParam(GRB.Param.InfUnbdInfo, <span class="dv">1</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-40"><a href="#lst-generic-subprob-solver-gurobi-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-subprob-solver-gurobi-41"><a href="#lst-generic-subprob-solver-gurobi-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-42"><a href="#lst-generic-subprob-solver-gurobi-42" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-gurobi-43"><a href="#lst-generic-subprob-solver-gurobi-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.OPTIMAL:</span>
<span id="lst-generic-subprob-solver-gurobi-44"><a href="#lst-generic-subprob-solver-gurobi-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.objVal</span>
<span id="lst-generic-subprob-solver-gurobi-45"><a href="#lst-generic-subprob-solver-gurobi-45" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u <span class="op">=</span> {</span>
<span id="lst-generic-subprob-solver-gurobi-46"><a href="#lst-generic-subprob-solver-gurobi-46" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._u.get(i).X</span>
<span id="lst-generic-subprob-solver-gurobi-47"><a href="#lst-generic-subprob-solver-gurobi-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-gurobi-48"><a href="#lst-generic-subprob-solver-gurobi-48" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-subprob-solver-gurobi-49"><a href="#lst-generic-subprob-solver-gurobi-49" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-subprob-solver-gurobi-50"><a href="#lst-generic-subprob-solver-gurobi-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-51"><a href="#lst-generic-subprob-solver-gurobi-51" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-52"><a href="#lst-generic-subprob-solver-gurobi-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars):</span>
<span id="lst-generic-subprob-solver-gurobi-53"><a href="#lst-generic-subprob-solver-gurobi-53" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_u<span class="sc">.</span>get(i)<span class="sc">.</span>X<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-54"><a href="#lst-generic-subprob-solver-gurobi-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.status <span class="op">==</span> GRB.UNBOUNDED:</span>
<span id="lst-generic-subprob-solver-gurobi-55"><a href="#lst-generic-subprob-solver-gurobi-55" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="lst-generic-subprob-solver-gurobi-56"><a href="#lst-generic-subprob-solver-gurobi-56" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u <span class="op">=</span> {</span>
<span id="lst-generic-subprob-solver-gurobi-57"><a href="#lst-generic-subprob-solver-gurobi-57" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._u.get(i).UnbdRay</span>
<span id="lst-generic-subprob-solver-gurobi-58"><a href="#lst-generic-subprob-solver-gurobi-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-gurobi-59"><a href="#lst-generic-subprob-solver-gurobi-59" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-subprob-solver-gurobi-60"><a href="#lst-generic-subprob-solver-gurobi-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem is unbounded'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-61"><a href="#lst-generic-subprob-solver-gurobi-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-subprob-solver-gurobi-62"><a href="#lst-generic-subprob-solver-gurobi-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem solve ERROR!'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-63"><a href="#lst-generic-subprob-solver-gurobi-63" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-subprob-solver-gurobi-64"><a href="#lst-generic-subprob-solver-gurobi-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-65"><a href="#lst-generic-subprob-solver-gurobi-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-66"><a href="#lst-generic-subprob-solver-gurobi-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-67"><a href="#lst-generic-subprob-solver-gurobi-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="lst-generic-subprob-solver-gurobi-68"><a href="#lst-generic-subprob-solver-gurobi-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-gurobi-69"><a href="#lst-generic-subprob-solver-gurobi-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y: <span class="bu">dict</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-70"><a href="#lst-generic-subprob-solver-gurobi-70" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-generic-subprob-solver-gurobi-71"><a href="#lst-generic-subprob-solver-gurobi-71" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-subprob-solver-gurobi-72"><a href="#lst-generic-subprob-solver-gurobi-72" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-subprob-solver-gurobi-73"><a href="#lst-generic-subprob-solver-gurobi-73" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-subprob-solver-gurobi-74"><a href="#lst-generic-subprob-solver-gurobi-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">sum</span>(<span class="va">self</span>._B[u_idx][j] <span class="op">*</span> opt_y.get(j) </span>
<span id="lst-generic-subprob-solver-gurobi-75"><a href="#lst-generic-subprob-solver-gurobi-75" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(opt_y))</span>
<span id="lst-generic-subprob-solver-gurobi-76"><a href="#lst-generic-subprob-solver-gurobi-76" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-subprob-solver-gurobi-77"><a href="#lst-generic-subprob-solver-gurobi-77" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-subprob-solver-gurobi-78"><a href="#lst-generic-subprob-solver-gurobi-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-gurobi-79"><a href="#lst-generic-subprob-solver-gurobi-79" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-subprob-solver-gurobi-80"><a href="#lst-generic-subprob-solver-gurobi-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(gp.quicksum(obj_expr), GRB.MAXIMIZE)</span>
<span id="lst-generic-subprob-solver-gurobi-81"><a href="#lst-generic-subprob-solver-gurobi-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="lst-generic-subprob-solver-gurobi-82"><a href="#lst-generic-subprob-solver-gurobi-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-gurobi-83"><a href="#lst-generic-subprob-solver-gurobi-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_up(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-84"><a href="#lst-generic-subprob-solver-gurobi-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.dispose()</span>
<span id="lst-generic-subprob-solver-gurobi-85"><a href="#lst-generic-subprob-solver-gurobi-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._env.dispose()</span>
<span id="lst-generic-subprob-solver-gurobi-86"><a href="#lst-generic-subprob-solver-gurobi-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-87"><a href="#lst-generic-subprob-solver-gurobi-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_model(<span class="va">self</span>, filename):</span>
<span id="lst-generic-subprob-solver-gurobi-88"><a href="#lst-generic-subprob-solver-gurobi-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.write(filename)</span>
<span id="lst-generic-subprob-solver-gurobi-89"><a href="#lst-generic-subprob-solver-gurobi-89" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-gurobi-90"><a href="#lst-generic-subprob-solver-gurobi-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-gurobi-91"><a href="#lst-generic-subprob-solver-gurobi-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-92"><a href="#lst-generic-subprob-solver-gurobi-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-subprob-solver-gurobi-93"><a href="#lst-generic-subprob-solver-gurobi-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-gurobi-94"><a href="#lst-generic-subprob-solver-gurobi-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-gurobi-95"><a href="#lst-generic-subprob-solver-gurobi-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-96"><a href="#lst-generic-subprob-solver-gurobi-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u</span>
<span id="lst-generic-subprob-solver-gurobi-97"><a href="#lst-generic-subprob-solver-gurobi-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-gurobi-98"><a href="#lst-generic-subprob-solver-gurobi-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-gurobi-99"><a href="#lst-generic-subprob-solver-gurobi-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-gurobi-100"><a href="#lst-generic-subprob-solver-gurobi-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>In <a href="#lst-generic-benders-test-1" class="quarto-xref">Listing&nbsp;<span>3.26</span></a>, we utilize the freshly baked solver to tackle the serious LP problem presented in the previous sections. The output shows that the same optimal objective value of 1091.43 was obtained in the end.</p>
<div id="cell-80" class="cell" data-execution_count="15">
<div id="lst-generic-benders-test-1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.25: Solving the LP problem using Benders decomposition
</figcaption>
<div aria-describedby="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-benders-test-1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-benders-test-1-1"><a href="#lst-generic-benders-test-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-generic-benders-test-1-2"><a href="#lst-generic-benders-test-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-3"><a href="#lst-generic-benders-test-1-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">10</span>])</span>
<span id="lst-generic-benders-test-1-4"><a href="#lst-generic-benders-test-1-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.array([<span class="dv">15</span>, <span class="dv">18</span>])</span>
<span id="lst-generic-benders-test-1-5"><a href="#lst-generic-benders-test-1-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>], [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-generic-benders-test-1-6"><a href="#lst-generic-benders-test-1-6" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([[<span class="dv">4</span>, <span class="dv">5</span>], [<span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-generic-benders-test-1-7"><a href="#lst-generic-benders-test-1-7" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([<span class="dv">300</span>, <span class="dv">220</span>])</span>
<span id="lst-generic-benders-test-1-8"><a href="#lst-generic-benders-test-1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-9"><a href="#lst-generic-benders-test-1-9" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericMasterSolverGurobi(f, B, b)</span>
<span id="lst-generic-benders-test-1-10"><a href="#lst-generic-benders-test-1-10" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericSubprobSolverGurobi(A, c, B, b)</span>
<span id="lst-generic-benders-test-1-11"><a href="#lst-generic-benders-test-1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-12"><a href="#lst-generic-benders-test-1-12" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersDecomposition(master_solver, dual_subprob_solver)</span>
<span id="lst-generic-benders-test-1-13"><a href="#lst-generic-benders-test-1-13" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=0.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=60.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
dual subproblem is unbounded
Finish solving dual subproblem.
--------------------------------------------------
DSP is unbounded!!!
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_g=114.29
    opt_y0=0.0
    opt_y1=54.285714285714285
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
</section>
<section id="master-and-subproblem-solvers-based-on-scip" class="level4" data-number="3.0.6.3">
<h4 data-number="3.0.6.3" class="anchored" data-anchor-id="master-and-subproblem-solvers-based-on-scip"><span class="header-section-number">3.0.6.3</span> Master and subproblem solvers based on SCIP</h4>
<div id="cell-82" class="cell" data-last-cap="A generic master problem solver based on SCIP" data-execution_count="30">
<div class="sourceCode cell-code" id="lst-generic-master-solver-scip"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-master-solver-scip-1"><a href="#lst-generic-master-solver-scip-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt</span>
<span id="lst-generic-master-solver-scip-2"><a href="#lst-generic-master-solver-scip-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-master-solver-scip-3"><a href="#lst-generic-master-solver-scip-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericMasterSolverSCIP:</span>
<span id="lst-generic-master-solver-scip-4"><a href="#lst-generic-master-solver-scip-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-5"><a href="#lst-generic-master-solver-scip-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, f: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-master-solver-scip-6"><a href="#lst-generic-master-solver-scip-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-master-solver-scip-7"><a href="#lst-generic-master-solver-scip-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._f <span class="op">=</span> f</span>
<span id="lst-generic-master-solver-scip-8"><a href="#lst-generic-master-solver-scip-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-master-solver-scip-9"><a href="#lst-generic-master-solver-scip-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-master-solver-scip-10"><a href="#lst-generic-master-solver-scip-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-11"><a href="#lst-generic-master-solver-scip-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-master-solver-scip-12"><a href="#lst-generic-master-solver-scip-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> pyscipopt.Model(<span class="st">'MasterSolver'</span>)</span>
<span id="lst-generic-master-solver-scip-13"><a href="#lst-generic-master-solver-scip-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-14"><a href="#lst-generic-master-solver-scip-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-master-solver-scip-15"><a href="#lst-generic-master-solver-scip-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_y_vars <span class="op">=</span> <span class="bu">len</span>(f)</span>
<span id="lst-generic-master-solver-scip-16"><a href="#lst-generic-master-solver-scip-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y <span class="op">=</span> {</span>
<span id="lst-generic-master-solver-scip-17"><a href="#lst-generic-master-solver-scip-17" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>, vtype<span class="op">=</span><span class="st">'C'</span>, name<span class="op">=</span><span class="ss">f'y</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-scip-18"><a href="#lst-generic-master-solver-scip-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-scip-19"><a href="#lst-generic-master-solver-scip-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-generic-master-solver-scip-20"><a href="#lst-generic-master-solver-scip-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._g <span class="op">=</span> <span class="va">self</span>._model.addVar(lb<span class="op">=</span><span class="dv">0</span>,</span>
<span id="lst-generic-master-solver-scip-21"><a href="#lst-generic-master-solver-scip-21" aria-hidden="true" tabindex="-1"></a>                                     vtype<span class="op">=</span><span class="st">'C'</span>,</span>
<span id="lst-generic-master-solver-scip-22"><a href="#lst-generic-master-solver-scip-22" aria-hidden="true" tabindex="-1"></a>                                     name<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="lst-generic-master-solver-scip-23"><a href="#lst-generic-master-solver-scip-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-24"><a href="#lst-generic-master-solver-scip-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-generic-master-solver-scip-25"><a href="#lst-generic-master-solver-scip-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(</span>
<span id="lst-generic-master-solver-scip-26"><a href="#lst-generic-master-solver-scip-26" aria-hidden="true" tabindex="-1"></a>            pyscipopt.quicksum(<span class="va">self</span>._f[i] <span class="op">*</span> <span class="va">self</span>._y.get(i) </span>
<span id="lst-generic-master-solver-scip-27"><a href="#lst-generic-master-solver-scip-27" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)) <span class="op">+</span> </span>
<span id="lst-generic-master-solver-scip-28"><a href="#lst-generic-master-solver-scip-28" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._g,  </span>
<span id="lst-generic-master-solver-scip-29"><a href="#lst-generic-master-solver-scip-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'maximize'</span>)</span>
<span id="lst-generic-master-solver-scip-30"><a href="#lst-generic-master-solver-scip-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-31"><a href="#lst-generic-master-solver-scip-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-scip-32"><a href="#lst-generic-master-solver-scip-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-scip-33"><a href="#lst-generic-master-solver-scip-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_y <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-scip-34"><a href="#lst-generic-master-solver-scip-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-scip-35"><a href="#lst-generic-master-solver-scip-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-36"><a href="#lst-generic-master-solver-scip-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>) <span class="op">-&gt;</span> OptStatus:</span>
<span id="lst-generic-master-solver-scip-37"><a href="#lst-generic-master-solver-scip-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-master-solver-scip-38"><a href="#lst-generic-master-solver-scip-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving master problem.'</span>)</span>
<span id="lst-generic-master-solver-scip-39"><a href="#lst-generic-master-solver-scip-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setPresolve(pyscipopt.SCIP_PARAMSETTING.OFF)</span>
<span id="lst-generic-master-solver-scip-40"><a href="#lst-generic-master-solver-scip-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setHeuristics(pyscipopt.SCIP_PARAMSETTING.OFF)</span>
<span id="lst-generic-master-solver-scip-41"><a href="#lst-generic-master-solver-scip-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.disablePropagation()</span>
<span id="lst-generic-master-solver-scip-42"><a href="#lst-generic-master-solver-scip-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-master-solver-scip-43"><a href="#lst-generic-master-solver-scip-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-44"><a href="#lst-generic-master-solver-scip-44" aria-hidden="true" tabindex="-1"></a>        opt_status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-master-solver-scip-45"><a href="#lst-generic-master-solver-scip-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="va">self</span>._model.getStatus())</span>
<span id="lst-generic-master-solver-scip-46"><a href="#lst-generic-master-solver-scip-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'optimal'</span>:</span>
<span id="lst-generic-master-solver-scip-47"><a href="#lst-generic-master-solver-scip-47" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-master-solver-scip-48"><a href="#lst-generic-master-solver-scip-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="lst-generic-master-solver-scip-49"><a href="#lst-generic-master-solver-scip-49" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_y <span class="op">=</span> {</span>
<span id="lst-generic-master-solver-scip-50"><a href="#lst-generic-master-solver-scip-50" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._model.getVal(<span class="va">self</span>._y.get(i))</span>
<span id="lst-generic-master-solver-scip-51"><a href="#lst-generic-master-solver-scip-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-scip-52"><a href="#lst-generic-master-solver-scip-52" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-master-solver-scip-53"><a href="#lst-generic-master-solver-scip-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_g <span class="op">=</span> <span class="va">self</span>._model.getVal(<span class="va">self</span>._g)</span>
<span id="lst-generic-master-solver-scip-54"><a href="#lst-generic-master-solver-scip-54" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj_y <span class="op">=</span> <span class="va">self</span>._opt_obj <span class="op">-</span> <span class="va">self</span>._opt_g</span>
<span id="lst-generic-master-solver-scip-55"><a href="#lst-generic-master-solver-scip-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is optimal.'</span>)</span>
<span id="lst-generic-master-solver-scip-56"><a href="#lst-generic-master-solver-scip-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-scip-57"><a href="#lst-generic-master-solver-scip-57" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_g=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_g<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-scip-58"><a href="#lst-generic-master-solver-scip-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars):</span>
<span id="lst-generic-master-solver-scip-59"><a href="#lst-generic-master-solver-scip-59" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_y</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_y<span class="sc">.</span>get(j)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-master-solver-scip-60"><a href="#lst-generic-master-solver-scip-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'infeasible'</span>:</span>
<span id="lst-generic-master-solver-scip-61"><a href="#lst-generic-master-solver-scip-61" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem is infeasible.'</span>)</span>
<span id="lst-generic-master-solver-scip-62"><a href="#lst-generic-master-solver-scip-62" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.INFEASIBLE</span>
<span id="lst-generic-master-solver-scip-63"><a href="#lst-generic-master-solver-scip-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-master-solver-scip-64"><a href="#lst-generic-master-solver-scip-64" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">master problem encountered error.'</span>)</span>
<span id="lst-generic-master-solver-scip-65"><a href="#lst-generic-master-solver-scip-65" aria-hidden="true" tabindex="-1"></a>            opt_status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-master-solver-scip-66"><a href="#lst-generic-master-solver-scip-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-67"><a href="#lst-generic-master-solver-scip-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving master problem.'</span>) </span>
<span id="lst-generic-master-solver-scip-68"><a href="#lst-generic-master-solver-scip-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-master-solver-scip-69"><a href="#lst-generic-master-solver-scip-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> opt_status</span>
<span id="lst-generic-master-solver-scip-70"><a href="#lst-generic-master-solver-scip-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-71"><a href="#lst-generic-master-solver-scip-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_feasibility_cut(<span class="va">self</span>, ray_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-master-solver-scip-72"><a href="#lst-generic-master-solver-scip-72" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-master-solver-scip-73"><a href="#lst-generic-master-solver-scip-73" aria-hidden="true" tabindex="-1"></a>            ray_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-master-solver-scip-74"><a href="#lst-generic-master-solver-scip-74" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-master-solver-scip-75"><a href="#lst-generic-master-solver-scip-75" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-master-solver-scip-76"><a href="#lst-generic-master-solver-scip-76" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(</span>
<span id="lst-generic-master-solver-scip-77"><a href="#lst-generic-master-solver-scip-77" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-master-solver-scip-78"><a href="#lst-generic-master-solver-scip-78" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-scip-79"><a href="#lst-generic-master-solver-scip-79" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-master-solver-scip-80"><a href="#lst-generic-master-solver-scip-80" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-master-solver-scip-81"><a href="#lst-generic-master-solver-scip-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> ray_u.keys()</span>
<span id="lst-generic-master-solver-scip-82"><a href="#lst-generic-master-solver-scip-82" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-master-solver-scip-83"><a href="#lst-generic-master-solver-scip-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addCons(pyscipopt.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="dv">0</span>)</span>
<span id="lst-generic-master-solver-scip-84"><a href="#lst-generic-master-solver-scip-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders feasibility cut added!'</span>)</span>
<span id="lst-generic-master-solver-scip-85"><a href="#lst-generic-master-solver-scip-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-86"><a href="#lst-generic-master-solver-scip-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_optimality_cut(<span class="va">self</span>, opt_u: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="lst-generic-master-solver-scip-87"><a href="#lst-generic-master-solver-scip-87" aria-hidden="true" tabindex="-1"></a>        constr_expr <span class="op">=</span> [</span>
<span id="lst-generic-master-solver-scip-88"><a href="#lst-generic-master-solver-scip-88" aria-hidden="true" tabindex="-1"></a>            opt_u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-master-solver-scip-89"><a href="#lst-generic-master-solver-scip-89" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-master-solver-scip-90"><a href="#lst-generic-master-solver-scip-90" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-master-solver-scip-91"><a href="#lst-generic-master-solver-scip-91" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(</span>
<span id="lst-generic-master-solver-scip-92"><a href="#lst-generic-master-solver-scip-92" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._B[u_idx][j] <span class="op">*</span> <span class="va">self</span>._y.get(j) </span>
<span id="lst-generic-master-solver-scip-93"><a href="#lst-generic-master-solver-scip-93" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_y_vars)</span>
<span id="lst-generic-master-solver-scip-94"><a href="#lst-generic-master-solver-scip-94" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-master-solver-scip-95"><a href="#lst-generic-master-solver-scip-95" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-master-solver-scip-96"><a href="#lst-generic-master-solver-scip-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> opt_u.keys()</span>
<span id="lst-generic-master-solver-scip-97"><a href="#lst-generic-master-solver-scip-97" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-master-solver-scip-98"><a href="#lst-generic-master-solver-scip-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.addCons(pyscipopt.quicksum(constr_expr) <span class="op">&lt;=</span> <span class="va">self</span>._g)</span>
<span id="lst-generic-master-solver-scip-99"><a href="#lst-generic-master-solver-scip-99" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.update()</span>
<span id="lst-generic-master-solver-scip-100"><a href="#lst-generic-master-solver-scip-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Benders optimality cut added!'</span>)</span>
<span id="lst-generic-master-solver-scip-101"><a href="#lst-generic-master-solver-scip-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-102"><a href="#lst-generic-master-solver-scip-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-scip-103"><a href="#lst-generic-master-solver-scip-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-scip-104"><a href="#lst-generic-master-solver-scip-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._f</span>
<span id="lst-generic-master-solver-scip-105"><a href="#lst-generic-master-solver-scip-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-master-solver-scip-106"><a href="#lst-generic-master-solver-scip-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-scip-107"><a href="#lst-generic-master-solver-scip-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-scip-108"><a href="#lst-generic-master-solver-scip-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-master-solver-scip-109"><a href="#lst-generic-master-solver-scip-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-110"><a href="#lst-generic-master-solver-scip-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-scip-111"><a href="#lst-generic-master-solver-scip-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj_y(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-scip-112"><a href="#lst-generic-master-solver-scip-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj_y</span>
<span id="lst-generic-master-solver-scip-113"><a href="#lst-generic-master-solver-scip-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-114"><a href="#lst-generic-master-solver-scip-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-scip-115"><a href="#lst-generic-master-solver-scip-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_y(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-scip-116"><a href="#lst-generic-master-solver-scip-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_y</span>
<span id="lst-generic-master-solver-scip-117"><a href="#lst-generic-master-solver-scip-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-master-solver-scip-118"><a href="#lst-generic-master-solver-scip-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-master-solver-scip-119"><a href="#lst-generic-master-solver-scip-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_g(<span class="va">self</span>):</span>
<span id="lst-generic-master-solver-scip-120"><a href="#lst-generic-master-solver-scip-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-83" class="cell" data-last-cap="A generic subprob problem solver based on SCIP" data-execution_count="26">
<div class="sourceCode cell-code" id="lst-generic-subprob-solver-scip"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-subprob-solver-scip-1"><a href="#lst-generic-subprob-solver-scip-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt</span>
<span id="lst-generic-subprob-solver-scip-2"><a href="#lst-generic-subprob-solver-scip-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-scip-3"><a href="#lst-generic-subprob-solver-scip-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenericSubprobSolverSCIP:</span>
<span id="lst-generic-subprob-solver-scip-4"><a href="#lst-generic-subprob-solver-scip-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-scip-5"><a href="#lst-generic-subprob-solver-scip-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, A: np.array, c: np.array, B: np.array, b: np.array):</span>
<span id="lst-generic-subprob-solver-scip-6"><a href="#lst-generic-subprob-solver-scip-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save data</span></span>
<span id="lst-generic-subprob-solver-scip-7"><a href="#lst-generic-subprob-solver-scip-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._A <span class="op">=</span> A </span>
<span id="lst-generic-subprob-solver-scip-8"><a href="#lst-generic-subprob-solver-scip-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._c <span class="op">=</span> c </span>
<span id="lst-generic-subprob-solver-scip-9"><a href="#lst-generic-subprob-solver-scip-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._b <span class="op">=</span> b </span>
<span id="lst-generic-subprob-solver-scip-10"><a href="#lst-generic-subprob-solver-scip-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._B <span class="op">=</span> B</span>
<span id="lst-generic-subprob-solver-scip-11"><a href="#lst-generic-subprob-solver-scip-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-scip-12"><a href="#lst-generic-subprob-solver-scip-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># env and model</span></span>
<span id="lst-generic-subprob-solver-scip-13"><a href="#lst-generic-subprob-solver-scip-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> pyscipopt.Model(<span class="st">'SubprobSolver'</span>)</span>
<span id="lst-generic-subprob-solver-scip-14"><a href="#lst-generic-subprob-solver-scip-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-scip-15"><a href="#lst-generic-subprob-solver-scip-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create variables</span></span>
<span id="lst-generic-subprob-solver-scip-16"><a href="#lst-generic-subprob-solver-scip-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._num_vars <span class="op">=</span> <span class="bu">len</span>(b)</span>
<span id="lst-generic-subprob-solver-scip-17"><a href="#lst-generic-subprob-solver-scip-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._u <span class="op">=</span> {</span>
<span id="lst-generic-subprob-solver-scip-18"><a href="#lst-generic-subprob-solver-scip-18" aria-hidden="true" tabindex="-1"></a>            i: <span class="va">self</span>._model.addVar(vtype<span class="op">=</span><span class="st">'C'</span>,</span>
<span id="lst-generic-subprob-solver-scip-19"><a href="#lst-generic-subprob-solver-scip-19" aria-hidden="true" tabindex="-1"></a>                                  lb<span class="op">=-</span><span class="va">self</span>._model.infinity(),</span>
<span id="lst-generic-subprob-solver-scip-20"><a href="#lst-generic-subprob-solver-scip-20" aria-hidden="true" tabindex="-1"></a>                                  ub<span class="op">=</span><span class="va">self</span>._model.infinity(),</span>
<span id="lst-generic-subprob-solver-scip-21"><a href="#lst-generic-subprob-solver-scip-21" aria-hidden="true" tabindex="-1"></a>                                  name<span class="op">=</span><span class="ss">f'u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-subprob-solver-scip-22"><a href="#lst-generic-subprob-solver-scip-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-scip-23"><a href="#lst-generic-subprob-solver-scip-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-generic-subprob-solver-scip-24"><a href="#lst-generic-subprob-solver-scip-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-scip-25"><a href="#lst-generic-subprob-solver-scip-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-generic-subprob-solver-scip-26"><a href="#lst-generic-subprob-solver-scip-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(c)):</span>
<span id="lst-generic-subprob-solver-scip-27"><a href="#lst-generic-subprob-solver-scip-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(</span>
<span id="lst-generic-subprob-solver-scip-28"><a href="#lst-generic-subprob-solver-scip-28" aria-hidden="true" tabindex="-1"></a>                pyscipopt.quicksum(A[:,c_idx][i] <span class="op">*</span> <span class="va">self</span>._u.get(i) </span>
<span id="lst-generic-subprob-solver-scip-29"><a href="#lst-generic-subprob-solver-scip-29" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(b))) <span class="op">&lt;=</span> c[c_idx]</span>
<span id="lst-generic-subprob-solver-scip-30"><a href="#lst-generic-subprob-solver-scip-30" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-subprob-solver-scip-31"><a href="#lst-generic-subprob-solver-scip-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-scip-32"><a href="#lst-generic-subprob-solver-scip-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-scip-33"><a href="#lst-generic-subprob-solver-scip-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-scip-34"><a href="#lst-generic-subprob-solver-scip-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._ray_u <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-scip-35"><a href="#lst-generic-subprob-solver-scip-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-scip-36"><a href="#lst-generic-subprob-solver-scip-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-scip-37"><a href="#lst-generic-subprob-solver-scip-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-subprob-solver-scip-38"><a href="#lst-generic-subprob-solver-scip-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Start solving dual subproblem.'</span>)</span>
<span id="lst-generic-subprob-solver-scip-39"><a href="#lst-generic-subprob-solver-scip-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setPresolve(pyscipopt.SCIP_PARAMSETTING.OFF)</span>
<span id="lst-generic-subprob-solver-scip-40"><a href="#lst-generic-subprob-solver-scip-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setHeuristics(pyscipopt.SCIP_PARAMSETTING.OFF)</span>
<span id="lst-generic-subprob-solver-scip-41"><a href="#lst-generic-subprob-solver-scip-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.disablePropagation()</span>
<span id="lst-generic-subprob-solver-scip-42"><a href="#lst-generic-subprob-solver-scip-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-generic-subprob-solver-scip-43"><a href="#lst-generic-subprob-solver-scip-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-scip-44"><a href="#lst-generic-subprob-solver-scip-44" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-generic-subprob-solver-scip-45"><a href="#lst-generic-subprob-solver-scip-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'optimal'</span>:</span>
<span id="lst-generic-subprob-solver-scip-46"><a href="#lst-generic-subprob-solver-scip-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="lst-generic-subprob-solver-scip-47"><a href="#lst-generic-subprob-solver-scip-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_u <span class="op">=</span> {</span>
<span id="lst-generic-subprob-solver-scip-48"><a href="#lst-generic-subprob-solver-scip-48" aria-hidden="true" tabindex="-1"></a>                i: <span class="va">self</span>._model.getVal(<span class="va">self</span>._u.get(i))</span>
<span id="lst-generic-subprob-solver-scip-49"><a href="#lst-generic-subprob-solver-scip-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-scip-50"><a href="#lst-generic-subprob-solver-scip-50" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-subprob-solver-scip-51"><a href="#lst-generic-subprob-solver-scip-51" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.OPTIMAL</span>
<span id="lst-generic-subprob-solver-scip-52"><a href="#lst-generic-subprob-solver-scip-52" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">dual subproblem is optimal.'</span>)</span>
<span id="lst-generic-subprob-solver-scip-53"><a href="#lst-generic-subprob-solver-scip-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_obj=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-generic-subprob-solver-scip-54"><a href="#lst-generic-subprob-solver-scip-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars):</span>
<span id="lst-generic-subprob-solver-scip-55"><a href="#lst-generic-subprob-solver-scip-55" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\t</span><span class="ss">opt_u</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_u<span class="sc">.</span>get(i)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="lst-generic-subprob-solver-scip-56"><a href="#lst-generic-subprob-solver-scip-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>._model.getStatus() <span class="op">==</span> <span class="st">'unbounded'</span>:</span>
<span id="lst-generic-subprob-solver-scip-57"><a href="#lst-generic-subprob-solver-scip-57" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.UNBOUNDED</span>
<span id="lst-generic-subprob-solver-scip-58"><a href="#lst-generic-subprob-solver-scip-58" aria-hidden="true" tabindex="-1"></a>            hasRay <span class="op">=</span> <span class="va">self</span>._model.hasPrimalRay()</span>
<span id="lst-generic-subprob-solver-scip-59"><a href="#lst-generic-subprob-solver-scip-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'primal ray exists!'</span>)</span>
<span id="lst-generic-subprob-solver-scip-60"><a href="#lst-generic-subprob-solver-scip-60" aria-hidden="true" tabindex="-1"></a>            ray <span class="op">=</span> <span class="va">self</span>._model.getPrimalRay()</span>
<span id="lst-generic-subprob-solver-scip-61"><a href="#lst-generic-subprob-solver-scip-61" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._ray_u <span class="op">=</span> {</span>
<span id="lst-generic-subprob-solver-scip-62"><a href="#lst-generic-subprob-solver-scip-62" aria-hidden="true" tabindex="-1"></a>                i: ray[i]</span>
<span id="lst-generic-subprob-solver-scip-63"><a href="#lst-generic-subprob-solver-scip-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-scip-64"><a href="#lst-generic-subprob-solver-scip-64" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-generic-subprob-solver-scip-65"><a href="#lst-generic-subprob-solver-scip-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem is unbounded'</span>)</span>
<span id="lst-generic-subprob-solver-scip-66"><a href="#lst-generic-subprob-solver-scip-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-generic-subprob-solver-scip-67"><a href="#lst-generic-subprob-solver-scip-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'dual subproblem solve ERROR!'</span>)</span>
<span id="lst-generic-subprob-solver-scip-68"><a href="#lst-generic-subprob-solver-scip-68" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> OptStatus.ERROR</span>
<span id="lst-generic-subprob-solver-scip-69"><a href="#lst-generic-subprob-solver-scip-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-generic-subprob-solver-scip-70"><a href="#lst-generic-subprob-solver-scip-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Finish solving dual subproblem.'</span>)</span>
<span id="lst-generic-subprob-solver-scip-71"><a href="#lst-generic-subprob-solver-scip-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'-'</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="lst-generic-subprob-solver-scip-72"><a href="#lst-generic-subprob-solver-scip-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> status</span>
<span id="lst-generic-subprob-solver-scip-73"><a href="#lst-generic-subprob-solver-scip-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-subprob-solver-scip-74"><a href="#lst-generic-subprob-solver-scip-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_objective(<span class="va">self</span>, opt_y: <span class="bu">dict</span>):</span>
<span id="lst-generic-subprob-solver-scip-75"><a href="#lst-generic-subprob-solver-scip-75" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-generic-subprob-solver-scip-76"><a href="#lst-generic-subprob-solver-scip-76" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._u.get(u_idx) <span class="op">*</span> </span>
<span id="lst-generic-subprob-solver-scip-77"><a href="#lst-generic-subprob-solver-scip-77" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="lst-generic-subprob-solver-scip-78"><a href="#lst-generic-subprob-solver-scip-78" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._b[u_idx] <span class="op">-</span> </span>
<span id="lst-generic-subprob-solver-scip-79"><a href="#lst-generic-subprob-solver-scip-79" aria-hidden="true" tabindex="-1"></a>                <span class="bu">sum</span>(<span class="va">self</span>._B[u_idx][j] <span class="op">*</span> opt_y.get(j) </span>
<span id="lst-generic-subprob-solver-scip-80"><a href="#lst-generic-subprob-solver-scip-80" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(opt_y))</span>
<span id="lst-generic-subprob-solver-scip-81"><a href="#lst-generic-subprob-solver-scip-81" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="lst-generic-subprob-solver-scip-82"><a href="#lst-generic-subprob-solver-scip-82" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="lst-generic-subprob-solver-scip-83"><a href="#lst-generic-subprob-solver-scip-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> u_idx <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._num_vars)</span>
<span id="lst-generic-subprob-solver-scip-84"><a href="#lst-generic-subprob-solver-scip-84" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-generic-subprob-solver-scip-85"><a href="#lst-generic-subprob-solver-scip-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(pyscipopt.quicksum(obj_expr), GRB.MAXIMIZE)</span>
<span id="lst-generic-subprob-solver-scip-86"><a href="#lst-generic-subprob-solver-scip-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'dual subproblem objective updated!'</span>)</span>
<span id="lst-generic-subprob-solver-scip-87"><a href="#lst-generic-subprob-solver-scip-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-scip-88"><a href="#lst-generic-subprob-solver-scip-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-scip-89"><a href="#lst-generic-subprob-solver-scip-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-scip-90"><a href="#lst-generic-subprob-solver-scip-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span>
<span id="lst-generic-subprob-solver-scip-91"><a href="#lst-generic-subprob-solver-scip-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-scip-92"><a href="#lst-generic-subprob-solver-scip-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-scip-93"><a href="#lst-generic-subprob-solver-scip-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_u(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-scip-94"><a href="#lst-generic-subprob-solver-scip-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_u</span>
<span id="lst-generic-subprob-solver-scip-95"><a href="#lst-generic-subprob-solver-scip-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-generic-subprob-solver-scip-96"><a href="#lst-generic-subprob-solver-scip-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-generic-subprob-solver-scip-97"><a href="#lst-generic-subprob-solver-scip-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ray_u(<span class="va">self</span>):</span>
<span id="lst-generic-subprob-solver-scip-98"><a href="#lst-generic-subprob-solver-scip-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._ray_u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#lst-generic-benders-test-1" class="quarto-xref">Listing&nbsp;<span>3.26</span></a> solves same the LP problem that we have been tackling in the previous sections. The output confirms that the same optimal solution is identified as in the last section.</p>
<div id="cell-85" class="cell" data-execution_count="31">
<div id="lst-generic-benders-test-1" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3.26: Solving the LP problem using Benders decomposition
</figcaption>
<div aria-describedby="lst-generic-benders-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-generic-benders-test-1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-generic-benders-test-1-1"><a href="#lst-generic-benders-test-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-generic-benders-test-1-2"><a href="#lst-generic-benders-test-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-3"><a href="#lst-generic-benders-test-1-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">10</span>])</span>
<span id="lst-generic-benders-test-1-4"><a href="#lst-generic-benders-test-1-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.array([<span class="dv">15</span>, <span class="dv">18</span>])</span>
<span id="lst-generic-benders-test-1-5"><a href="#lst-generic-benders-test-1-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>], [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-generic-benders-test-1-6"><a href="#lst-generic-benders-test-1-6" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([[<span class="dv">4</span>, <span class="dv">5</span>], [<span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="lst-generic-benders-test-1-7"><a href="#lst-generic-benders-test-1-7" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([<span class="dv">300</span>, <span class="dv">220</span>])</span>
<span id="lst-generic-benders-test-1-8"><a href="#lst-generic-benders-test-1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-9"><a href="#lst-generic-benders-test-1-9" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericMasterSolverSCIP(f, B, b)</span>
<span id="lst-generic-benders-test-1-10"><a href="#lst-generic-benders-test-1-10" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericSubprobSolverSCIP(A, c, B, b)</span>
<span id="lst-generic-benders-test-1-11"><a href="#lst-generic-benders-test-1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-generic-benders-test-1-12"><a href="#lst-generic-benders-test-1-12" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersDecomposition(master_solver, dual_subprob_solver)</span>
<span id="lst-generic-benders-test-1-13"><a href="#lst-generic-benders-test-1-13" aria-hidden="true" tabindex="-1"></a>benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
unbounded
    master problem encountered error.
Finish solving master problem.
--------------------------------------------------
presolving:
   (0.0s) symmetry computation started: requiring (bin +, int +, cont +), (fixed: bin -, int -, cont -)
   (0.0s) no symmetry present (symcode time: 0.00)
presolving (0 rounds: 0 fast, 0 medium, 0 exhaustive):
 0 deleted vars, 0 deleted constraints, 0 added constraints, 0 tightened bounds, 0 added holes, 0 changed sides, 0 changed coefficients
 0 implications, 0 cliques
presolved problem has 3 variables (0 bin, 0 int, 0 impl, 3 cont) and 0 constraints
Presolving Time: 0.00

 time | node  | left  |LP iter|LP it/n|mem/heur|mdpt |vars |cons |rows |cuts |sepa|confs|strbr|  dualbound   | primalbound  |  gap   | compl. 
* 0.0s|     1 |     0 |     0 |     - |    LP  |   0 |   3 |   0 |   0 |   0 |  0 |   0 |   0 |      --      |      --      |   0.00%| unknown
  0.0s|     1 |     0 |     0 |     - |   568k |   0 |   3 |   0 |   0 |   0 |  0 |   0 |   0 |      --      |      --      |   0.00%| unknown

SCIP Status        : problem is solved [unbounded]
Solving Time (sec) : 0.00
Solving Nodes      : 1
Primal Bound       : +1.00000000000000e+20 (1 solutions)
Dual Bound         : +1.00000000000000e+20
Gap                : 0.00 %</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>TypeError: '&gt;=' not supported between instances of 'float' and 'NoneType'</code></pre>
</div>
</div>
</section>
<section id="detect-infeasibility" class="level4" data-number="3.0.6.4">
<h4 data-number="3.0.6.4" class="anchored" data-anchor-id="detect-infeasibility"><span class="header-section-number">3.0.6.4</span> Detect infeasibility</h4>
<div id="cell-87" class="cell" data-execution_count="313">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">142</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">6</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">15</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">6</span>, size<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.random.randint(<span class="dv">2</span>, <span class="dv">26</span>, size<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.random.randint(<span class="dv">20</span>, <span class="dv">50</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>obj_coeff <span class="op">=</span> np.concatenate([c, f])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>constr_mat <span class="op">=</span> np.concatenate([A, B], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>rhs <span class="op">=</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-88" class="cell" data-execution_count="314">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gurobi_solver <span class="op">=</span> LpSolverGurobi(obj_coeff, constr_mat, rhs)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>gurobi_solver.save_model(<span class="st">'problem2.lp'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>gurobi_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model is infeasible!</code></pre>
</div>
</div>
<div id="cell-89" class="cell" data-execution_count="315">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>scip_solver <span class="op">=</span> LpSolverSCIP(obj_coeff, constr_mat, rhs)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>scip_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model is infeasible!</code></pre>
</div>
</div>
<div id="cell-90" class="cell" data-execution_count="338">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>master_solver <span class="op">=</span> GenericLpMasterSolver(f, B, b)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dual_subprob_solver <span class="op">=</span> GenericLpSubprobSolver(A, c, B, b)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>benders_solver <span class="op">=</span> GenericBendersSolver(master_solver, dual_subprob_solver)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>benders_solver.optimize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iteration: 1
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=0.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=0.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=0.00, ub=inf
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=1200.00
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=0.00, ub=1200.00
Benders optimality cut added!

Iteration: 2
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1080.00
    opt_g=0.00
    opt_y0=0.0
    opt_y1=60.0
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1080.00, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
dual subproblem is unbounded
Finish solving dual subproblem.
--------------------------------------------------
DSP is unbounded!!!
Benders feasibility cut added!

Iteration: 3
--------------------------------------------------
Start solving master problem.
    master problem is optimal.
    opt_obj=1091.43
    opt_g=114.29
    opt_y0=0.0
    opt_y1=54.285714285714285
Finish solving master problem.
--------------------------------------------------
Bounds: lb=1091.43, ub=1200.00
dual subproblem objective updated!
--------------------------------------------------
Start solving dual subproblem.
    dual subproblem is optimal.
    opt_obj=114.29
    opt_u0=4.0
    opt_u1=0.0
Finish solving dual subproblem.
--------------------------------------------------
DSP is optimal!
Bounds: lb=1091.43, ub=1091.43</code></pre>
</div>
</div>
</section>
</section>
<section id="implementation-with-callbacks" class="level3" data-number="3.0.7">
<h3 data-number="3.0.7" class="anchored" data-anchor-id="implementation-with-callbacks"><span class="header-section-number">3.0.7</span> Implementation with callbacks</h3>
</section>
<section id="testing-and-validation" class="level3" data-number="3.0.8">
<h3 data-number="3.0.8" class="anchored" data-anchor-id="testing-and-validation"><span class="header-section-number">3.0.8</span> Testing and validation</h3>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./benders-theory.html" class="pagination-link" aria-label="Benders Decomposition Theories">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Benders Decomposition Theories</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lagrange-theory.html" class="pagination-link" aria-label="Lagrangian Relaxation Theories">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lagrangian Relaxation Theories</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>