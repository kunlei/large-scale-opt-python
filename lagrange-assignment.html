<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hands-on Large Scale Optimization in Python - 5&nbsp; Generalized Assignment Problem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lagrange-ufl.html" rel="next">
<link href="./lagrange-theory.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XM4LXJY2KJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XM4LXJY2KJ', { 'anonymize_ip': true});
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
    });
    </script>

<!-- This is what works with Quarto -->
<script>
    MathJax = {
        tex: {
            tags: 'ams'  // should be 'ams', 'none', or 'all'
        }
    };
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="Hands-on Large Scale Optimization in Python - 5&nbsp; Generalized Assignment Problem">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lagrange-theory.html">Lagrangian Relaxation</a></li><li class="breadcrumb-item"><a href="./lagrange-assignment.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Assignment Problem</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hands-on Large Scale Optimization in Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Benders Decomposition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./benders-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Benders Decomposition Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./benders-linear-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Solving Linear Programming Problems with Benders Decomposition</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lagrangian Relaxation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lagrangian Relaxation Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-assignment.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Assignment Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Uncapacitated Facility Location Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-constrained-shortest-path.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Constrained Shortest Path Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lagrange-tsp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Traveling Salesman Problem</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Column Generation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Column Generation Theories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-cutting-stock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Cutting Stock Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cg-scheduling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Scheduling Optimization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#formulation" id="toc-formulation" class="nav-link active" data-scroll-target="#formulation"><span class="header-section-number">5.1</span> Formulation</a></li>
  <li><a href="#lagrangian-relaxation" id="toc-lagrangian-relaxation" class="nav-link" data-scroll-target="#lagrangian-relaxation"><span class="header-section-number">5.2</span> Lagrangian Relaxation</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">5.3</span> Implementation</a>
  <ul class="collapse">
  <li><a href="#benchmarking-instances" id="toc-benchmarking-instances" class="nav-link" data-scroll-target="#benchmarking-instances"><span class="header-section-number">5.3.1</span> Benchmarking instances</a></li>
  <li><a href="#solve-the-original-problem" id="toc-solve-the-original-problem" class="nav-link" data-scroll-target="#solve-the-original-problem"><span class="header-section-number">5.3.2</span> Solve the original problem</a></li>
  <li><a href="#solve-the-lagrangian-relaxation-with-fixed-multipliers" id="toc-solve-the-lagrangian-relaxation-with-fixed-multipliers" class="nav-link" data-scroll-target="#solve-the-lagrangian-relaxation-with-fixed-multipliers"><span class="header-section-number">5.3.3</span> Solve the Lagrangian relaxation with fixed multipliers</a></li>
  <li><a href="#approximating-the-best-lagrange-multipliers" id="toc-approximating-the-best-lagrange-multipliers" class="nav-link" data-scroll-target="#approximating-the-best-lagrange-multipliers"><span class="header-section-number">5.3.4</span> Approximating the best Lagrange multipliers</a></li>
  </ul></li>
  <li><a href="#alternative-relaxation" id="toc-alternative-relaxation" class="nav-link" data-scroll-target="#alternative-relaxation"><span class="header-section-number">5.4</span> Alternative Relaxation</a></li>
  <li><a href="#performance-comparison" id="toc-performance-comparison" class="nav-link" data-scroll-target="#performance-comparison"><span class="header-section-number">5.5</span> Performance Comparison</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lagrange-theory.html">Lagrangian Relaxation</a></li><li class="breadcrumb-item"><a href="./lagrange-assignment.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Assignment Problem</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Assignment Problem</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Assignment problems are really everywhere, that is, if we look around carefully. For example, vehicle routing problem could be formulated as an assignment problem coupled with a traveling salesman problem for each vehicle. The job shop scheduling problem involves assigning job processes onto machines and optimizing the processes on each machine to minimize a certain criterion like makespan. In this chapter, we examine the generalized assignment problem and its solution approach via Lagrangian relaxation.</p>
<p>The Generalized Assignment Problem (GAP) is a well-known problem in operations research and combinatorial optimization. It is an extension of the classic assignment problem where a set of tasks needs to be assigned to a set of agents, with each task requiring a specific amount of resources from the assigned agent. However, in the generalized version, multiple agents can be assigned to a single task, and each agent may have a limit on the amount of resource it can contribute.</p>
<section id="formulation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="formulation"><span class="header-section-number">5.1</span> Formulation</h2>
<p>Formally, the Generalized Assignment Problem can be defined as follows:</p>
<p>Given:</p>
<ul>
<li>A set of tasks, <span class="math inline">\(T = \{1, 2, ..., n\}\)</span></li>
<li>A set of agents, <span class="math inline">\(A = \{1, 2, ..., m\}\)</span></li>
<li>For each task <span class="math inline">\(i\)</span> and agent <span class="math inline">\(j\)</span>, a cost or profit <span class="math inline">\(c_{ij}\)</span> associated with assigning task <span class="math inline">\(i\)</span> to agent <span class="math inline">\(j\)</span></li>
<li>For each task <span class="math inline">\(i\)</span> and agent <span class="math inline">\(j\)</span>, a resource requirement <span class="math inline">\(r_{ij}\)</span> specifying the amount of resource needed from agent <span class="math inline">\(j\)</span> to complete task <span class="math inline">\(i\)</span></li>
<li>For each agent <span class="math inline">\(j\)</span>, a capacity <span class="math inline">\(b_j\)</span> specifying the maximum amount of resource that agent <span class="math inline">\(j\)</span> can contribute</li>
</ul>
<p>The goal is to find an assignment of tasks to agents that minimizes the total cost or maximizes the total profit, while ensuring that each task is assigned to one or more agents, and the total resource requirement of each agent does not exceed its capacity.</p>
<p>Mathematically, the GAP can be formulated as an integer linear programming problem. One possible formulation is as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\text{min.} &amp;\quad \sum_{i=1}^{n} \sum_{j=1}^{m} c_{ij} x_{ij} \label{gap-obj}\\
\text{s.t.} &amp;\quad \sum_{j=1}^{m} x_{ij} = 1, \ \forall i = 1, 2, ..., n \label{gap-cons1}\\
&amp;\quad \sum_{i=1}^{n} r_{ij} x_{ij} \leq b_j, \  \forall j = 1, 2, ..., m \label{gap-cons2}\\
&amp;\quad x_{ij} \in \{0, 1\}, \ \forall i = 1, 2, ..., n, j = 1, 2, ..., m \label{gap-cons3}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(x_{ij}\)</span> is a binary decision variable that equals 1 if task <span class="math inline">\(i\)</span> is assigned to agent <span class="math inline">\(j\)</span>, and 0 otherwise.</p>
<p>The first set of constraints ensures that each task is assigned to exactly one agent, and the second set of constraints ensures that the total resource requirement of each agent does not exceed its capacity.</p>
<p>Solving the GAP can be computationally challenging, especially for large instances, as it is a generalization of the classic assignment problem, which is known to be polynomial-time solvable. Various algorithms and heuristics, such as branch and bound, dynamic programming, and approximation algorithms, can be employed to find feasible or optimal solutions to the GAP.</p>
</section>
<section id="lagrangian-relaxation" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="lagrangian-relaxation"><span class="header-section-number">5.2</span> Lagrangian Relaxation</h2>
<p>The essence of Lagrangian relaxation is to choose some ‘hard’ constraints in the original model formulation and put them into the objective function. In the meantime, Lagrange multipliers are used to penalize the violations of these constraints. In the GAP formulation, we could choose the constraints <span class="math inline">\(\eqref{gap-cons1}\)</span> and put them into the objective function, which gives us the corresponding Lagrangian relaxation:</p>
<p><span class="math display">\[
\begin{aligned}
LR(v): \text{min.} &amp;\quad \sum_{i=1}^{n} \sum_{j=1}^{m} c_{ij} x_{ij} + \sum_{i=1}^{n} v_i (\sum_{j=1}^{m} x_{ij} - 1) \label{gap-lr-obj}\\
\text{s.t.} &amp;\quad \sum_{i=1}^{n} r_{ij} x_{ij} \leq b_j, \  \forall j = 1, 2, ..., m \label{gap-lr-cons1}\\
&amp;\quad x_{ij} \in \{0, 1\}, \ \forall i = 1, 2, ..., n, j = 1, 2, ..., m \label{gap-lr-cons2}
\end{aligned}
\]</span></p>
<p>In the above formulation, <span class="math inline">\(v_i\)</span> is the Lagrange multiplier associated with each task <span class="math inline">\(i\)</span>. Note that the optimal objective value of <span class="math inline">\(LR(v)\)</span> for a given <span class="math inline">\(v\)</span> serves as a lower bound of the original problem. Our goal is then to find the best value of <span class="math inline">\(v\)</span> such that the best lower bound is obtained for the original problem.</p>
</section>
<section id="implementation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="implementation"><span class="header-section-number">5.3</span> Implementation</h2>
<p>Optimization is fun, especially when we turn our curated models and algorithms into computer codes using our favorite programming languages. In this section, we will solve some GAP instances using Lagrangian Relaxation!</p>
<section id="benchmarking-instances" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="benchmarking-instances"><span class="header-section-number">5.3.1</span> Benchmarking instances</h3>
<p>All the benchmarking instances we solve here are taken from the <a href="http://people.brunel.ac.uk/~mastjjb/jeb/orlib/gapinfo.html">OR-Library</a>. There are a total of 16 data files, among which the first 12 data files are gap1, gap2, …, gap12, and the remaining 4 data files are gapa, gapb, gapc and gapd.</p>
<p>All the data files are formatted as follows:</p>
<ul>
<li>The total number of problem instances in the data set (<span class="math inline">\(P\)</span>)</li>
<li>For each problem set <span class="math inline">\(p\)</span> (<span class="math inline">\(p = 1,...,P\)</span>) in turn:
<ul>
<li>The number of agents (<span class="math inline">\(m\)</span>), number of tasks (<span class="math inline">\(n\)</span>)</li>
<li>For each agent <span class="math inline">\(i\)</span> (<span class="math inline">\(i = 1,...,m\)</span>) in turn:
<ul>
<li>The cost of allocating task <span class="math inline">\(j\)</span> to agent <span class="math inline">\(i\)</span> (<span class="math inline">\(j = 1,...,n\)</span>)</li>
</ul></li>
<li>For each agent <span class="math inline">\(i\)</span> (<span class="math inline">\(i = 1,...,m\)</span>) in turn:
<ul>
<li>The resource consumed in allocating task <span class="math inline">\(j\)</span> to agent <span class="math inline">\(i\)</span> (<span class="math inline">\(j = 1,...,n\)</span>)</li>
</ul></li>
<li>The resource capacity of agent <span class="math inline">\(i\)</span> (<span class="math inline">\(i = 1,...,m\)</span>)</li>
</ul></li>
</ul>
<p>Since we have the luxury of unlimited space in this online book, I will show the full content of the data file <em>gap1.txt</em>. This file contains 5 GAP instances and all of them have the same number of agents (5) and tasks (15).</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>gap1.txt</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="gap1.txt"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> 5</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> 5 15</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> 17 21 22 18 24 15 20 18 19 18 16 22 24 24 16</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a> 23 16 21 16 17 16 19 25 18 21 17 15 25 17 24</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> 16 20 16 25 24 16 17 19 19 18 20 16 17 21 24</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> 19 19 22 22 20 16 19 17 21 19 25 23 25 25 25</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> 18 19 15 15 21 25 16 16 23 15 22 17 19 22 24</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> 8 15 14 23 8 16 8 25 9 17 25 15 10 8 24</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> 15 7 23 22 11 11 12 10 17 16 7 16 10 18 22</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> 21 20 6 22 24 10 24 9 21 14 11 14 11 19 16</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> 20 11 8 14 9 5 6 19 19 7 6 6 13 9 18</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> 8 13 13 13 10 20 25 16 16 17 10 10 5 12 23</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> 36 34 38 27 33</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> 5 15</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a> 19 23 24 20 20 25 16 21 24 15 17 17 20 20 20</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a> 25 24 16 21 19 17 17 19 23 21 21 23 20 15 16</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a> 16 21 25 22 24 24 16 17 15 18 15 17 18 24 18</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a> 25 24 18 19 15 18 20 22 23 18 16 19 17 15 22</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> 25 19 21 22 20 15 20 19 18 18 17 23 17 25 25</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> 16 12 8 20 18 10 12 8 14 23 19 14 15 15 24</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a> 16 18 19 22 13 20 9 7 25 10 20 13 11 15 16</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> 6 20 20 5 14 12 6 15 22 18 13 23 23 18 25</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a> 18 23 25 17 25 13 23 23 13 20 20 23 17 19 24</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a> 12 17 15 25 22 5 24 19 12 25 23 21 23 19 18</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a> 36 37 38 48 44</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> 5 15</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> 22 21 16 17 21 15 17 22 22 25 18 20 24 15 22</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a> 23 24 19 15 16 21 15 25 16 21 20 19 16 23 20</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a> 21 20 21 25 21 20 21 19 17 16 25 19 15 15 15</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> 17 21 25 25 23 22 20 19 20 25 15 20 21 25 23</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a> 15 25 23 19 17 17 25 24 24 17 24 19 18 19 16</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a> 23 10 15 13 17 10 13 6 9 21 20 7 9 25 8</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> 17 13 8 23 11 18 7 22 13 5 24 24 15 10 22</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> 22 17 22 23 20 11 17 25 23 9 22 20 15 9 25</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a> 5 19 25 16 15 10 18 9 11 20 7 21 15 8 25</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a> 22 9 10 23 19 21 17 15 15 17 25 19 10 9 21</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a> 32 37 44 35 40</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a> 5 15</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a> 15 25 20 18 19 21 18 22 24 15 25 17 17 15 22</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a> 20 18 25 25 16 24 22 24 17 18 23 25 21 25 24</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> 25 19 18 18 23 18 15 22 23 16 25 22 22 15 16</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a> 19 19 23 17 19 19 22 19 23 22 24 22 25 19 16</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a> 25 24 17 19 25 19 23 19 25 15 19 21 18 19 22</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a> 20 20 18 9 18 5 16 18 13 24 21 23 15 19 9</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a> 5 12 18 8 22 19 19 11 7 19 20 17 21 25 5</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a> 18 8 8 9 20 20 23 13 15 12 6 12 25 25 23</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a> 17 19 24 9 16 22 10 17 12 17 15 21 16 18 6</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a> 14 6 20 6 21 5 11 23 20 21 20 18 13 13 21</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a> 39 36 37 38 37</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a> 5 15</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a> 25 25 18 24 20 19 25 24 23 15 18 18 25 15 22</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a> 25 18 17 22 21 23 20 23 16 19 15 18 16 23 16</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a> 18 16 19 15 15 18 15 20 19 24 22 20 25 16 21</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a> 18 21 16 18 17 24 18 23 22 16 17 22 22 18 16</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a> 17 18 15 21 23 21 24 23 20 22 19 15 22 22 25</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a> 16 20 9 22 17 19 20 22 20 13 6 20 23 19 7</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a> 12 22 18 18 6 13 17 17 17 14 20 12 17 14 22</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a> 5 19 19 14 24 16 7 8 9 22 13 23 24 15 20</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a> 20 8 6 9 5 17 23 18 14 12 14 17 15 23 21</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a> 6 6 24 24 8 7 5 25 21 18 12 20 20 7 12</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a> 40 38 38 35 34</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#lst-gap-reader" class="quarto-xref">Listing&nbsp;<span>5.1</span></a> shows the python code that reads in all the instances from a data file and saves them into a Python list.</p>
<div id="cell-18" class="cell" data-execution_count="3">
<div id="lst-gap-reader" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-gap-reader-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.1: File reading function
</figcaption>
<div aria-describedby="lst-gap-reader-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-gap-reader"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-gap-reader-1"><a href="#lst-gap-reader-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_instance_file(file_path):</span>
<span id="lst-gap-reader-2"><a href="#lst-gap-reader-2" aria-hidden="true" tabindex="-1"></a>    instances <span class="op">=</span> []</span>
<span id="lst-gap-reader-3"><a href="#lst-gap-reader-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-4"><a href="#lst-gap-reader-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="lst-gap-reader-5"><a href="#lst-gap-reader-5" aria-hidden="true" tabindex="-1"></a>        num_instances <span class="op">=</span> <span class="bu">int</span>(<span class="bu">file</span>.readline().strip())</span>
<span id="lst-gap-reader-6"><a href="#lst-gap-reader-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-7"><a href="#lst-gap-reader-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_instances):</span>
<span id="lst-gap-reader-8"><a href="#lst-gap-reader-8" aria-hidden="true" tabindex="-1"></a>            num_agents, num_tasks <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">file</span>.readline().split())</span>
<span id="lst-gap-reader-9"><a href="#lst-gap-reader-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-10"><a href="#lst-gap-reader-10" aria-hidden="true" tabindex="-1"></a>            costs <span class="op">=</span> []</span>
<span id="lst-gap-reader-11"><a href="#lst-gap-reader-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_agents):</span>
<span id="lst-gap-reader-12"><a href="#lst-gap-reader-12" aria-hidden="true" tabindex="-1"></a>                costs.append(<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">file</span>.readline().split())))</span>
<span id="lst-gap-reader-13"><a href="#lst-gap-reader-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-14"><a href="#lst-gap-reader-14" aria-hidden="true" tabindex="-1"></a>            resources <span class="op">=</span> []</span>
<span id="lst-gap-reader-15"><a href="#lst-gap-reader-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_agents):</span>
<span id="lst-gap-reader-16"><a href="#lst-gap-reader-16" aria-hidden="true" tabindex="-1"></a>                resources.append(<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">file</span>.readline().split())))</span>
<span id="lst-gap-reader-17"><a href="#lst-gap-reader-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-18"><a href="#lst-gap-reader-18" aria-hidden="true" tabindex="-1"></a>            capacities <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">file</span>.readline().split()))</span>
<span id="lst-gap-reader-19"><a href="#lst-gap-reader-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-20"><a href="#lst-gap-reader-20" aria-hidden="true" tabindex="-1"></a>            instance <span class="op">=</span> {</span>
<span id="lst-gap-reader-21"><a href="#lst-gap-reader-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'num_agents'</span>: num_agents,</span>
<span id="lst-gap-reader-22"><a href="#lst-gap-reader-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'num_tasks'</span>: num_tasks,</span>
<span id="lst-gap-reader-23"><a href="#lst-gap-reader-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">'costs'</span>: costs,</span>
<span id="lst-gap-reader-24"><a href="#lst-gap-reader-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">'resources'</span>: resources,</span>
<span id="lst-gap-reader-25"><a href="#lst-gap-reader-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">'capacities'</span>: capacities</span>
<span id="lst-gap-reader-26"><a href="#lst-gap-reader-26" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-gap-reader-27"><a href="#lst-gap-reader-27" aria-hidden="true" tabindex="-1"></a>            instances.append(instance)</span>
<span id="lst-gap-reader-28"><a href="#lst-gap-reader-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-gap-reader-29"><a href="#lst-gap-reader-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num_instances, instances</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Below we read the data file ‘gap1.txt’ and display the first instance.</p>
<div id="cell-20" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'/Users/klian/dev/books/large-scale-opt-python/data/gap/gap1.txt'</span>  <span class="co"># Replace with the actual file path</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>num_instances, instances <span class="op">=</span> read_instance_file(file_path)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>instance <span class="op">=</span> instances[<span class="dv">0</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'num_instances: </span><span class="sc">{</span>num_instances<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"num_agents: </span><span class="sc">{</span>instance[<span class="st">'num_agents'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"num_tasks: </span><span class="sc">{</span>instance[<span class="st">'num_tasks'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>num_instances: 5
num_agents: 5
num_tasks: 15</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>instance[<span class="st">'costs'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>[[17, 21, 22, 18, 24, 15, 20, 18, 19, 18, 16, 22, 24, 24, 16],
 [23, 16, 21, 16, 17, 16, 19, 25, 18, 21, 17, 15, 25, 17, 24],
 [16, 20, 16, 25, 24, 16, 17, 19, 19, 18, 20, 16, 17, 21, 24],
 [19, 19, 22, 22, 20, 16, 19, 17, 21, 19, 25, 23, 25, 25, 25],
 [18, 19, 15, 15, 21, 25, 16, 16, 23, 15, 22, 17, 19, 22, 24]]</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>instance[<span class="st">'resources'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>[[8, 15, 14, 23, 8, 16, 8, 25, 9, 17, 25, 15, 10, 8, 24],
 [15, 7, 23, 22, 11, 11, 12, 10, 17, 16, 7, 16, 10, 18, 22],
 [21, 20, 6, 22, 24, 10, 24, 9, 21, 14, 11, 14, 11, 19, 16],
 [20, 11, 8, 14, 9, 5, 6, 19, 19, 7, 6, 6, 13, 9, 18],
 [8, 13, 13, 13, 10, 20, 25, 16, 16, 17, 10, 10, 5, 12, 23]]</code></pre>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>instance[<span class="st">'capacities'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[36, 34, 38, 27, 33]</code></pre>
</div>
</div>
</section>
<section id="solve-the-original-problem" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="solve-the-original-problem"><span class="header-section-number">5.3.2</span> Solve the original problem</h3>
<p>In this section, we use SCIP to solve the original formulation of the GAP, which is given in <a href="#lst-scip-gap" class="quarto-xref">Listing&nbsp;<span>5.3</span></a>.</p>
<div id="cell-26" class="cell" data-execution_count="24">
<div id="lst-scip-gap" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-scip-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.2: SCIP solver for GAP
</figcaption>
<div aria-describedby="lst-scip-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-scip-gap"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-scip-gap-1"><a href="#lst-scip-gap-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt <span class="im">as</span> scip</span>
<span id="lst-scip-gap-2"><a href="#lst-scip-gap-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> SCIP_PARAMSETTING</span>
<span id="lst-scip-gap-3"><a href="#lst-scip-gap-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-scip-gap-4"><a href="#lst-scip-gap-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScipGapSolver:</span>
<span id="lst-scip-gap-5"><a href="#lst-scip-gap-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-6"><a href="#lst-scip-gap-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, instance):</span>
<span id="lst-scip-gap-7"><a href="#lst-scip-gap-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._instance <span class="op">=</span> instance</span>
<span id="lst-scip-gap-8"><a href="#lst-scip-gap-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> scip.Model(<span class="st">"GAP solver"</span>)</span>
<span id="lst-scip-gap-9"><a href="#lst-scip-gap-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-scip-gap-10"><a href="#lst-scip-gap-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-11"><a href="#lst-scip-gap-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-scip-gap-12"><a href="#lst-scip-gap-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-13"><a href="#lst-scip-gap-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_model(<span class="va">self</span>):</span>
<span id="lst-scip-gap-14"><a href="#lst-scip-gap-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-scip-gap-15"><a href="#lst-scip-gap-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> {</span>
<span id="lst-scip-gap-16"><a href="#lst-scip-gap-16" aria-hidden="true" tabindex="-1"></a>            (i, j): <span class="va">self</span>._model.addVar(<span class="ss">f"x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">"</span>, vtype<span class="op">=</span><span class="st">'B'</span>)</span>
<span id="lst-scip-gap-17"><a href="#lst-scip-gap-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-18"><a href="#lst-scip-gap-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-19"><a href="#lst-scip-gap-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-scip-gap-20"><a href="#lst-scip-gap-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-21"><a href="#lst-scip-gap-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-scip-gap-22"><a href="#lst-scip-gap-22" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-scip-gap-23"><a href="#lst-scip-gap-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._instance[<span class="st">'costs'</span>][j][i] <span class="op">*</span> <span class="va">self</span>._vars[(i, j)]</span>
<span id="lst-scip-gap-24"><a href="#lst-scip-gap-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-25"><a href="#lst-scip-gap-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-26"><a href="#lst-scip-gap-26" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-scip-gap-27"><a href="#lst-scip-gap-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(scip.quicksum(obj_expr), <span class="st">"minimize"</span>)</span>
<span id="lst-scip-gap-28"><a href="#lst-scip-gap-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-29"><a href="#lst-scip-gap-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints</span></span>
<span id="lst-scip-gap-30"><a href="#lst-scip-gap-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>]):</span>
<span id="lst-scip-gap-31"><a href="#lst-scip-gap-31" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> [</span>
<span id="lst-scip-gap-32"><a href="#lst-scip-gap-32" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._vars[(i, j)]</span>
<span id="lst-scip-gap-33"><a href="#lst-scip-gap-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-34"><a href="#lst-scip-gap-34" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="lst-scip-gap-35"><a href="#lst-scip-gap-35" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(scip.quicksum(expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="lst-scip-gap-36"><a href="#lst-scip-gap-36" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-scip-gap-37"><a href="#lst-scip-gap-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>]):</span>
<span id="lst-scip-gap-38"><a href="#lst-scip-gap-38" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> [</span>
<span id="lst-scip-gap-39"><a href="#lst-scip-gap-39" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._instance[<span class="st">'resources'</span>][j][i] <span class="op">*</span> <span class="va">self</span>._vars[(i, j)]</span>
<span id="lst-scip-gap-40"><a href="#lst-scip-gap-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-41"><a href="#lst-scip-gap-41" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="lst-scip-gap-42"><a href="#lst-scip-gap-42" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(scip.quicksum(expr) <span class="op">&lt;=</span> <span class="va">self</span>._instance[<span class="st">'capacities'</span>][j])</span>
<span id="lst-scip-gap-43"><a href="#lst-scip-gap-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-44"><a href="#lst-scip-gap-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="lst-scip-gap-45"><a href="#lst-scip-gap-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.hideOutput()</span>
<span id="lst-scip-gap-46"><a href="#lst-scip-gap-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-scip-gap-47"><a href="#lst-scip-gap-47" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">self</span>._model.getStatus()</span>
<span id="lst-scip-gap-48"><a href="#lst-scip-gap-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> status <span class="op">==</span> <span class="st">"optimal"</span>:</span>
<span id="lst-scip-gap-49"><a href="#lst-scip-gap-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="lst-scip-gap-50"><a href="#lst-scip-gap-50" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Optimal solution found!'</span>)</span>
<span id="lst-scip-gap-51"><a href="#lst-scip-gap-51" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Optimal objective = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_model<span class="sc">.</span>getObjVal()<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="lst-scip-gap-52"><a href="#lst-scip-gap-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="lst-scip-gap-53"><a href="#lst-scip-gap-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"unbounded"</span>:</span>
<span id="lst-scip-gap-54"><a href="#lst-scip-gap-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="lst-scip-gap-55"><a href="#lst-scip-gap-55" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-scip-gap-56"><a href="#lst-scip-gap-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"infeasible"</span>:</span>
<span id="lst-scip-gap-57"><a href="#lst-scip-gap-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="lst-scip-gap-58"><a href="#lst-scip-gap-58" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-scip-gap-59"><a href="#lst-scip-gap-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-scip-gap-60"><a href="#lst-scip-gap-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose:</span>
<span id="lst-scip-gap-61"><a href="#lst-scip-gap-61" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span>
<span id="lst-scip-gap-62"><a href="#lst-scip-gap-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="lst-scip-gap-63"><a href="#lst-scip-gap-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-scip-gap-64"><a href="#lst-scip-gap-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-scip-gap-65"><a href="#lst-scip-gap-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_obj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div id="cell-27" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>scip_gap_solver <span class="op">=</span> ScipGapSolver(instance<span class="op">=</span>instances[<span class="dv">0</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>scip_gap_solver.build_model()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>scip_gap_solver.solve(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 261.00</code></pre>
</div>
</div>
</section>
<section id="solve-the-lagrangian-relaxation-with-fixed-multipliers" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="solve-the-lagrangian-relaxation-with-fixed-multipliers"><span class="header-section-number">5.3.3</span> Solve the Lagrangian relaxation with fixed multipliers</h3>
<div id="cell-30" class="cell" data-execution_count="20">
<div id="lst-scip-gap" class="python cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-scip-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5.3: SCIP solver for GAP
</figcaption>
<div aria-describedby="lst-scip-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-scip-gap"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-scip-gap-1"><a href="#lst-scip-gap-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="lst-scip-gap-2"><a href="#lst-scip-gap-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="lst-scip-gap-3"><a href="#lst-scip-gap-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyscipopt <span class="im">as</span> scip</span>
<span id="lst-scip-gap-4"><a href="#lst-scip-gap-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyscipopt <span class="im">import</span> quicksum, SCIP_PARAMSETTING</span>
<span id="lst-scip-gap-5"><a href="#lst-scip-gap-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-scip-gap-6"><a href="#lst-scip-gap-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScipGapLRSolver:</span>
<span id="lst-scip-gap-7"><a href="#lst-scip-gap-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-8"><a href="#lst-scip-gap-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, instance):</span>
<span id="lst-scip-gap-9"><a href="#lst-scip-gap-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._instance <span class="op">=</span> instance</span>
<span id="lst-scip-gap-10"><a href="#lst-scip-gap-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> scip.Model(<span class="st">"GAP Lagrangian relaxation solver"</span>)</span>
<span id="lst-scip-gap-11"><a href="#lst-scip-gap-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setBoolParam(<span class="st">"reoptimization/enable"</span>, <span class="va">True</span>)</span>
<span id="lst-scip-gap-12"><a href="#lst-scip-gap-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._lagrange_multipliers <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-scip-gap-13"><a href="#lst-scip-gap-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-scip-gap-14"><a href="#lst-scip-gap-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-15"><a href="#lst-scip-gap-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._opt_vals <span class="op">=</span> <span class="va">None</span></span>
<span id="lst-scip-gap-16"><a href="#lst-scip-gap-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-17"><a href="#lst-scip-gap-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_model(<span class="va">self</span>, lagrange_multipliers: List):</span>
<span id="lst-scip-gap-18"><a href="#lst-scip-gap-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create decision variables</span></span>
<span id="lst-scip-gap-19"><a href="#lst-scip-gap-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._vars <span class="op">=</span> {</span>
<span id="lst-scip-gap-20"><a href="#lst-scip-gap-20" aria-hidden="true" tabindex="-1"></a>            (i, j): <span class="va">self</span>._model.addVar(<span class="ss">f"x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">"</span>, vtype<span class="op">=</span><span class="st">'BINARY'</span>)</span>
<span id="lst-scip-gap-21"><a href="#lst-scip-gap-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-22"><a href="#lst-scip-gap-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-23"><a href="#lst-scip-gap-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="lst-scip-gap-24"><a href="#lst-scip-gap-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-25"><a href="#lst-scip-gap-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create objective</span></span>
<span id="lst-scip-gap-26"><a href="#lst-scip-gap-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._lagrange_multipliers <span class="op">=</span> lagrange_multipliers</span>
<span id="lst-scip-gap-27"><a href="#lst-scip-gap-27" aria-hidden="true" tabindex="-1"></a>        obj_expr <span class="op">=</span> [</span>
<span id="lst-scip-gap-28"><a href="#lst-scip-gap-28" aria-hidden="true" tabindex="-1"></a>            (<span class="va">self</span>._instance[<span class="st">'costs'</span>][j][i] <span class="op">+</span> <span class="va">self</span>._lagrange_multipliers[i]) <span class="op">*</span> <span class="va">self</span>._vars[(i, j)]</span>
<span id="lst-scip-gap-29"><a href="#lst-scip-gap-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-30"><a href="#lst-scip-gap-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-31"><a href="#lst-scip-gap-31" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-scip-gap-32"><a href="#lst-scip-gap-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.setObjective(quicksum(obj_expr) <span class="op">-</span> quicksum(<span class="va">self</span>._lagrange_multipliers), <span class="st">"minimize"</span>) </span>
<span id="lst-scip-gap-33"><a href="#lst-scip-gap-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-34"><a href="#lst-scip-gap-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create constraints        </span></span>
<span id="lst-scip-gap-35"><a href="#lst-scip-gap-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>]):</span>
<span id="lst-scip-gap-36"><a href="#lst-scip-gap-36" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> [</span>
<span id="lst-scip-gap-37"><a href="#lst-scip-gap-37" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._instance[<span class="st">'resources'</span>][j][i] <span class="op">*</span> <span class="va">self</span>._vars[(i, j)]</span>
<span id="lst-scip-gap-38"><a href="#lst-scip-gap-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-39"><a href="#lst-scip-gap-39" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="lst-scip-gap-40"><a href="#lst-scip-gap-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model.addCons(quicksum(expr) <span class="op">&lt;=</span> <span class="va">self</span>._instance[<span class="st">'capacities'</span>][j])    </span>
<span id="lst-scip-gap-41"><a href="#lst-scip-gap-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-scip-gap-42"><a href="#lst-scip-gap-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="lst-scip-gap-43"><a href="#lst-scip-gap-43" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.hideOutput()</span>
<span id="lst-scip-gap-44"><a href="#lst-scip-gap-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model.optimize()</span>
<span id="lst-scip-gap-45"><a href="#lst-scip-gap-45" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> <span class="va">self</span>._model.getStatus()</span>
<span id="lst-scip-gap-46"><a href="#lst-scip-gap-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> status <span class="op">==</span> <span class="st">"optimal"</span>:</span>
<span id="lst-scip-gap-47"><a href="#lst-scip-gap-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'Optimal solution found!')</span></span>
<span id="lst-scip-gap-48"><a href="#lst-scip-gap-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'Optimal objective = {self._model.getObjVal():.2f}')</span></span>
<span id="lst-scip-gap-49"><a href="#lst-scip-gap-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-scip-gap-50"><a href="#lst-scip-gap-50" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._opt_vals <span class="op">=</span> {</span>
<span id="lst-scip-gap-51"><a href="#lst-scip-gap-51" aria-hidden="true" tabindex="-1"></a>                (i, j): <span class="bu">int</span>(<span class="va">self</span>._model.getVal(<span class="va">self</span>._vars[(i, j)]))</span>
<span id="lst-scip-gap-52"><a href="#lst-scip-gap-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-53"><a href="#lst-scip-gap-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-54"><a href="#lst-scip-gap-54" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="lst-scip-gap-55"><a href="#lst-scip-gap-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"unbounded"</span>:</span>
<span id="lst-scip-gap-56"><a href="#lst-scip-gap-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is unbounded!'</span>)</span>
<span id="lst-scip-gap-57"><a href="#lst-scip-gap-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> status <span class="op">==</span> <span class="st">"infeasible"</span>:</span>
<span id="lst-scip-gap-58"><a href="#lst-scip-gap-58" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Model is infeasible!'</span>)</span>
<span id="lst-scip-gap-59"><a href="#lst-scip-gap-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-scip-gap-60"><a href="#lst-scip-gap-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Unknown error occurred!'</span>)</span>
<span id="lst-scip-gap-61"><a href="#lst-scip-gap-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-scip-gap-62"><a href="#lst-scip-gap-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> are_relaxed_constraints_violated(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="lst-scip-gap-63"><a href="#lst-scip-gap-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""check if the chosen relaxed constraints are violated in </span></span>
<span id="lst-scip-gap-64"><a href="#lst-scip-gap-64" aria-hidden="true" tabindex="-1"></a><span class="co">        the optimal solution.</span></span>
<span id="lst-scip-gap-65"><a href="#lst-scip-gap-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-scip-gap-66"><a href="#lst-scip-gap-66" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="lst-scip-gap-67"><a href="#lst-scip-gap-67" aria-hidden="true" tabindex="-1"></a><span class="co">            bool: true if violated, false otherwise</span></span>
<span id="lst-scip-gap-68"><a href="#lst-scip-gap-68" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="lst-scip-gap-69"><a href="#lst-scip-gap-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>]):</span>
<span id="lst-scip-gap-70"><a href="#lst-scip-gap-70" aria-hidden="true" tabindex="-1"></a>            total_assignments <span class="op">=</span> np.<span class="bu">sum</span>([</span>
<span id="lst-scip-gap-71"><a href="#lst-scip-gap-71" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._opt_vals[(i, j)]</span>
<span id="lst-scip-gap-72"><a href="#lst-scip-gap-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-73"><a href="#lst-scip-gap-73" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="lst-scip-gap-74"><a href="#lst-scip-gap-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_assignments <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="lst-scip-gap-75"><a href="#lst-scip-gap-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="lst-scip-gap-76"><a href="#lst-scip-gap-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="lst-scip-gap-77"><a href="#lst-scip-gap-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-78"><a href="#lst-scip-gap-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_original_obj_val(<span class="va">self</span>):</span>
<span id="lst-scip-gap-79"><a href="#lst-scip-gap-79" aria-hidden="true" tabindex="-1"></a>        orig_obj <span class="op">=</span> np.<span class="bu">sum</span>([</span>
<span id="lst-scip-gap-80"><a href="#lst-scip-gap-80" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._instance[<span class="st">'costs'</span>][j][i] <span class="op">*</span> <span class="va">self</span>._opt_vals[(i, j)]</span>
<span id="lst-scip-gap-81"><a href="#lst-scip-gap-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-82"><a href="#lst-scip-gap-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-83"><a href="#lst-scip-gap-83" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="lst-scip-gap-84"><a href="#lst-scip-gap-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> orig_obj</span>
<span id="lst-scip-gap-85"><a href="#lst-scip-gap-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-86"><a href="#lst-scip-gap-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_constraint_violations(<span class="va">self</span>):</span>
<span id="lst-scip-gap-87"><a href="#lst-scip-gap-87" aria-hidden="true" tabindex="-1"></a>        violations <span class="op">=</span> [</span>
<span id="lst-scip-gap-88"><a href="#lst-scip-gap-88" aria-hidden="true" tabindex="-1"></a>            np.<span class="bu">sum</span>([</span>
<span id="lst-scip-gap-89"><a href="#lst-scip-gap-89" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._opt_vals[(i, j)]</span>
<span id="lst-scip-gap-90"><a href="#lst-scip-gap-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_agents'</span>])</span>
<span id="lst-scip-gap-91"><a href="#lst-scip-gap-91" aria-hidden="true" tabindex="-1"></a>            ]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="lst-scip-gap-92"><a href="#lst-scip-gap-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>._instance[<span class="st">'num_tasks'</span>])</span>
<span id="lst-scip-gap-93"><a href="#lst-scip-gap-93" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="lst-scip-gap-94"><a href="#lst-scip-gap-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> violations</span>
<span id="lst-scip-gap-95"><a href="#lst-scip-gap-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-96"><a href="#lst-scip-gap-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_slackness(<span class="va">self</span>) <span class="op">-&gt;</span> List:</span>
<span id="lst-scip-gap-97"><a href="#lst-scip-gap-97" aria-hidden="true" tabindex="-1"></a>        violations <span class="op">=</span> <span class="va">self</span>.get_constraint_violations()</span>
<span id="lst-scip-gap-98"><a href="#lst-scip-gap-98" aria-hidden="true" tabindex="-1"></a>        slackness <span class="op">=</span> np.<span class="bu">sum</span>(np.array(violations) <span class="op">*</span> np.array(<span class="va">self</span>._lagrange_multipliers))</span>
<span id="lst-scip-gap-99"><a href="#lst-scip-gap-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> slackness</span>
<span id="lst-scip-gap-100"><a href="#lst-scip-gap-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-scip-gap-101"><a href="#lst-scip-gap-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-scip-gap-102"><a href="#lst-scip-gap-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_obj(<span class="va">self</span>):</span>
<span id="lst-scip-gap-103"><a href="#lst-scip-gap-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._model.getObjVal()</span>
<span id="lst-scip-gap-104"><a href="#lst-scip-gap-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="lst-scip-gap-105"><a href="#lst-scip-gap-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="lst-scip-gap-106"><a href="#lst-scip-gap-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> opt_vals(<span class="va">self</span>):</span>
<span id="lst-scip-gap-107"><a href="#lst-scip-gap-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._opt_vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lagrange_multipliers <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> instances[<span class="dv">0</span>][<span class="st">'num_tasks'</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver <span class="op">=</span> ScipGapLRSolver(instances[<span class="dv">0</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver.build_model(lagrange_multipliers)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver.solve()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 0.00</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lagrange_multipliers <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, instances[<span class="dv">0</span>][<span class="st">'num_tasks'</span>])</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver <span class="op">=</span> ScipGapLRSolver(instances[<span class="dv">0</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver.build_model(lagrange_multipliers)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>scip_gap_lr_solver.solve()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal solution found!
Optimal objective = 36.43</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lagrange_multipliers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([-0.17007182, -3.94871019, -0.36710205, -1.8633616 , -4.09109043,
       -3.53643355, -3.51083883, -2.08736108, -3.64585478, -1.0379109 ,
       -3.94447795, -3.74243486, -0.61145116, -1.25320861, -2.61552727])</code></pre>
</div>
</div>
</section>
<section id="approximating-the-best-lagrange-multipliers" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="approximating-the-best-lagrange-multipliers"><span class="header-section-number">5.3.4</span> Approximating the best Lagrange multipliers</h3>
<section id="subgradient-search" class="level4" data-number="5.3.4.1">
<h4 data-number="5.3.4.1" class="anchored" data-anchor-id="subgradient-search"><span class="header-section-number">5.3.4.1</span> Subgradient Search</h4>
<div id="cell-37" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScipGapSubgradientSearch:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, instance):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._instance <span class="op">=</span> instance</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._lr_solver <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter_lb_not_improving <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_max_iter(<span class="va">self</span>, max_iter):</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter <span class="op">=</span> max_iter</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_max_iter_lb_not_improving(<span class="va">self</span>, max_iter_lb_not_improving):</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter_lb_not_improving <span class="op">=</span> max_iter_lb_not_improving</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-4</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        gamma <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># obtain best bound</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver <span class="op">=</span> ScipGapSolver(instance<span class="op">=</span><span class="va">self</span>._instance)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver.build_model()</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver.solve(verbose)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.best_bound <span class="op">=</span> scip_gap_solver.opt_obj</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        num_tasks <span class="op">=</span> <span class="va">self</span>._instance[<span class="st">'num_tasks'</span>]</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        multipliers <span class="op">=</span> np.zeros(num_tasks)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>        iterations <span class="op">=</span> []</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        lower_bounds <span class="op">=</span> []</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        iterLbNoImprove <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">iter: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve relaxation with given multipliers</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver <span class="op">=</span> ScipGapLRSolver(<span class="va">self</span>._instance)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver.build_model(multipliers)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver.solve()</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update bounds</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>            opt_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.opt_obj</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> opt_obj <span class="op">&gt;</span> lb:</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                lb <span class="op">=</span> opt_obj</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                iterLbNoImprove <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'lb updated, new lb: </span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                iterLbNoImprove <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            iterations.append(<span class="bu">iter</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>            lower_bounds.append(lb)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>            constraints_violated <span class="op">=</span> <span class="va">self</span>._lr_solver.are_relaxed_constraints_violated()</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'constraints violation: </span><span class="sc">{</span>constraints_violated<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> constraints_violated:</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>                orig_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.get_original_obj_val()</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> orig_obj <span class="op">&lt;</span> ub:</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>                    ub <span class="op">=</span> orig_obj</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'ub updated, new ub: </span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>            <span class="co"># check stopping criteria</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> iterLbNoImprove <span class="op">&gt;=</span> <span class="va">self</span>._max_iter_lb_not_improving:</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>            slackness <span class="op">=</span> <span class="va">self</span>._lr_solver.get_slackness()</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'slack: {slackness}')</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> constraints_violated:</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.<span class="bu">sum</span>(slackness) <span class="op">&lt;</span> eps:</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">iter</span> <span class="op">&gt;=</span> <span class="va">self</span>._max_iter:</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update multipliers</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>            violations <span class="op">=</span> <span class="va">self</span>._lr_solver.get_constraint_violations()</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'violations: </span><span class="sc">{</span>violations<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>            relaxed_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.opt_obj</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>            step_size <span class="op">=</span> gamma <span class="op">*</span> (<span class="va">self</span>.best_bound <span class="op">-</span> relaxed_obj) <span class="op">/</span> (np.linalg.norm(violations))<span class="op">**</span><span class="dv">2</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>            multipliers <span class="op">+=</span> step_size <span class="op">*</span> np.array(violations)</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lb, iterations, lower_bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="surrogate-subgradient-search" class="level4" data-number="5.3.4.2">
<h4 data-number="5.3.4.2" class="anchored" data-anchor-id="surrogate-subgradient-search"><span class="header-section-number">5.3.4.2</span> Surrogate Subgradient Search</h4>
<div id="cell-40" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScipGapSurrogateSubgradientSearch:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, instance):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._instance <span class="op">=</span> instance</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._lr_solver <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter_lb_not_improving <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_max_iter(<span class="va">self</span>, max_iter):</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter <span class="op">=</span> max_iter</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_max_iter_lb_not_improving(<span class="va">self</span>, max_iter_lb_not_improving):</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._max_iter_lb_not_improving <span class="op">=</span> max_iter_lb_not_improving</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        lb <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        ub <span class="op">=</span> np.inf</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        eps <span class="op">=</span> <span class="fl">1.0e-4</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> <span class="fl">0.06</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        M <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># obtain best bound</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver <span class="op">=</span> ScipGapSolver(instance<span class="op">=</span><span class="va">self</span>._instance)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver.build_model()</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        scip_gap_solver.solve(verbose)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.best_bound <span class="op">=</span> scip_gap_solver.opt_obj</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        num_tasks <span class="op">=</span> <span class="va">self</span>._instance[<span class="st">'num_tasks'</span>]</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        multipliers <span class="op">=</span> np.zeros(num_tasks)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        iterations <span class="op">=</span> []</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        lower_bounds <span class="op">=</span> []</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        iterLbNoImprove <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        prev_step_size <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        prev_violations <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">iter: </span><span class="sc">{</span><span class="bu">iter</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># solve relaxation with given multipliers</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver <span class="op">=</span> ScipGapLRSolver(<span class="va">self</span>._instance)</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver.build_model(multipliers)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._lr_solver.solve()</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update bounds</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>            opt_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.opt_obj</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'lr_obj: </span><span class="sc">{</span>opt_obj<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> opt_obj <span class="op">&gt;</span> lb:</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>                lb <span class="op">=</span> opt_obj</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>                iterLbNoImprove <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'lb updated, new lb: </span><span class="sc">{</span>lb<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>                iterLbNoImprove <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            iterations.append(<span class="bu">iter</span>)</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            lower_bounds.append(lb)</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>            constraints_violated <span class="op">=</span> <span class="va">self</span>._lr_solver.are_relaxed_constraints_violated()</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'constraints violation: </span><span class="sc">{</span>constraints_violated<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> constraints_violated:</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>                orig_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.get_original_obj_val()</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> orig_obj <span class="op">&lt;</span> ub:</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>                    ub <span class="op">=</span> orig_obj</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'ub updated, new ub: </span><span class="sc">{</span>ub<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># check stopping criteria</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> iterLbNoImprove <span class="op">&gt;=</span> <span class="va">self</span>._max_iter_lb_not_improving:</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>            slackness <span class="op">=</span> <span class="va">self</span>._lr_solver.get_slackness()</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'slack: {slackness}')</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> constraints_violated:</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.<span class="bu">sum</span>(slackness) <span class="op">&lt;</span> eps:</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">iter</span> <span class="op">&gt;=</span> <span class="va">self</span>._max_iter:</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update multipliers</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>            violations <span class="op">=</span> <span class="va">self</span>._lr_solver.get_constraint_violations()</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'violations: </span><span class="sc">{</span>violations<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>            relaxed_obj <span class="op">=</span> <span class="va">self</span>._lr_solver.opt_obj</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">iter</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>                step_size <span class="op">=</span> (<span class="va">self</span>.best_bound <span class="op">-</span> relaxed_obj) <span class="op">/</span> (np.linalg.norm(violations))<span class="op">**</span><span class="dv">2</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>                p <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">/</span> ((<span class="bu">iter</span><span class="op">+</span><span class="dv">1</span>)<span class="op">**</span>r)</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>                alpha <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">/</span> (M <span class="op">*</span> (<span class="bu">iter</span><span class="op">+</span><span class="dv">1</span>)<span class="op">**</span>p)</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>                step_size <span class="op">=</span> alpha <span class="op">*</span> prev_step_size <span class="op">*</span> np.linalg.norm(prev_violations) <span class="op">/</span> np.linalg.norm(violations)</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'step_size: </span><span class="sc">{</span>step_size<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>            multipliers <span class="op">+=</span> step_size <span class="op">*</span> np.array(violations)</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="ss">f'multipliers: </span><span class="sc">{</span>multipliers<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>            prev_step_size <span class="op">=</span> step_size</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>            prev_violations <span class="op">=</span> violations</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lb, iterations, lower_bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>instance <span class="op">=</span> instances[<span class="dv">1</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>approximator_ss <span class="op">=</span> ScipGapSubgradientSearch(instance)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>approximator_ss.set_max_iter(<span class="dv">1000</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>best_bound_ss, iterations_ss, lower_bounds_ss <span class="op">=</span> approximator_ss.solve(verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>approximator_sss <span class="op">=</span> ScipGapSurrogateSubgradientSearch(instance)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>approximator_sss.set_max_iter(<span class="dv">1000</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>best_bound_sss, iterations_sss, lower_bounds_sss <span class="op">=</span> approximator_sss.solve(verbose<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>best_bound_ss, best_bound_sss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>(269.00000010648733, 268.0917422821587)</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>fit, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>bound <span class="op">=</span> approximator_ss.best_bound</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax.plot(iterations_ss, np.ones(<span class="bu">len</span>(iterations_ss))<span class="op">*</span>bound, <span class="st">'r--'</span>, label<span class="op">=</span><span class="st">'Optimal Value'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>ax.plot(iterations_ss, lower_bounds_ss, <span class="st">'b--'</span>, label<span class="op">=</span><span class="st">'Subgradient Search'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>ax.plot(iterations_sss, lower_bounds_sss, <span class="st">'g--'</span>, label<span class="op">=</span><span class="st">'Surrogate Subgradient Search'</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lagrange-assignment_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="alternative-relaxation" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="alternative-relaxation"><span class="header-section-number">5.4</span> Alternative Relaxation</h2>
</section>
<section id="performance-comparison" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="performance-comparison"><span class="header-section-number">5.5</span> Performance Comparison</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lagrange-theory.html" class="pagination-link" aria-label="Lagrangian Relaxation Theories">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lagrangian Relaxation Theories</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lagrange-ufl.html" class="pagination-link" aria-label="Uncapacitated Facility Location Problem">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Uncapacitated Facility Location Problem</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>